; common state file for M.U.G.E.N 1.0 (MOD: addoo4 Basic)

; system variables usage
; ----------------------
; var name    type   purpose
; --------    ----   -------
; sysvar(0)   temp   set by state 5081 (hitl_slide) to 1 to prevent
;                    showing ground hit frame in state 5110 (hit_liedown).
;                    used by guarding states.
;                    used in state 195900 for setting partner-assist-stateno.
; sysvar(1)   temp   used by state 40 (jump start) and 45 (air jump start)
;                    to keep track of which way to jump.
;                    used by state 5100 and 5110 to remember downward
;                    velocity of player just before hitting the ground.
;                    used in state 5080 for storing the anim # to display.
; sysvar(4)   temp   team mode

; ---------
; (options)
; ---------
; sysvar(2)   temp   hitshake anim
;                    used in state 120-155 (guard) for ai-flag
; sysvar(3)   temp
; sysfvar(0)  int    lifebar helper id
;                    used by state -2
; sysfvar(1)  int    jump type
; sysfvar(4)  int    tag mode

; the following states have special handling within mugen,and should be
; overridden with caution:
; jump start (40): airjumping bookkeeping at time=0
; all guard states (120-155): guard handling throughout state
; hit_trip,shaking (5070): defense increases at time=0
; downed get-hit (hit ground from fall) (5100):
;   defense increases at time=0,player becomes invincible if within 10
;   ticks of getting up
; hit_liedown (5110): player changes to get-up state (5120) when ready
; hit_getup (5120): player's defence is restored to normal at time=0
; hitfall_recover (5200): player's defence is restored at time=0
; hitfall_airrecover (5210): player's defence is restored at time=0



;;---
;; Find these Marks to Config.
;; この標記を検索して設定を変えてください。

;;>>@Config.
;;>>@Config.System_Switch>>
;;>>@Config.Stage_Type>>
;;>>@Config.AI>>
;;>>@Config.Power_Mode>>
;;>>@Config.LifeBar>>
;;>>@Config.LifeBar_Draw>>
;;>>@Config.GuardBar>>
;;>>@Config.PowerBar>>
;;>>@Config.PowerBar_Draw>>
;;>>@Config.Face>>
;;>>@Config.Combo.Pos>>
;;>>@Config.Counter_Hit>>
;;>>@Config.DamageToPower>>
;;>>@Config.Power_Start>>
;;>>@Config.Icon_FirstAttack_Pos>>
;;>>@Config.Icon_CPU_Pos>>
;;>>@Config.Score>>
;;>>@Config.Message_Pos>>
;;>>@Config.KO>>
;;>>@Config.Ground_Dust_Effect>>
;;>>@Config.Display_Input>>
;;>>@Config.Tag_Command>>
;;>>@Config.Tag_FirstPlayer_Select>>
;;>>@Config.Camera>>

;;>>@Config.Tag_Assist_StateNo>>
;; tag-mode.partner.statedef [190190-190199]
;; partner-assist/striker.stateno registration [195900]
;;>>@Config.Round_Fight>>
;; round-call.statedef [18000]
;;>>@Config.Ranking>>
;; rank.panel.statedef [99980]


;------------------------
;------------------------
; Stand
[statedef 0]
type=s
physics=s
sprpriority=0
;---
;velset=0,0
;movetype=i
;---

[state 0] ;[.00] ; remove special helpers
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900) || ishelper(159005)
	value=159990
	ignorehitpause=1

[state 0] ;[.01b] ; partner_standby ; パートナー待機
	type=selfstate
	trigger1=!time && numpartner && !ishelper && sysfvar(4)>0 && alive && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)=4
	value=190190

;---
; Guard ; 防
[state 0] ;[.05a1]
	type=changestate
	trigger1=roundstate=2 && ctrl && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && inguarddist
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/10000)%10
	value=120
	ctrl=0
; Roll ; 避
[state 0] ;[.05a2]
	type=changestate
	trigger1=roundstate=2 && ctrl && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && selfanimexist(195200)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/100000)%10=1
	value=110
; Jump ; 跳
[state 0] ;[.05a3]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>0 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[4,7])
	value=ifelse( ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[6,7]), 48, 142000 +(((playerid(floor(sysfvar(0))),var(18)/100000)%10)-4)*10 +((playerid(floor(sysfvar(0))),var(18)/1000000)%10) )
; Run ; 走
[state 0] ;[.05a4]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>5 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0 && (p2bodydist x!=[-58,58]) && (playerid(floor(sysfvar(0))),var(19)/1000)%1000=0
	trigger1=random<p2bodydist x*2 || (p2movetype=i && random<100) || p2stateno=190116 ;; dizzy
	value=100
; Back_Step ; 退
[state 0] ;[.05a5]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>5 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0 && (p2bodydist x=[-80,80]) && p2stateno!=190116 && random<120
	value=105
; Walk ; 歩
[state 0] ;[.05a6]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>5 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0 && (playerid(floor(sysfvar(0))),var(19)/10)%10=0 && random<200
	value=21
;---
;---
[state 0] ;[.06]
	type=changeanim
	trigger1=(anim!=0 && anim!=5) || (anim=5 && animtime=0)
	value=0
[state 0] ;[.07]
	type=velset
	trigger1=!time
	y=0
[state 0] ;[.08]
	type=velset
	trigger1=abs(vel x)<const(movement.stand.friction.threshold) || time=4
	x=0
;---
[state 0] ;[.09]
	type=changestate
	trigger1=time>80 && (lose || drawgame) && (prevstateno=190195) && roundstate>2
	value=ifelse(selfanimexist(170),170,175)
	ctrl=1

;------------------------
;------------------------
; Stand to Crouch
[statedef 10]
type=c
physics=c
anim=10

[state 0] ;[.00]
	type=velmul
	trigger1=1
	x=0.75
[state 0] ;[.01]
	type=velset
	trigger1=abs(vel x)<const(movement.crouch.friction.threshold)
;op;	trigger2=time>2
	x=0
[state 0] ;[.02]
	type=changestate
	trigger1=animtime=0
	value=11

;------------------------
; Crouching
[statedef 11]
type=c
physics=c
anim=11
sprpriority=0
;movetype=i

[state 0] ;[.01b] ; partner_standby ; パートナー待機
	type=selfstate
	trigger1=!time && numpartner && !ishelper && sysfvar(4)>0 && alive && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)=4
	value=190190

[state 0] ;[.02]
	type=changeanim
	trigger1=anim=6 && animtime=0
	value=11
[state 0] ;[.03]
	type=velset
;v1.0;	trigger1=abs(vel x)<const(movement.crouch.friction.threshold)
	trigger1=1
	x=0
;---
;---
; Guard ; 防
[state 0] ;[.05a1]
	type=changestate
	trigger1=roundstate=2 && ctrl && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && inguarddist
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/10000)%10
	value=120
	ctrl=0
; Roll ; 避
[state 0] ;[.05a2]
	type=changestate
	trigger1=roundstate=2 && ctrl && sysvar(0)>0 && playeridexist(floor(sysfvar(0))) && selfanimexist(195200)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/100000)%10=1
	value=110
; Jump ; 跳
[state 0] ;[.05a3]
	type=changestate
	trigger1=roundstate=2 && ctrl && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[4,7])
	value=ifelse( ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[6,7]), 48, 142000 +(((playerid(floor(sysfvar(0))),var(18)/100000)%10)-4)*10 +((playerid(floor(sysfvar(0))),var(18)/1000000)%10) )
;---

;------------------------
; Crouch to Stand
[statedef 12]
type=s
physics=s
anim=12

[state 0] ;[.00]
	type=changestate
	trigger1=animtime=0
	value=0

;------------------------
;------------------------
; Walk
[statedef 20]
type=s
physics=s
sprpriority=0
;; movetype=i
;---
[state 0] ;[.01b] ; partner_standby ; パートナー待機
	type=selfstate
	trigger1=!time && numpartner && !ishelper && sysfvar(4)>0 && alive && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)=4
	value=190190
;---
[state 0] ;[.00]
	type=selfstate
	trigger1=!time && roundstate=2 && ctrl && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0
	value=21
;---
;---
[state 0] ;[.01]
	type=velset
	trigger1=command="holdfwd"
	x=const(velocity.walk.fwd.x)
[state 0] ;[.02]
	type=velset
	trigger1=command="holdback"
	x=const(velocity.walk.back.x)
[state 0] ;[.03]
	type=changeanim
	trigger1=vel x>0
	trigger1=(anim!=20 && anim!=5) || (anim=5 && animtime=0)
	value=20
[state 0] ;[.04]
	type=changeanim
	trigger1=vel x<0
	trigger1=(anim!=21 && anim!=5) || (anim=5 && animtime=0)
	value=21
;------------------------
;---
; Walk_ai
[statedef 21]
type=s
physics=n
sprpriority=0
anim=20
velset=const(velocity.walk.fwd.x),0
ctrl=0
facep2=1 ;; autoturn
;---
[state 0] ;[.02] ; ai_vel_back
	type=velset
	trigger1=p2stateno!=190116 ;; dizzy
	trigger1=((gametime+id)%32=0) && (random<500) ;;&& p2movetype=a
	x=const(velocity.walk.back.x)
;---
; Guard ; 防
[state 0] ;[.05a1]
	type=changestate
	trigger1=roundstate=2 && time>0 && inguarddist && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/10000)%10
	value=120
	ctrl=0
; Roll ; 避
[state 0] ;[.05a2]
	type=changestate
	trigger1=roundstate=2 && time>1 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && selfanimexist(195200)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/100000)%10=1
	value=110
; Jump ; 跳
[state 0] ;[.05a3]
	type=changestate
	trigger1=roundstate=2 && time>3 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[4,7])
	value=ifelse( ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[6,7]), 48, 142000 +(((playerid(floor(sysfvar(0))),var(18)/100000)%10)-4)*10 +((playerid(floor(sysfvar(0))),var(18)/1000000)%10) )
; Run ; 走
[state 0] ;[.05a4]
	type=changestate
	trigger1=roundstate=2 && time>9 && sysvar(2)>1 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (p2bodydist x!=[-100,100]) && (playerid(floor(sysfvar(0))),var(19)/1000)%1000=0
	trigger1=random<p2bodydist x/2 || (p2movetype!=a && random<80) || p2stateno=190116 ;; dizzy
	value=100
	ctrl=1
; Back_Step ; 退
[state 0] ;[.05a5]
	type=changestate
	trigger1=roundstate=2 && time>6 && sysvar(2)>1 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (p2bodydist x=[-80,80]) && p2stateno!=190116 && random<80
	value=105
;---
[state 0] ;[.06]
	type=changestate
	trigger1=time>60 || roundstate!=2
	trigger2=time>9 && ((backedgebodydist<=0) || (frontedgebodydist<=0) || (p2bodydist x=[-36,36]))
	trigger3=time>1 && (p2dist x<0) ;; turn
	value=0
	ctrl=1
;---
[state 0] ;[.07]
	type=changeanim
	trigger1=(vel x<0) && ((anim=5 && animtime=0) || (anim!=5 && anim!=21))
	value=21

;------------------------
; Jump start
; sv01:	0:normal / 1:long / 2:small / 3:middle
;------------------------
[statedef 40]
type=u
physics=u

;---
[state 0] ;[.00]
	type=changestate
	trigger1=!time && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && selfanimexist(195200)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0
	value= 0 ;; ifelse(prevstateno!=stateno,prevstateno,10) ;; cancel
;---

[state 0] ;[.01]
	type=changeanim
	trigger1=!time
	value=40
[state 0] ;[.02]
	type=sprpriority
	trigger1=!time
	value=1
[state 0] ;[.03]
	type=ctrlset
	trigger1=!time
	value=0
[state 0] ;[.04]
	type=velset
	trigger1=!time
	x=0
	y=0
[state 0] ;[.05]
	type=statetypeset
	trigger1=!time
	statetype=s
	physics=s
; direction ; 方向
[state 0] ;[.06]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.06b]
	type=varset
	trigger1=command="holdfwd" || prevstateno=100
	sysvar(1)=1
[state 0] ;[.06c]
	type=varset
	trigger1=command="holdback"
	sysvar(1)=-1
;---
; jump type ; ジャンプ種類
; normal (=0 def)
[state 0] ;[.07a]
	type=varset
	trigger1=!time
	sysfvar(1)=0
; long jump (=1)
[state 0] ;[.07b]
	type=varset
	triggerall=!time
	trigger1=prevstateno=100
	trigger2=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger2=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(44)>0
	sysfvar(1)=1
; small jump (=2)
[state 0] ;[.07c]
	type=varset
	trigger1=command!="holdup" && sysfvar(1)=0
	trigger1=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)!=2
	sysfvar(1)=2
; mid hump (=3)
[state 0] ;[.07d]
	type=varset
	trigger1=command!="holdup" && sysfvar(1)=1
	trigger1=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)!=2
	sysfvar(1)=3
;---
; vel x - normal / small
[state 0] ;[.08a]
	type=velset
	trigger1=animtime=0 && (sysfvar(1)=0 || sysfvar(1)=2)
	x=ifelse(sysvar(1)=0,const(velocity.jump.neu.x),ifelse(sysvar(1)=1,const(velocity.jump.fwd.x),const(velocity.jump.back.x)))
; vel x - mid / long
[state 0] ;[.08b]
	type=velset
	trigger1=animtime=0 && (sysfvar(1)=1 || sysfvar(1)=3)
	x=ifelse(sysvar(1)=0,const(velocity.jump.neu.x),ifelse(sysvar(1)=1,const(velocity.runjump.fwd.x),const(velocity.runjump.back.x)))
;---
; vel y - normal
[state 0] ;[.09a]
	type=velset
	trigger1=animtime=0
	y=const(velocity.jump.y)
; vel y - long
[state 0] ;[.09b]
	type=velset
	trigger1=animtime=0 && sysfvar(1)=1
	y=const(velocity.runjump.y)
; vel y - small / mid
[state 0] ;[.09c]
	type=velset
	trigger1=animtime=0 && sysfvar(1)>=2
	y=-const(movement.yaccel)*13.32
	;; const(movement.yaccel)/0.50*6.66
	;; const(velocity.runjump.y)/1.41
[state 0] ;[.10]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1

;------------------------
; AirJump start
[statedef 45]
type=a
physics=n
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=changeanim
	trigger1=selfanimexist(44)
	value=44
[state 0] ;[.01]
	type=changeanim
	trigger1=!selfanimexist(44)
	value=41
[state 0] ;[.02]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.03]
	type=varset
	trigger1=command="holdfwd"
	sysvar(1)=1
[state 0] ;[.04]
	type=varset
	trigger1=command="holdback"
	sysvar(1)=-1
[state 0] ;[.05]
	type=velset
	trigger1=time=2
	x=ifelse(sysvar(1)=0,const(velocity.airjump.neu.x),ifelse(sysvar(1)=1,const(velocity.airjump.fwd.x),const(velocity.airjump.back.x)))
	y=const(velocity.airjump.y)
[state 0] ;[.06]
	type=changestate
	trigger1=time=2
	value=50
	ctrl=1

;------------------------
; Jump up
[statedef 50]
type=a
physics=a
;movetype=i

[state 0] ;[.00]
	type=playsnd
	trigger1=!time && (prevstateno!=40)
	value=f50,0
	channel=1
;---
[state 0] ;[.01]
	type=changeanim
	trigger1=!time && (sysfvar(1)<2) ;;<-n,l jump
	value=ifelse((vel x)=0,41,ifelse((vel x)>0,42,43))
[state 0] ;[.02]
	type=changeanim
	trigger1=!time && (sysfvar(1)>=2) ;;<-m,s jump
	value=41
[state 0] ;[.03]
	type=changeanim
	trigger1=(vel y>-2) && selfanimexist(anim+3)
	value=anim+3
	persistent=0
;---
; Guard ; 防御
[state 0] ;[.05]
	type=changestate
	trigger1=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/10000)%10
	value=120
	ctrl=0
;---

;------------------------
; Jump Down (empty state for compatibility)
[statedef 51]
type=a
physics=a

[state 0] ;[.00]
	type=null
	trigger1=1

;------------------------
; Jump Land
[statedef 52]
type=s
physics=s
anim=47
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=posset
	trigger1=!time
	y=0
[state 0] ;[.01]
	type=changestate
	trigger1=animtime=0
	value=0
	ctrl=1

;------------------------
; Jump Up
[statedef 58]
type=a
physics=a
anim=41

[state 0] ;[.00]
	type=playsnd
	trigger1=!time
	value=f50,0
[state 0] ;[.01]
	type=changeanim
	trigger1=(vel y>-2) && selfanimexist(anim+3)
	value=anim+3
	persistent=0

;------------------------
; Run Fwd
[statedef 100]
type=s
movetype=i
physics=s
sprpriority=1

[state 0] ;[.01b] ; partner_standby ; パートナー待機
	type=selfstate
	trigger1=!time && numpartner && !ishelper && sysfvar(4)>0 && alive && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)=4
	value=190190

;---
; Guard ; 防
[state 0] ;[.05a]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && inguarddist
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/10000)%10
	value=120
	ctrl=0
; Roll ; 避
[state 0] ;[.05b]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>5 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0))) && selfanimexist(195200)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(18)/100000)%10=1
	value=110
; Jump ; 跳
[state 0] ;[.05c]
	type=changestate
	trigger1=roundstate=2 && ctrl && time>5 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[4,7])
	value=ifelse( ((playerid(floor(sysfvar(0))),var(18)/100000)%10=[1,2]), 142011, 142031)
;---
;---
[state 0] ;[.00]
	type=changeanim
	trigger1=!time && (anim!=100)
	value=100

; step sound ; 足音
[state 0] ;[.01]
	type=playsnd
	trigger1=(time%12=6) && const(velocity.run.fwd.y)=0 ;;<-edited
	value=f100,0
	channel=1

; dash_dust
[state 0] ;[.03]
	type=helper
	trigger1=(time=2) && (pos y=0) && (vel x=0) && !numhelper(152040)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(8*const(size.xscale)),floor(-pos y)
	size.xscale=0.35
	size.yscale=0.35
	persistent=0

[state 0] ;[.04]
	type=velset
	trigger1=(time>=2) || (prevstateno=40)
	x=const(velocity.run.fwd.x)

[state 0] ;[.06]
	type=assertspecial
	trigger1=1
	flag=nowalk
	flag2=noautoturn

[state 0] ;[.07]
	type=changestate
	triggerall=time>16
	trigger1=roundstate!=2
	;---
;v1.0;	trigger2=ailevel && ((p2bodydist x=[-42,42]) || random>p2bodydist x*8 || frontedgebodydist<0 || time>60)
	trigger2=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger2=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0 && ((p2bodydist x=[-42,42]) || random>p2bodydist x*8 || frontedgebodydist<0 || time>60)
	;---
;v1.0;	trigger3=command!="holdfwd" && !ailevel
	trigger3=command!="holdfwd" && (sysfvar(0)<1 || (sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))=0))
	trigger4=command!="holdfwd" && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger4=playerid(floor(sysfvar(0))),var(0)!=90900 || playerid(floor(sysfvar(0))),var(51)<1
	;---
	value=0

;------------------------
; Run Back / Back Step
[statedef 105]
type=a
physics=s
movetype=i
anim=105
sprpriority=1
velset=0,0
ctrl=0

; dash_dust
[state 0] ;[.03]
	type=helper
	trigger1=(time=2) && (pos y<=0) && (prevstateno!=stateno) && !numhelper(152040)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(8*const(size.xscale)),floor(-pos y)
	size.xscale=-0.35
	size.yscale= 0.35
	persistent=0

[state 0] ;[.01]
	type=velset
	trigger1=time=2
	x=const(velocity.run.back.x)
	y=const(velocity.run.back.y)

[state 0] ;[.02]
	type=velset
	trigger1=time=2 && const(velocity.run.back.y)>=0
	y=-0.001

[state 0] ;[.04]
	type=statetypeset
	trigger1=time=2
	physics=n

[state 0] ;[.05]
	type=playsnd
	trigger1=time=2
	value=f50,0
	channel=1
[state 0] ;[.06]
	type=veladd
	trigger1=time>2 && vel x<0
	x=0.02

[state 0] ;[.07] ; gravity
	type=veladd
	trigger1=time>2 && const(velocity.run.back.y)<0
	trigger2=time>12 && const(velocity.run.back.y)>=0 && time>const(velocity.run.back.y)
	y=const(movement.yaccel)

[state 0] ;[.08]
	type=changestate
	trigger1=time>2 && (pos y+vel y>=0) && (vel y>0)
	value=52 ;; 106

[state 0] ;[.09] ; edited
	type=nothitby
	trigger1=time<16
	value=sca,na,sa,ha,np,sp,hp

;------------------------
; Run Back 2
[statedef 106]
type=s
physics=s
anim=47
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=posset
	trigger1=!time
	y=0
;v1.0;[state 0] ;[.01]
;v1.0;	type=velset
;v1.0;	trigger1=abs(vel x)<const(movement.stand.friction.threshold)
;v1.0;	x=0
[state 0] ;[.02]
	type=changestate
	trigger1=time=7
	value=0
	ctrl=1

;------------------------
; ai jump (StNo.142###) ; AIジャンプ
; normal
;------------------------
[statedef 142000]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=0
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.jump.neu.x)
	y=const(velocity.jump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; normal_fwd
[statedef 142001]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=0
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.jump.fwd.x)
	y=const(velocity.jump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; normal_back
[statedef 142002]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=-1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=0
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.jump.back.x)
	y=const(velocity.jump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; long
[statedef 142010]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=1
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.jump.neu.x)
	y=const(velocity.runjump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; long_fwd
[statedef 142011]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=1
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.runjump.fwd.x)
	y=const(velocity.runjump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; long_back
[statedef 142012]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=-1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=1
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x=const(velocity.runjump.back.x)
	y=const(velocity.runjump.y)
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; small
[statedef 142020]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=2
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.jump.neu.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; small_fwd
[statedef 142021]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=2
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.jump.fwd.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; small_back
[statedef 142022]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=-1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=1
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.jump.back.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; mid
[statedef 142030]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=3
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.jump.neu.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; mid_fwd
[statedef 142031]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=3
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.runjump.fwd.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1
;----------------
; mid_back
[statedef 142032]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0
facep2=1
[state 0] ;[.00]
	type=varset
	trigger1=!time
	sysvar(1)=-1
[state 0] ;[.01]
	type=varset
	trigger1=!time
	sysfvar(1)=3
[state 0] ;[.02]
	type=velset
	trigger1=animtime=0
	x= const(velocity.runjump.back.x)
	y=-const(movement.yaccel)*13.32
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=50
	ctrl=1

;------------------------
; Low Jump > Leap Attack ; 低ジャンプ → リープアタック
; Jump start
;------------------------
[statedef 48]
type=s
physics=s
anim=40
sprpriority=1
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=velset
	trigger1=animtime=0
	x=ifelse(command="holdfwd",const(velocity.walk.fwd.x),ifelse(command="holdback",const(velocity.walk.back.x),0))
	y=-const(movement.yaccel)*12.5
; ai_vel
[state 0] ;[.01]
	type=velset
	trigger1=animtime=0 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>1 && (p2bodydist x>36)
	x=const(velocity.walk.fwd.x)
[state 0] ;[.02]
	type=ctrlset
	trigger1=(vel y>1.82)
	value=1
[state 0] ;[.03]
	type=changestate
	trigger1=animtime=0
	value=58
	ctrl=0


;------------------------
;------------------------
; Guard (start)
[statedef 120]
type=u    ; leave state type unchanged
physics=u ; leave physics unchanged

[state 0] ;[.00]
	type=changeanim
	trigger1=1 ;; !time ;;<- ** edited
	value=120+(statetype=c)+(statetype=a)*2

[state 0] ;[.01]
	type=statetypeset
	trigger1=!time && statetype=s
	physics=s
[state 0] ;[.02]
	type=statetypeset
	trigger1=!time && statetype=c
	physics=c
[state 0] ;[.03]
	type=statetypeset
	trigger1=!time && statetype=a
	physics=a

[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.05]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

;;--- ai-flag
[state 0] ;[.06]
	type=varset
	trigger1=!time
	sysvar(2)=0
[state 0] ;[.08]
	type=varset
	trigger1=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(51)>0
	sysvar(2)=playerid(floor(sysfvar(0))),var(51)
;---
[state 0] ;[.09] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c ;; default
	physics=c
[state 0] ;[.10] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s
;---
[state 0] ;[.11]
	type=changestate
	trigger1=animtime=0
	value=130+(statetype=c)+(statetype=a)*2
;---
[state 0] ;[.12]
	type=changestate
	trigger1=command!="holdback" && sysvar(2)=0
	trigger2=!inguarddist
	value=140

;; added
[state 0] ;[.13]
	type=velset
	trigger1=(pos y>=0)
	x=0

;------------------------
; Stand Guard (guarding)
[statedef 130]
type=s
physics=s

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0
[state 0] ;[.01] ; stop voice
	type=stopsnd
	trigger1=!time
	channel=0

[state 0] ;[.02]
	type=changeanim
	trigger1=anim!=130
	value=130

[state 0] ;[.03] ; ai_g
	type=changestate
	trigger1=sysvar(2)>0
	trigger1=time>0 && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	value=131

[state 0] ;[.04]
	type=changestate
	trigger1=command="holddown" && sysvar(2)=0
	value=131
[state 0] ;[.05]
	type=changestate
	trigger1=command!="holdback" && sysvar(2)=0
	trigger2=!inguarddist
	value=140

;------------------------
; Crouch Guard (Guarding)
[statedef 131]
type=c
physics=c

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0
[state 0] ;[.01] ; stop voice
	type=stopsnd
	trigger1=!time
	channel=0

[state 0] ;[.02]
	type=changeanim
	trigger1=anim!=131
	value=131

[state 0] ;[.03] ; ai_g
	type=changestate
	trigger1=sysvar(2)>0
	trigger1=time>0 && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	value=130

[state 0] ;[.04]
	type=changestate
	trigger1=command!="holddown" && sysvar(2)=0
	value=130
[state 0] ;[.05]
	type=changestate
	trigger1=command!="holdback" && sysvar(2)=0
	trigger2=!inguarddist
	value=140

;------------------------
; Air Guard (Guarding)
[statedef 132]
type=a
physics=n

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0
[state 0] ;[.01] ; stop voice
	type=stopsnd
	trigger1=!time
	channel=0

[state 0] ;[.02]
	type=changeanim
	trigger1=anim!=132
	value=132
[state 0] ;[.03]
	type=veladd
	trigger1=1
	y=const(movement.yaccel)
[state 0] ;[.04]
	type=varset
	trigger1=1
	sysvar(0)=(pos y+vel y>=0) && (vel y>0)
[state 0] ;[.05]
	type=velset
	trigger1=sysvar(0)
	y=0
[state 0] ;[.06]
	type=posset
	trigger1=sysvar(0)
	y=0
[state 0] ;[.07]
	type=changestate
	trigger1=sysvar(0) && command="holdback" && inguarddist
	value=130
[state 0] ;[.08]
	type=changestate
	trigger1=sysvar(0)
	value=52
[state 0] ;[.09]
	type=changestate
	trigger1=command!="holdback" && sysvar(2)=0
	trigger2=!inguarddist
	value=140

;------------------------
; Guard (End)
[statedef 140]
type=u    ; leave state type unchanged
physics=u ; leave physics unchanged
ctrl=1
[state 0] ;[.00]
	type=changeanim
	trigger1=!time
	value=140+(statetype=c)+(statetype=a)*2
[state 0] ;[.01]
	type=statetypeset
	trigger1=!time && statetype=s
	physics=s
[state 0] ;[.02]
	type=statetypeset
	trigger1=!time && statetype=c
	physics=c
[state 0] ;[.03]
	type=statetypeset
	trigger1=!time && statetype=a
	physics=a
[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.05]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

[state 0] ;[.06] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c
	physics=c
[state 0] ;[.07] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s

;[state 0] ;[.08] ; implemented within engine
;type=changestate
;trigger1=animtime=0
;value=(statetype=c)*11+(statetype=a)*51

;------------------------
; Stand Guard Hit (Shaking/Get Hit)
[statedef 150]
type=s
movetype=h
physics=n
velset=0,0

[state 0] ;[.00]
	type=changeanim
	trigger1=1
	value=150

[state 0] ;[.01] ; ai_g
	type=changestate
	trigger1=hitshakeover
	trigger1=sysvar(2)>0
	trigger1=(p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	value=153

[state 0] ;[.02]
	type=changestate
	trigger1=hitshakeover
	value=151+2*(command="holddown")
[state 0] ;[.03]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

[state 0] ;[.05] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c
	physics=c
[state 0] ;[.06] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time &&  gethitvar(ctrltime)>0 && playeridexist(gethitvar(ctrltime))
	trigger1= playerid(gethitvar(ctrltime)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(ctrltime)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; standing_guard_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(ctrltime)),const(size.yscale)+playerid(gethitvar(ctrltime)),pos y-pos y)
	size.height=40+playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))%10 ;;<-hit_spark
	ignorehitpause=1
	persistent=0

;--- ---
; guard crush ; ガードクラッシュ
;--- ---
[state 0] ;[.08]
	type=palfx
	trigger1=(gametime%5=0) && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(36)>=40)
	time=2
	add=200,0,0
[state 0] ;[.09]
	type=changestate
	trigger1=alive && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(36)>=50)
	value=190010
	ignorehitpause=1

;------------------------
;------------------------
; S Guard Hit 2 (Knocked Back)
[statedef 151]
type=s
movetype=h
physics=s
anim=150

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1
[state 0] ;[.01]
	type=velset
	trigger1=time=gethitvar(slidetime)
	trigger2=hitover
	x=0

;ed;[state 0] ;[.02]
;ed;	type=ctrlset
;ed;	trigger1=time>=gethitvar(ctrltime)
;ed;	value=1

[state 0] ;[.03]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

[state 0] ;[.05] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c
	physics=c
[state 0] ;[.06] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s

;---
[state 0] ;[.07]
	type=changestate
	trigger1=hitover
	value=130
	ctrl=1

;------------------------
;------------------------
; C Guard Hit (Dhaking)
[statedef 152]
type=c
movetype=h
physics=n
velset=0,0

[state 0] ;[.00]
	type=changeanim
	trigger1=1
	value=151

[state 0] ;[.01] ; ai_g
	type=changestate
	trigger1=hitshakeover
	trigger1=sysvar(2)>0
	trigger1=(p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	value=153

[state 0] ;[.02]
	type=changestate
	trigger1=hitshakeover
	value=151+2*(command="holddown")
[state 0] ;[.03]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

[state 0] ;[.05] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c
	physics=c
[state 0] ;[.06] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time &&  gethitvar(ctrltime)>0 && playeridexist(gethitvar(ctrltime))
	trigger1= playerid(gethitvar(ctrltime)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(ctrltime)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; crouching_guard_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(ctrltime)),const(size.yscale)+playerid(gethitvar(ctrltime)),pos y-pos y)
	size.height=40+playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))%10 ;;<-hit_spark
	ignorehitpause=1
	persistent=0

;--- ---
; guard crush ; ガードクラッシュ
;--- ---
[state 0] ;[.08]
	type=palfx
	trigger1=!time && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(36)>=40)
	time=2
	add=200,0,0
[state 0] ;[.09]
	type=changestate
	trigger1=sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(36)>=50)
	value=190010
	ignorehitpause=1

;------------------------
;------------------------
; C Guard Hit 2 (Knocked Back)
[statedef 153]
type=c
movetype=h
physics=c
anim=151

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1
[state 0] ;[.01]
	type=velset
	trigger1=time=gethitvar(slidetime)
	trigger2=hitover
	x=0

;ed;[state 0] ;[.02]
;ed;	type=ctrlset
;ed;	trigger1=time>=gethitvar(ctrltime)
;ed;	value=1

[state 0] ;[.03]
	type=statetypeset
	trigger1=statetype=s && command="holddown"
	statetype=c
	physics=c
[state 0] ;[.04]
	type=statetypeset
	trigger1=statetype=c && command!="holddown"
	statetype=s
	physics=s

[state 0] ;[.05] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=s && (p2statetype=c || enemynear,hitdefattr=c,na,sa,ha)
	statetype=c
	physics=c
[state 0] ;[.06] ; ai_g
	type=statetypeset
	trigger1=sysvar(2)>0
	trigger1=statetype=c && (p2statetype=s || p2statetype=a || enemynear,hitdefattr=sa,na,sa,ha)
	statetype=s
	physics=s

;---
[state 0] ;[.07]
	type=changestate
	trigger1=hitover
	value=131
	ctrl=1

;------------------------
;------------------------
; Air Guard Hit (Shaking) ; 空中ガード中
[statedef 154]
type=a
movetype=h
physics=n
velset=0,0

[state 0] ;[.00]
	type=changeanim
	trigger1=1
	value=152
[state 0] ;[.01]
	type=changestate
	trigger1=hitshakeover
	value=155 ; aguardhit2

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time &&  gethitvar(ctrltime)>0 && playeridexist(gethitvar(ctrltime))
	trigger1= playerid(gethitvar(ctrltime)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(ctrltime)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; crouching_guard_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(ctrltime)),const(size.yscale)+playerid(gethitvar(ctrltime)),pos y-pos y)
	size.height=40+playerid(gethitvar(ctrltime)),var(-playerid(gethitvar(ctrltime)),const(data.sparkno))%10 ;;<-hit_spark
	ignorehitpause=1
	persistent=0

;------------------------
;------------------------
; A Guard Hit 2 (Knocked Away) ; 空中ガード後
[statedef 155]
type=a
movetype=h
physics=n
anim=152

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1
	y=1
[state 0] ;[.01]
	type=veladd
	trigger1=1
	y=const(movement.yaccel)

;---edit------
;or;[state 0] ;[.02]
;or;	type=ctrlset
;or;	trigger1=time>=gethitvar(ctrltime)
;or;	value=1
;---edit------

[state 0] ;[.03]
	type=varset
	trigger1=1
	sysvar(0)=(vel y>0) && (pos y+vel y>=0)
[state 0] ;[.04]
	type=velset
	trigger1=sysvar(0)
	y=0
[state 0] ;[.05]
	type=posset
	trigger1=sysvar(0)
	y=0
[state 0] ;[.06]
	type=changestate
	trigger1=sysvar(0) && command="holdback" && inguarddist
	value=130
[state 0] ;[.07]
	type=changestate
	trigger1=sysvar(0)
	value=52


;------------------------
;------------------------
; Lose / Time Over
[statedef 170]
type=s
anim=ifelse(selfanimexist(170),170,175)
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
	time=1

;------------------------
;------------------------
; DrawGame / Time Over
[statedef 175]
type=s
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=changestate
	trigger1=!time && !selfanimexist(175)
	value=170
[state 0] ;[.01]
	type=changeanim
	trigger1=!time
	value=175
[state 0] ;[.02]
	type=nothitby
	trigger1=1
	value=sca
	time=1

;------------------------
;------------------------
; PreIntro
[statedef 190]
type=s
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=changeanim
	trigger1=selfanimexist(190)
	value=190

; go straight to intro.
[state 0] ;[.01]
	type=changestate
	trigger1=!time
	value=191

;------------------------
;------------------------
; Intro (override this state to give character an intro)
[statedef 191]
type=s
ctrl=0

[state 0] ;[.00]
	type=changestate
	trigger1=!time
	value=0


;------------------------
;------------------------
; hit_shake
;------------------------
[statedef 5000]
type=s
movetype=h
physics=n
velset=0,0

;;--- <<IKEMENには無用>>
;--- helper for chasing target after Reflecsion ; 飛び道具反射後追跡用ヘルパー
[state 0] ;[.00]
	type=helper
	trigger1=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	id=91050
	stateno=91050
	ownpal=1
	size.height=gethitvar(fall.envshake.time) ;;<-=ID
	ignorehitpause=1
	persistent=0

;;--- clean helpers ; ヘルパー掃除
;; WinMUGEN
;; -飛び道具反射用ヘルパー：０フレームで消すとムゲンが落ちる

[state 0] ;[.01ds]
	type=selfstate
	trigger1=ishelper(90900)
	trigger2=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger3=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	value=159990
	ignorehitpause=1

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time && gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; standing_hit_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(fall.envshake.time)),const(size.yscale)+playerid(gethitvar(fall.envshake.time)),pos y-pos y)
	size.height=  playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))%10 ;;<-hit_spark
	facing=ifelse(playerid(gethitvar(fall.envshake.time)),facing=facing,-1,1)
	ignorehitpause=1
	persistent=0

;---
[state 0] ;[.03] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

; Cheap KO down ; 崩れダウン
[state 0] ;[.04]
	type=selfstate
	triggerall=!time && (gethitvar(damage)>=life) && selfanimexist(195200)
	trigger1=(prevstateno=[120,153])
	trigger2=gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger2=playerid(gethitvar(fall.envshake.time)),movecontact && playerid(gethitvar(fall.envshake.time)),var(31)%5=0 ;; hit_spark
	value=195200
	ignorehitpause=1
;; gethitvar(animtype): (0 for light, 1 for medium, 2 for hard, 3 for back, 4 for up, 5 for diag-up)

;---
; anim for hit_light to hit_hard
[state 0] ;[.10]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)!=[3,5])
	value=ifelse((gethitvar(groundtype)=1),5000,5010)+gethitvar(animtype)

; anim for hit_back
[state 0] ;[.11]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)=[3,5])
	value=5030

; anim for hit_up/hit_diagup (only if it exists)
[state 0] ;[.12]
	type=changeanim
	trigger1=(!time || hitshakeover) && (gethitvar(animtype)=[4,5]) && (selfanimexist(5047+gethitvar(animtype)))
	value=5047 + gethitvar(animtype)

; freeze anim
[state 0] ;[.15]
	type=changeanim
	trigger1=time>0
	value=anim

; state type gets set to aerial if getting hit up
[state 0] ;[.16]
	type=statetypeset
	trigger1=!time && ((gethitvar(yvel)!=0) || (gethitvar(fall)))
	trigger2=pos y<0
	statetype=a

;--- added***
[state 0] ;[.20]
	type=changeanim
	trigger1=!time && gethitvar(fall) && selfanimexist(195200)
	value=5017

;---
[state 0] ;[.30]
	type=changestate
	trigger1=hitshakeover && gethitvar(yvel)=0 && !gethitvar(fall)
	value=5001 ;;<-hitg_slide

[state 0] ;[.31]
	type=changestate
	trigger1=hitshakeover
	value=5030
	anim=ifelse((anim=[5015,5017]),5030,anim)

;------------------------
;------------------------
; Hit Slide
[statedef 5001]
type=s
movetype=h
physics=s

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1

[state 0] ;[.01]
	type=changeanim
	trigger1=animtime=0
	value=5005+gethitvar(animtype)+(gethitvar(groundtype)=2)*10

; stop sliding back
[state 0] ;[.02]
	type=velmul
	trigger1=time>=gethitvar(slidetime)
	x=0.6

[state 0] ;[.03]
	type=velset
	trigger1=hitover
	x=0

;---
; dizzy bg
[state 0] ;[.04]
	type=helper
	trigger1=gethitvar(hittime)=0 && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000 && !numhelper(88892) && !numhelper(403000)
	id=88892
	stateno=88892
	ownpal=1
	persistent=0
; dizzy birds
[state 0] ;[.05]
	type=helper
	trigger1=gethitvar(hittime)=0 && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000 && !numhelper(403000)
	id=403000
	stateno=190140
	ownpal=1
	size.height=ifelse(life<200,3,(random%3))
	persistent=0
;--- dizzy
[state 0] ;[.06d]
	type=selfstate
	trigger1=hitover && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195201 ;; (goto-dizzy:190116)
;---
[state 0] ;[.07]
	type=changestate
	trigger1=hitover
	value=0
	ctrl=1

;------------------------
;------------------------
; Hit Shake C
[statedef 5010]
type=c
movetype=h
physics=n
velset=0,0

;;--- <<IKEMENには無用>>
;--- helper for chasing target after Reflecsion ; 飛び道具反射後追跡用ヘルパー
[state 0] ;[.00]
	type=helper
	trigger1=ishelper
	trigger1=(var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	id=91050
	stateno=91050
	ownpal=1
	size.height=gethitvar(fall.envshake.time) ;;<-=ID
	ignorehitpause=1
	persistent=0

;--- clean helpers ; ヘルパー掃除
[state 0] ;[.01]
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900)
	value=159990
	ignorehitpause=1

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time && gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; crouching_hit_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(fall.envshake.time)),const(size.yscale)+playerid(gethitvar(fall.envshake.time)),pos y-pos y)
	size.height=  playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))%10 ;;<-hit_spark
	facing=ifelse(playerid(gethitvar(fall.envshake.time)),facing=facing,-1,1)
	ignorehitpause=1
	persistent=0

;---
[state 0] ;[.03] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

;---
; anim for hit_light to hit_hard
[state 0] ;[.10]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)!=[3,5])
	value=5020+gethitvar(animtype)

; anim for hit_back
[state 0] ;[.11]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)=[3,5])
	value=5030

; anim for hit_up/hit_diagup (only if it exists)
[state 0] ;[.12]
	type=changeanim
	trigger1=(!time || hitshakeover) && (gethitvar(animtype)=[4,5]) && (selfanimexist(5047+gethitvar(animtype)))
	value=5047 + gethitvar(animtype)

; freeze anim
[state 0] ;[.15]
	type=changeanim
	trigger1=time>0
	value=anim

; state type gets set to aerial if getting hit up
[state 0] ;[.16]
	type=statetypeset
	trigger1=!time && ((gethitvar(yvel)!=0) || (gethitvar(fall)))
	trigger2=pos y<0
	statetype=a

;--- added***
[state 0] ;[.20]
	type=changeanim
	trigger1=!time && gethitvar(fall) && selfanimexist(195200)
	value=5017

;---
[state 0] ;[.30]
	type=changestate
	trigger1=hitshakeover && gethitvar(yvel)=0 && !gethitvar(fall)
	value=5011 ;;<-hitc_slide

[state 0] ;[.31]
	type=changestate
	trigger1=hitshakeover
	value=5030
	anim=ifelse((anim=[5015,5017]),5030,anim)

;------------------------
;------------------------
; Hit Slide C
[statedef 5011]
type=c
movetype=h
physics=c

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1

[state 0] ;[.01]
	type=changeanim
	trigger1=animtime=0
	value=5025 + gethitvar(animtype)

[state 0] ;[.02] ; stop sliding back
	type=velmul
	trigger1=time>=gethitvar(slidetime)
	x=0.6

[state 0] ;[.03]
	type=velset
	trigger1=hitover
	x=0

;---
; dizzy bg
[state 0] ;[.04]
	type=helper
	trigger1=gethitvar(hittime)=0 && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000 && !numhelper(88892) && !numhelper(403000)
	id=88892
	stateno=88892
	ownpal=1
	persistent=0
; dizzy birds
[state 0] ;[.05]
	type=helper
	trigger1=gethitvar(hittime)=0 && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000 && !numhelper(403000)
	id=403000
	stateno=190140
	ownpal=1
	size.height=ifelse(life<200,3,(random%3))
	persistent=0
;--- dizzy
[state 0] ;[.06d]
	type=selfstate
	trigger1=hitover && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195201 ;; (goto-dizzy:190116)
;---
[state 0] ;[.07]
	type=changestate
	trigger1=hitover
	value=11
	ctrl=1

;------------------------
; Hit Shake Air
;------------------------
[statedef 5020]
type=a
movetype=h
physics=n
velset=0,0

;;--- <<IKEMENには無用>>
;--- helper for chasing target after Reflecsion ; 飛び道具反射後追跡用ヘルパー
[state 0] ;[.00]
	type=helper
	trigger1=ishelper
	trigger1=(var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	id=91050
	stateno=91050
	ownpal=1
	size.height=gethitvar(fall.envshake.time) ;;<-=ID
	ignorehitpause=1
	persistent=0

;--- clean helpers ; ヘルパー掃除
[state 0] ;[.01]
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900)
	value=159990
	ignorehitpause=1

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time && gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; air_hit_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(fall.envshake.time)),const(size.yscale)+playerid(gethitvar(fall.envshake.time)),pos y-pos y)
	size.height=  playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))%10 ;;<-hit_spark
	facing=ifelse(playerid(gethitvar(fall.envshake.time)),facing=facing,-1,1)
	ignorehitpause=1
	persistent=0

;---
[state 0] ;[.03] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

;---
; anim for hit_light to hit_hard
[state 0] ;[.10]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)!=[3,5])
	value=ifelse((gethitvar(airtype)=1),5000,5010)+gethitvar(animtype)

; anim for hit_back
[state 0] ;[.11]
	type=changeanim
	trigger1=!time && (gethitvar(animtype)=[3,5])
	value=5030 ;;<-air hit back

; anim for hit_up/hit_diagup (only if it exists)
[state 0] ;[.12]
	type=changeanim
	trigger1=(!time || hitshakeover) && (gethitvar(animtype)=[4,5]) && (selfanimexist(5047+gethitvar(animtype)))
	value=5047+gethitvar(animtype)

; freeze anim
[state 0] ;[.15]
	type=changeanim
	trigger1=time>0
	value=anim

;;--- added***
[state 0] ;[.20]
	type=changeanim
	trigger1=!time && selfanimexist(195200)
	value=ifelse( gethitvar(fall)||gethitvar(groundtype)=2||gethitvar(airtype)=2, 5017, 5030)

;---
[state 0] ;[.31]
	type=changestate
	trigger1=hitshakeover
	value=5030
	anim=ifelse((anim=[5015,5017]),5030,anim)

;------------------------
;------------------------
; Hit Up Air (initial going up)
[statedef 5030]
type=a
movetype=h
physics=n
ctrl=0

;;--- <<IKEMENには無用>>
;--- helper for chasing target after Reflecsion ; 飛び道具反射後追跡用ヘルパー
[state 0] ;[.00]
	type=helper
	trigger1=ishelper
	trigger1=(var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	id=91050
	stateno=91050
	ownpal=1
	size.height=gethitvar(fall.envshake.time) ;;<-=ID
	ignorehitpause=1
	persistent=0

;--- clean helpers ; ヘルパー掃除
[state 0] ;[.01]
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900)
	value=159990
	ignorehitpause=1

[state 0] ;[.02]
	type=changeanim
	trigger1=selfanimexist(5030)
	trigger1=(anim!=[5000,5199])
	value=5030

[state 0] ;[.03]
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)
[state 0] ;[.04]
	type=hitvelset
	trigger1=!time
	x=1
	y=1

;;;--- dizzy
[state 0] ;[.06d]
	type=selfstate
	trigger1=hitshakeover && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195050

;---
[state 0] ;[.07]
	type=changestate
	trigger1=(!hitfall)
	trigger1=hitover || ((vel y>0) && (pos y+vel y>=0))
	value=5040 ;; hita_recov
[state 0] ;[.08]
	type=changestate
	trigger1=(hitfall)
	trigger1=hitover || ((vel y>0) && (pos y+vel y>=0))
	value=5050 ;; hita_fall
;---
[state 0] ;[.09]
	type=changestate
	trigger1=(animtime=0)
	value=5035 ;; hita_up (transition)

;------------------------
;------------------------
; Hit Up A (Transition)
[statedef 5035]
type=a
movetype=h
physics=n

[state 0] ;[.00]
	type=changeanim
	trigger1=!time && selfanimexist(5035)
	trigger1=(anim!=[5051,5059]) ;; not if in hit up anim
	trigger1=(anim!=5090) ;; not if hit off ground anim
	value=5035
[state 0] ;[.01]
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)

; recovering in air(not-falling)
[state 0] ;[.02]
	type=changestate
	triggerall=!hitfall
	trigger1=hitover
	trigger2=(animtime=0)
	trigger3=(vel y>0) && (pos y>=0) ;;v1.0; ;const(movement.air.gethit.groundlevel)
	trigger4=!time && anim!=5035
	value=5040

; air get-hit(falling)
[state 0] ;[.03]
	type=changestate
	triggerall=hitfall
	trigger1=hitover
	trigger2=(animtime=0)
	trigger3=(vel y>0) && (pos y>=0) ;;v1.0; ;const(movement.air.gethit.groundlevel)
	trigger4=!time && anim!=5035
	value=5050

;------------------------
;------------------------
; Hit A Recov (Recovering in air, not falling) 
; 空中体勢回復後>落下中 (無敵+操作不可)
[statedef 5040]
type=a
movetype=h
physics=n

[state 0] ;[.00]
	type=changestate
	trigger1=!alive
	value=5050
	ctrl=0
[state 0] ;[.01]
	type=changeanim
	trigger1=(animtime=0) && anim!=5040
	trigger2=!time && anim!=5035
	value=5040

;---edit-----------
;or;[state 0] ;[.02]
;or;	type=ctrlset
;or;	trigger1=hitover
;or;	value=1

[state 0] ;[.03] ; edited
	type=ctrlset
	trigger1=1
	value=0
[state 0] ;[.04]
	type=nothitby
	trigger1=hitover
	value=sca
	time=3
;---edit------------

[state 0] ;[.05]
	type=statetypeset
	trigger1=hitover
	movetype=i
[state 0] ;[.06]
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)
[state 0] ;[.07]
	type=changestate
	trigger1=(vel y>0) && (pos y+vel y>=0)
	value=52 ;;<-jump_land

;------------------------
;------------------------
; Hit Fall A (Knocked up, Falling)
[statedef 5050]
type=a
movetype=h
physics=n

; change anim when done with transition
[state 0] ;[.00]
	type=changeanim
	trigger1=anim=5035 && (animtime=0)
	trigger2=!time && anim!=5035 ;;<-if no transition anim
	trigger2=(anim!=[5051,5059]) && (anim!=[5061,5069])
	trigger2=anim!=5090 ;;<-not if hit off ground anim
	value=5050

; coming down anim
[state 0] ;[.01]
	type=changeanim
	triggerall=(anim=[5050,5059]) && selfanimexist(anim+10)
	trigger1=anim=5050 && vel y>=-1
	trigger2=anim=5051 && vel y>=0
	trigger3=anim=[5052,5059]
	trigger3=vel y>=0 ;v1.0; ;ifelse(anim=5050,const720p(4),const720p(-8))
	trigger3=animtime=0 || time>12
	value=anim+10
	persistent=0

[state 0] ;[.02] ; gravity
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)

;; edited
;[state 0] ;[.03]
;	type=velset
;	trigger1=!time && !alive && roundstate=2
;	x=vel x*0.5

;; recover near ground
[state 0] ;[.04]
	type=changestate
	trigger1=(vel y>0) && (pos y>=const(movement.air.gethit.groundrecover.ground.threshold))
	trigger1=alive && canrecover && (command="recovery" || command="holdback")
	value=5200 ;;< air get-hit (fall recovery on ground)
;; recover in mid air
[state 0] ;[.04a]
	type=changestate
	trigger1=(vel y>const(movement.air.gethit.airrecover.threshold))
	trigger1=alive && canrecover && (command="recovery") && !selfanimexist(195200)
	value=5210 ;;< air get-hit (fall recovery in air)
; downed get-hit (hit ground from fall)
[state 0] ;[.05]
	type=changestate
	trigger1=(vel y>0) && (pos y>=ifelse((anim=[5051,5059])||(anim=[5061,5069]), 0, const(movement.air.gethit.groundlevel)))
	value=5100 ;;< down get-hit (hit ground from fall)

;------------------------
;------------------------
; Hit Trip (Shaking)
[statedef 5070]
type=a
movetype=h
physics=n
velset=0,0

;--- clean helpers ; ヘルパー掃除
[state 0] ;[.01]
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900)
	value=159990
	ignorehitpause=1

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time && gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; trip_hit_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(fall.envshake.time)),const(size.yscale)+playerid(gethitvar(fall.envshake.time)),pos y-pos y)
	size.height=  playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))%10 ;;<-hit_spark
	facing=ifelse(playerid(gethitvar(fall.envshake.time)),facing=facing,-1,1)
	ignorehitpause=1
	persistent=0

;---
[state 0] ;[.03] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

[state 0] ;[.04]
	type=changeanim
	trigger1=1
	value=5070
[state 0] ;[.05]
	type=changestate
	trigger1=hitshakeover
	value=5071

;------------------------
;------------------------
; Hit Trip 2 (Fall through air)
[statedef 5071]
type=a
movetype=h
physics=n

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1
	y=1

; acceleration
[state 0] ;[.01]
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)

; edited
[state 0] ;[.02]
	type=velset
	trigger1=!time && !alive
	x=vel x*0.5

;;--- dizzy
[state 0] ;[.06d]
	type=selfstate
	trigger1=hitshakeover && roundstate=2 && !ishelper && alive && life>1 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195050

;---
[state 0] ;[.05]
	type=varset
	trigger1=!time
	sysvar(1)=0
[state 0] ;[.06]
	type=varset
	triggerall=time && alive && roundstate=2
	trigger1=command="x"||command="y"||command="a"||command="b"||command="holdback"||command="holddown"
;v1.0;	trigger2=ailevel>0
	trigger2=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger2=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(51)>0)
	trigger2=random<90
	sysvar(1)=10
;---
[state 0] ;[.07]
	type=changestate
	trigger1=time && roundstate=2 && sysvar(1)=10
	trigger1=(vel y>0) && (pos y+vel y>=0)
	value=5201
;---
; hit ground ;/ edited
[state 0] ;[.08]
	type=changestate
	trigger1=(vel y>0) && (pos y>=const(movement.air.gethit.trip.groundlevel))
	;---
	trigger2=(const(movement.air.gethit.trip.groundlevel)=0) ;;[ def=0 ?? ]
	trigger2=(vel y>0) && (pos y+vel y>=0)
	value=5100 ;;<-5101

;------------------------
;------------------------
; Hit Shake L
[statedef 5080]
type=l
movetype=h
physics=n
velset=0,0

;--- clean helpers ; ヘルパー掃除
[state 0] ;[.01]
	type=selfstate
	trigger1=ishelper(99997) && (var(57)=11111) && (var(58)=22222) && (var(59)=33333)
	trigger2=ishelper && (var(15)=10311) && (var(16)=10212) && (var(17)=10113) && (var(18)=30636)
	trigger3=ishelper(90900)
	value=159990
	ignorehitpause=1

;--- ---
; sysvar(0): player_spark_xy
[state 0] ;[.07p1]
	type=varset
	trigger1=!time
	sysvar(0)=0
	ignorehitpause=1
	persistent=0
[state 0] ;[.07p2]
	type=varset
	trigger1=!time && gethitvar(fall.envshake.time)>0 && gethitvar(fall.envshake.ampl)=0 && playeridexist(gethitvar(fall.envshake.time))
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.sparkno)<-1       ;;<-var(#1)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))>=0      ;;<-spark_no
	trigger1= playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno)<-1 ;;<-var(#2)
	trigger1= playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))>0 ;;<-spark_xy
	sysvar(0)=playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.guard.sparkno))
	ignorehitpause=1
	persistent=0
; liedown_hit_spark
[state 0] ;[.07]
	type=helper
	trigger1=!time && sysvar(0)>0
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=(((sysvar(0)/1000)%1000)-500),ceil((500-(sysvar(0)%1000))*playerid(gethitvar(fall.envshake.time)),const(size.yscale)+playerid(gethitvar(fall.envshake.time)),pos y-pos y)
	size.height=  playerid(gethitvar(fall.envshake.time)),var(-playerid(gethitvar(fall.envshake.time)),const(data.sparkno))%10 ;;<-hit_spark
	facing=ifelse(playerid(gethitvar(fall.envshake.time)),facing=facing,-1,1)
	ignorehitpause=1
	persistent=0

;---
[state 0] ;[.03] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

; set default anim
[state 0] ;[.04]
	type=varset
	trigger1=!time
	sysvar(2)=ifelse(gethitvar(yvel)=0,5080,5090)

[state 0] ;[.05]
	type=varadd
	trigger1=!time
	trigger1=(anim=[5081,5089])||(anim=[5111,5119])
	trigger1=selfanimexist(sysvar(2)+(anim%10))
	sysvar(2)=(anim%10)

; if 5090 doesn't exist
[state 0] ;[.06]
	type=varset
	trigger1=!time && sysvar(2)=5090 && !selfanimexist(5090)
	sysvar(2)=5030

[state 0] ;[.07] ; freeze
	type=changeanim
	trigger1=1
	value=sysvar(2)

[state 0] ;[.08]
	type=changestate
	trigger1=hitshakeover && gethitvar(yvel)=0
	value=5081 ;;<-hitl_slide
[state 0] ;[.09]
	type=changestate
	trigger1=hitshakeover && gethitvar(yvel)!=0
	value=5030 ;;<-hita_up

;------------------------
;------------------------
; Hit Slide L
[statedef 5081]
type=l
movetype=h
physics=c

[state 0] ;[.00]
	type=hitvelset
	trigger1=!time
	x=1
[state 0] ;[.01]
	type=velset
	trigger1=hitover
	x=0

;; don't show hit ground frame
[state 0] ;[.02]
	type=varset
	trigger1=!time
	sysvar(0)=1
[state 0] ;[.03]
	type=changestate
	trigger1=hitover
	value=5110 ;;<-hit_liedown

;------------------------
;------------------------
; Hit Bounce (Hit Ground)
[statedef 5100]
type=l
movetype=h
physics=n

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

[state 0] ;[.01]
	type=fallenvshake
	trigger1=!time

[state 0] ;[.02] ;; save fall velocity
	type=varset
	trigger1=!time
	sysvar(1)=floor(vel y)
[state 0] ;[.03]
	type=changeanim
	triggerall=!time
	trigger1=(anim!=[5051,5059])&&(anim!=[5061,5069])
	trigger2=!selfanimexist(5100+(anim%10))
	value=5100
[state 0] ;[.04]
	type=changeanim
	trigger1=!time
	trigger1=(anim=[5051,5059])||(anim=[5061,5069])
	trigger1=selfanimexist(5100+(anim%10))
	value=5100+(anim%10)
[state 0] ;[.05]
	type=posset
	trigger1=!time
	y=0
[state 0] ;[.06]
	type=velset
	trigger1=!time
	y=0
[state 0] ;[.07]
	type=velmul
	trigger1=!time
	x=0.75

[state 0] ;[.08]
	type=changestate
	trigger1=!time && (gethitvar(fall.yvel)=0)
	value=5110 ;; downed get-hit (lying down)
[state 0] ;[.09]
	type=hitfalldamage
	trigger1=time=3

[state 0] ;[.10]
	type=posfreeze
	trigger1=1
[state 0] ;[.11]
	type=changestate
	trigger1=animtime=0
	value=5101

;------------------------
;------------------------
; Hit Bounce (Bounce into air)
[statedef 5101]
type=l
movetype=h
physics=n

[state 0] ;[.00]
	type=changeanim
	triggerall=!time
	trigger1=(anim!=[5101,5109])
	trigger2=!selfanimexist(5160+(anim%10))
	value=5160
[state 0] ;[.01]
	type=changeanim
	triggerall=!time
	trigger1=(anim=[5101,5109])
	trigger1=selfanimexist(5160+(anim%10))
	value=5160+(anim%10)

[state 0] ;[.02]
	type=hitfallvel
	trigger1=!time

; edited
[state 0] ;[.03]
	type=posset
	trigger1=!time
;;@	y=0 ;;<-edited
	y=const(movement.down.bounce.offset.y) ;;[ def=0 ?? ]

[state 0] ;[.04] ; *new v1.1
	type=posadd
	trigger1=!time
	x=const(movement.down.bounce.offset.x) ;;[ def=0 ?? ]
;; added
	y=ifelse(const(movement.down.bounce.offset.y)>-5, -5, const(movement.down.bounce.offset.y)) ;; added

;; acceleration
[state 0] ;[.05]
	type=veladd
	trigger1=1
;;@	y=const(movement.yaccel)*1.28 ;;<-edited
	y=const(movement.down.bounce.yaccel) ; v1.0

;; acceleration (edited)
[state 0] ;[.06]
	type=veladd
	trigger1=const(movement.down.bounce.yaccel)<const(movement.yaccel)*1.28
	y=0.2; 0.1

;---
;; hit ground (edited)
[state 0] ;[.07]
	type=changestate
	trigger1=pos y>=const(movement.down.bounce.groundlevel) && vel y>0
;; * "down.bounce.groundlevel=##"
	;---
;; added
;;old; trigger2=(vel y>0) && (pos y+vel y>=0)
	trigger2=(const(movement.down.bounce.groundlevel)=0) ;;[ def=0 ?? ]
	trigger2=(vel y>0) && (pos y>=10) ;; (pos y+vel y>=10) ;;## ="down.bounce.groundlevel"
	;---
	value=ifelse(selfanimexist(195200),5111,5110) ;;<-5110;;<-(def)

;------------------------
;------------------------
; Hit Liedown
[statedef 5110]
type=l
movetype=h
physics=n

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

[state 0] ;[.01]
	type=fallenvshake
	trigger1=!time

[state 0] ;[.01a1] ;; goto-dizzy_fd
	type=selfstate
	trigger1=alive && !ishelper && life>1 && roundstate=2 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195110

;; for hit up/up-diag type (from state 5081)
[state 0] ;[.02]
	type=changeanim
	trigger1=selfanimexist(5110+(anim%10))
	trigger1=(anim=[5081,5089])
	value=5110+(anim%10)
	persistent=0

;; hit ground anim (normal)
[state 0] ;[.03]
	type=changeanim
	triggerall=!time
	triggerall=(anim!=[5110,5119]) ;;<-not already changed anim
	trigger1=(anim!=[5161,5169])
	trigger2=!selfanimexist(5170+(anim%10))
	value=5170

;; hit ground anim (for hit up)
[state 0] ;[.04]
	type=changeanim
	triggerall=!time
	triggerall=(anim!=[5110,5119]) ;;<-not already changed anim
	trigger1=(anim=[5161,5169])
	trigger1=selfanimexist(5170+(anim%10))
	value=5170+(anim%10)

[state 0] ;[.05]
	type=hitfalldamage
	trigger1=!time
[state 0] ;[.06]
	type=posset
	trigger1=!time
	y=0
;---
[state 0] ;[.07] ;; *new v11 Get fall velocity
	type=varset
	trigger1=!time && gethitvar(fall.yvel)!=0
	sysvar(1)=floor(vel y)
;---
[state 0] ;[.08]
	type=velset
	trigger1=!time
	y=0

;; for hit up type
[state 0] ;[.09]
	type=changeanim
	triggerall=anim=[5171,5179]
	triggerall=selfanimexist(5110+(anim%10))
	trigger1=animtime=0
	trigger2=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground anim
	value=5110+(anim%10)
	persistent=0

;; for normal
[state 0] ;[.10]
	type=changeanim
	triggerall=anim!=[5111,5119]
	trigger1=animtime=0
	trigger2=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground frame
	value=5110
	persistent=0

;; if just died
[state 0] ;[.11]
	type=changestate
;;old;	triggerall=!alive
	triggerall=!alive && time>0
	trigger1=animtime=0
	trigger2=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground frame
	trigger3=anim=[5110,5119]
	value=5150

[state 0] ;[.12]
	type=varset
;;old;	trigger1=!time && sysvar(0)
	trigger1=time>0 && sysvar(0)
	sysvar(0)=0

;; friction
[state 0] ;[.13]
	type=velmul
	trigger1=1
	x=0.85

;; friction
[state 0] ;[.14]
	type=velset
	trigger1=time>abs(vel x)<const(movement.down.friction.threshold)
;;@	trigger1=time>3
	persistent=0
	x=0

;------------------------
;------------------------
; Hit LieDown custom*
[statedef 5111]
type=l
movetype=h
physics=n
velset=0,0
ctrl=0

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

[state 0] ;[.01]
	type=fallenvshake
	trigger1=!time

[state 0] ;[.01a1] ;; goto-dizzy_fd
	type=selfstate
	trigger1=alive && !ishelper && life>1 && roundstate=2 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195110

;; for hit up/up-diag type (from state 5081)
[state 0] ;[.02]
	type=changeanim
	trigger1=(anim=[5081,5089]) && selfanimexist(5110+(anim%10))
	value=5110+(anim%10)
	persistent=0

;; hit ground anim (normal)
[state 0] ;[.03]
	type=changeanim
	triggerall=!time && (anim!=[5110,5119]) ;;<-not already changed anim
	trigger1=(anim!=[5161,5169])
	trigger2=!selfanimexist(5170+(anim%10))
	value=5170

;; hit ground anim (for hit up)
[state 0] ;[.04]
	type=changeanim
	triggerall=!time && (anim!=[5110,5119]) ;;<-not already changed anim
	trigger1=(anim=[5161,5169])
	trigger1=selfanimexist(5170+(anim%10))
	value=5170+(anim%10)

[state 0] ;[.05]
	type=hitfalldamage
	trigger1=!time
[state 0] ;[.06]
	type=posset
	trigger1=!time
	y=0
;---
;; for hit up type
[state 0] ;[.07]
	type=changeanim
	triggerall=(anim=[5171,5179]) && selfanimexist(5110+(anim%10))
	trigger1=animtime=0
	trigger2=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground anim
	value=5110+(anim%10)
	persistent=0
; for normal
[state 0] ;[.08]
	type=changeanim
	triggerall=(anim!=[5111,5119])
	trigger1=animtime=0
	trigger2=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground frame
	value=5110
	persistent=0

;; if just died
[state 0] ;[.09]
	type=changestate
;;old;	triggerall=!alive
	triggerall=!alive && time>0
	trigger1=animtime=0
	trigger2=(anim=[5110,5119])
	trigger3=sysvar(0) ;;<-sysvar(0)=1 ;;avoids hit ground frame
	value=5150

[state 0] ;[.10]
	type=varset
;old;	trigger1=!time && sysvar(0)
	trigger1=time>0 && sysvar(0)
	sysvar(0)=0

;; friction
[state 0] ;[.11]
	type=velmul
	trigger1=1
	x=0.85

;; friction
[state 0] ;[.12]
	type=velset
;;v1.0;	trigger1=time>abs(vel x)<const(movement.down.friction.threshold)
	trigger1=time>3
	persistent=0
	x=0
;---
;; edited
[state 0] ;[.13]
	type=changestate
	trigger1=alive && (time=[2,3])
	trigger1=(command="holdup")||(command="holdback")||(command="holdfwd")
	value=5112 ;; quick standing
[state 0] ;[.14]
	type=changestate
	trigger1=time>28 ;; normal standing
	trigger1=(command!="holddown")
	trigger2=time>68 ;; delay standing
	value=5120

;------------------------
;------------------------
[statedef 5112]
type=l
movetype=h
physics=n
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
[state 0] ;[.01]
	type=changestate
	trigger1=1
	value=5120 ;;<-getup state

;------------------------
;------------------------
; Hit GetUp
[statedef 5120]
type=l
movetype=i
physics=n
ctrl=0

;; get up anim (normal)
[state 0] ;[.00]
	type=changeanim
	triggerall=!time
	trigger1=anim!=[5111,5119]
	trigger2=!selfanimexist(5120+(anim%10))
	value=5120

;; get up anim (for hit up/diag-up)
[state 0] ;[.01]
	type=changeanim
	triggerall=!time
	trigger1=anim=[5111,5119]
	trigger1=selfanimexist(5120+(anim%10))
	value=5120+(anim%10)
[state 0] ;[.02]
	type=velset
	trigger1=!time
	x=0
[state 0] ;[.03]
	type=nothitby
	trigger1=1
	value=sca
	time=1
[state 0] ;[.04]
	type=hitfallset
	trigger1=animtime=0
	value=1
[state 0] ;[.06]
	type=changestate
	trigger1=animtime=0
	value=0
	ctrl=1

;------------------------
;------------------------
; Hit LieDead
[statedef 5150]
type=l
movetype=h
physics=n
sprpriority=-3

[state 0] ;[.00] ; remove afterimages
	type=afterimagetime
	trigger1=!time
	time=0

;; normal anim
[state 0] ;[.01]
	type=changeanim
	triggerall=!time
	triggerall=selfanimexist(5140)
	trigger1=(anim!=[5111,5119])&&(anim!=[5171,5179])
	trigger2=!selfanimexist(5140+(anim%10))
	value=5140

; hit up type anim
[state 0] ;[.02]
	type=changeanim
	trigger1=!time
	trigger1=(anim=[5111,5119])||(anim=[5171,5179])
	trigger1=selfanimexist(5140+(anim%10))
	value=5140+(anim%10)

;; match over anim
[state 0] ;[.03]
	type=changeanim
;;??;	trigger1=!time
	trigger1=matchover=1
	trigger1=anim=[5140,5149]
	trigger1=selfanimexist(anim+10)
	value=anim+10
	persistent=0

;; switch to 5110 if liedead anim does not exist
[state 0] ;[.04]
	type=changeanim
	trigger1=!time && (anim!=[5140,5159]) && (anim!=[5110,5119])
	value=5110

;; friction
[state 0] ;[.05]
	type=velmul
	trigger1=1
	x=0.85
;; friction
[state 0] ;[.06]
	type=velset
	trigger1=vel x<0.05
	x=0
	persistent=0
[state 0] ;[.07]
	type=nothitby
	trigger1=1
	value=sca
	time=1
	ignorehitpause=1
;---
[state 0] ;[.08]
	type=varset
	trigger1=time=1 && alive=0 && !ishelper && numpartner
	sysvar(1)=(roundstate<=2)
[state 0] ;[.09]
	type=assertspecial
	trigger1=alive=0 && !ishelper && numpartner && sysvar(1) && (((time=[80,150]) && time%10<5) || time>150)
	flag=invisible
	flag2=noshadow
;[state 0] ;[.10]
;	type=posset
;	trigger1=time>=80 && alive=0 && !ishelper && numpartner && sysvar(1)
;	y=800 *(((time=[80,150]) && time%10<5) || time>150)

;------------------------
;------------------------
; Hit FallRecover (still falling)
[statedef 5200]
type=a
movetype=h
physics=n

;; change anim if done with transition
[state 0] ;[.00]
	type=changeanim
	trigger1=(anim=5035) && (animtime=0)
	value=5050

[state 0] ;[.01]
	type=veladd
	trigger1=1
	y=gethitvar(yaccel)

;; edited
[state 0] ;[.02]
	type=selfstate
;;v1.0;	trigger1=pos y>=const(movement.air.gethit.groundrecover.groundlevel)
	trigger1=(vel y>0) && (pos y+vel y>=0)
	value=5201

;------------------------
;------------------------
; Hit FallRecover (on the ground)
[statedef 5201]
type=a
movetype=h
physics=a
anim=5200
velset=-8*const(movement.yaccel),-8*const(movement.yaccel)
ctrl=0

[state 0] ;[.00]
	type=turn
	trigger1=!time && (p2dist x<5) ;;v1.0; ;const720p(-20)

[state 0] ;[.01]
	type=velset
	trigger1=!time
	x=const(velocity.air.gethit.groundrecover.x)
	y=const(velocity.air.gethit.groundrecover.y)

[state 0] ;[.02]
	type=posset
	trigger1=!time
	y=0
[state 0] ;[.03]
	type=nothitby
	trigger1=1
	value=sca
	time=1
[state 0] ;[.04]
	type=palfx
	trigger1=!time
	time=2
	add=128,128,128


;------------------------
;------------------------
; Air Get Hit (fall recovery in air)
[statedef 5210]
type=a
movetype=i
physics=n
anim=5210
ctrl=0

;; blink white
[state 0] ;[.00]
	type=palfx
	trigger1=!time
	time=2
	add=128,128,128

[state 0] ;[.01]
	type=posfreeze
	trigger1=time<4

;; turn if not facing opponent
[state 0] ;[.02]
	type=turn
	trigger1=!time && (p2dist x<const720p(-80))

[state 0] ;[.03]
	type=velmul
	trigger1=time=4
	x=const(velocity.air.gethit.airrecover.mul.x)
	y=const(velocity.air.gethit.airrecover.mul.y)

[state 0] ;[.04]
	type=veladd
	trigger1=time=4
	x=const(velocity.air.gethit.airrecover.add.x)
	y=const(velocity.air.gethit.airrecover.add.y)

;---
; go up
[state 0] ;[.05]
	type=veladd
	trigger1=time=4 && (command="holdup")
;vWin;	y=-2
	y=const(velocity.air.gethit.airrecover.up)
; go down
[state 0] ;[.06]
	type=veladd
	trigger1=time=4 && (command="holddown")
;vWin;	y=1.5
	y=const(velocity.air.gethit.airrecover.down)
; go fwd
[state 0] ;[.07]
	type=veladd
	trigger1=time=4 && (command="holdfwd")
;vWin;	x=1
	x=const(velocity.air.gethit.airrecover.fwd)
; go back
[state 0] ;[.08]
	type=veladd
	trigger1=time=4 && (command="holdback")
;vWin;	x=-1
	x=const(velocity.air.gethit.airrecover.back)

[state 0] ;[.09]
	type=nothitby
	trigger1=!time
	value=sca
	time=15
[state 0] ;[.10]
	type=ctrlset
	trigger1=time=20
	value=1
[state 0] ;[.11]
	type=veladd
	trigger1=time>=4
;vWin;	y=const(movement.yaccel)
	y=const(movement.air.gethit.airrecover.yaccel)

; land on ground
[state 0] ;[.12]
	type=changestate
	trigger1=(vel y>0) && (pos y+vel y>=0)
	value=52
	ctrl=1




;------------------------
;; plus - dizzy fall
;------------------------
[statedef 195050]
type=a
movetype=h
physics=n
anim=5050
ctrl=0

;;---
;; *options: for_safety-fall
;[state 0] ;[.00p1]
;	type=nothitby
;	trigger1=1
;	value=sca

;---
[state 0] ;[.00]
	type=afterimagetime
	trigger1=!time
	time=0

;;--- test
; no-juggle-set
;[state 0] ;[00a]
;	type=varset
;	trigger1=!time && !numhelper(403000)
;	sysvar(2)=0
;	persistent=0
;[state 0] ;[00b]
;	type=varadd
;	trigger1=!time && numhelper(403000)
;	sysvar(2)=1
;	persistent=0
;;---
;;[state 0]
;;	type=displaytoclipboard
;;	trigger1=1
;;	text="sysvar(2)=[ %d ]"
;;	params=sysvar(2)
;;---test

;---
; dizzy bg
[state 0] ;[.01]
	type=helper
	trigger1=!time && !numhelper(88892) && !numhelper(403000)
	id=88892
	stateno=88892
	ownpal=1
	persistent=0
; dizzy birds
[state 0] ;[.02]
	type=helper
	trigger1=!time && !numhelper(403000)
	id=403000
	stateno=190140
	ownpal=1
	size.height=ifelse(life<200,3,(random%3))
	ignorehitpause=1
	persistent=0

[state 0] ;[.05]
	type=changeanim
	trigger1=!time && selfanimexist(5052)
	value=5052
	persistent=0

[state 0] ;[.06]
	type=veladd
	trigger1=(anim=[5050,5052])
	y=gethitvar(yaccel)
[state 0] ;[.10a]
	type=statetypeset
	trigger1=(anim=[5050,5052]) && (pos y+vel y>=0) && (vel y>0)
	statetype=l
[state 0] ;[.10b]
	type=changeanim
	trigger1=(anim=[5050,5052]) && (pos y+vel y>=0) && (vel y>0)
	value=5100 ;; hit_ground

;;--- Hit_Ground + Get_Up
[state 0] ;[.11b]
	type=nothitby
	trigger1=(anim!=[5050,5052])
	value=sca
;---
[state 0] ;[.12a]
	type=changeanim
	trigger1=(animtime=0) && (anim=5100)
	value=5160 ;; bounce_into_air
	persistent=0
[state 0] ;[.12b]
	type=hitfallvel
	trigger1=(anim=5160)
	persistent=0
[state 0] ;[.12c]
	type=posset
	trigger1=(anim=5160)
	y=const(movement.down.bounce.offset.y)
	persistent=0
[state 0] ;[.12d] ; *new v1.1
	type=posadd
	trigger1=(anim=5160)
	x=const(movement.down.bounce.offset.x)
	y=ifelse(const(movement.down.bounce.offset.y)>-5, -5, const(movement.down.bounce.offset.y))
	persistent=0
[state 0] ;[.12e]
	type=veladd
	trigger1=(anim=5160)
	y=const240p(0.5)
;---
[state 0] ;[.15]
	type=changestate
	triggerall=(anim=5160) && (vel y>0)
	trigger1=(pos y>=const(movement.down.bounce.groundlevel))
	trigger2=(pos y>=const240p(10)) && (const(movement.down.bounce.groundlevel)=0)
	value=195110
;;---
[state 0] ;[.30a]
	type=posset
	trigger1=(anim=[5100,5109])
	y=0
[state 0] ;[.30b]
	type=velset
	trigger1=(anim=[5100,5109])
	y=0
[state 0] ;[.32]
	type=posfreeze
	trigger1=(anim=[5100,5109])
[state 0] ;[.33] ; ground_wave
	type=helper
	trigger1=(anim=[5100,5109]) && (animelem=1)
	id=159005
	stateno=159005
	pos=0,floor(-pos y)
	ownpal=1
	size.height=2
;;---------
;; Downed get-hit (lying down)
[Statedef 195110]
type=l
movetype=h
physics=n
velset=0,0
ctrl=0
[state 0] ;[.1a]
	type=posset
	trigger1=!time
	y=0
[state 0] ;[.1b] ;; ground_wave
	type=helper
	trigger1=!time
	id=159005
	stateno=159005
	pos=0,0
	ownpal=1
	size.height=2
[state 0] ;[.15e] ;; anim_down
	type=changeanim
	trigger1=!time && (anim!=[5110,5119])
	value=5110 +(anim%10)*selfanimexist(5110+(anim%10))
[state 0] ;[.16b2] ;; anim_get_up
	type=changeanim
	trigger1=(anim=[5110,5119]) && time>32 ;;;;;; (sysvar(1)>32)
	value=5120 +(anim%10)*selfanimexist(5120+(anim%10))
;--- goto dizzy / stun state
[state 0] ;[.20]
	type=changestate
	trigger1=(animtime=0) && (anim=[5120,5129])
	trigger2=time>96 ;; for_safety
	value=190116
;---
[state 0] ;[.21]
	type=nothitby
	trigger1=1
	value=sca
	time=1

;------------------------

;------------------------
; Continue
[statedef 5500]
type=s
anim=0
velset=0,0
ctrl=0

;; use stun animation
[state 0] ;[.00]
	type=changeanim
	trigger1=!time && selfanimexist(5300)
	value=5300
;; use continue animation if available
[state 0] ;[.01]
	type=changeanim
	trigger1=!time && selfanimexist(5500)
	value=5500

;------------------------
;------------------------
; Default Init ; デフォルト・開始ステート
[statedef 5900]
type=s
;;---
;;--- int variables
;[state 0] ;[.00]
;	type=varrangeset
;	trigger1=roundno=1
;	last=51
;	value=0
;[state 0] ;[.01]
;	type=varrangeset
;	trigger1=roundno=1
;	fvalue=0

;;--- <<IKEMENには無用>>
;;--- change palette (v1)
[state 0] ;[.02]
	type=remappal
	trigger1=!time
	source=1,1
	dest=1,palno
;;---
;;--- pos reset debug (for mugen only) ---
[state 0] ;[.02p3]
	type=turn
	trigger1=!time && !ishelper && numpartner>1 && facing=ifelse(teamside=1,-1,1)
[state 0] ;[.02p4]
	type=posset
	trigger1=!time && !ishelper && numpartner>1 && playeridexist(id-2)
	trigger1=playerid(id-2),ishelper=0 && playerid(id-2),teamside=teamside
	x=const240p(120)*ifelse(teamside=1,-1,1)
[state 0] ;[.02p5]
	type=posset
	trigger1=!time && !ishelper && numpartner>2 && playeridexist(id-3)
	trigger1=playerid(id-3),ishelper=0 && playerid(id-3),teamside=teamside
	x=const240p(144)*ifelse(teamside=1,-1,1)
;;---
;;---
; goto init2
[state 0] ;[.03]
	type=changestate
	trigger1=1
	value=195900

;==========================
; * Additions
;==========================
;==========================
; Init2 / Partner Assist-Stateno Registration ; パートナー支援ステート登録
; * override this statedef to regist partner-assist-stateno
;==========================
[statedef 195900]
type=s

;;>>@Config.Tag_Assist_StateNo>>
[state 0] ;[.00]
	type=varset
	trigger1=1
	sysvar(0)=1000 ;;<-def * set to 1000 (temp)

; goto preintro
[state 0] ;[.01]
	type=changestate
	trigger1=1
	value=190000

;------------------------
; default assist-action ; (協力技初期設定)
[statedef 1000]
type=s
physics=s
movetype=i
anim=ifelse(selfanimexist(195),195,0)
sprpriority=-2
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=posset
	trigger1=!time
	y=0
[state 0] ;[.01]
	type=poweradd
	trigger1=(anim=195) && (animtime=0)
	value=1000
[state 0] ;[.02]
	type=changestate
	trigger1=(anim!=195) && (time>16)
	trigger2=(anim=195) && (animtime=0)
	value=0
	ctrl=1

;==========================
; preintro ; 予備イントロ
;==========================
[statedef 190000]
ctrl=0

; intro for round 1 / turns mode
[state 0] ;[.00]
	type=changestate
	trigger1=roundno=1
	trigger2=roundno>1 && numenemy
	trigger2=(teammode=turns)||(enemy,teammode=turns)
	value=190

; all other rounds
[state 0] ;[.01]
	type=changestate
	trigger1=1
	value=0


;==========================
;==========================
; Blocking / Just Defended ; ブロッキング/ジャストディフェンス
;==========================
[statedef 195500]
type=u
movetype=h
physics=n
sprpriority=3
velset=0,0
ctrl=0
facep2=1

;--- init
[state 0] ;[.00a] ; type:[2,3]
	type=varset
	trigger1=!time && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900)
	sysvar(0)=playerid(floor(sysfvar(0))),var(22)

[state 0] ;[.00a2] ; hitshaketime / hittime
	type=varset
	trigger1=!time
	sysvar(2)=ifelse(gethitvar(hitshaketime)>999,999,gethitvar(hitshaketime))+ifelse(gethitvar(hittime)>999,999000,gethitvar(hittime)*1000)

[state 0] ;[.00a5]
	type=velset
	trigger1=!time
	trigger1=statetype=a && (pos y<0) && sysvar(0)=2
	x=gethitvar(xvel)*0.3*facing
	y=gethitvar(yvel)*0.5

[state 0] ;[.00a6]
	type=velset
	trigger1=!time
	trigger1=statetype=a && (pos y<0) && sysvar(0)=3
	x=-abs(gethitvar(xvel))*0.2
	y=-const(movement.yaccel)*7.25

[state 0] ;[.00a7] ; pause
	type=posfreeze
	trigger1= 1;; (time<sysvar(2)%1000)
[state 0] ;[.00a8] ; shake
	type=offset
	trigger1=(time<sysvar(2)%1000) && (gametime%2)
	x=2

;---
[state 0] ;[.00e1]
	type=statetypeset
	trigger1=!time
	movetype=i
[state 0] ;[.00e2]
	type=statetypeset
	trigger1=!time && statetype=s && (command="holddown")
	statetype=c
[state 0] ;[.00e3]
	type=statetypeset
	trigger1=!time && statetype=c && (command!="holddown")
	statetype=s
;---
;--- motion/animetion for blocking/jd:
;; (stand:195500/130) (squat:195501/131) (air:195502/132)
[state 0] ;[.01a] ; air ; 空
	type=changeanim
	trigger1=!time && statetype=a
	value=ifelse(selfanimexist(195502),195502,132)
[state 0] ;[.01c] ; crouch ; 屈
	type=changeanim
	trigger1=!time && statetype=c
	value=ifelse(selfanimexist(195501),195501,131)
[state 0] ;[.01s] ; stand ; 立
	type=changeanim
	trigger1=!time && statetype=s
	value=ifelse(selfanimexist(195500),195500,130)
;---
[state 0] ;[.01f] ; freeze ; フリーズ
	type=changeanim
	trigger1=(time<=sysvar(2)%1000)
	value=anim

;--- reset-width
[state 0] ;[.03a3]
	type=screenbound
	trigger1=(time>sysvar(2)%1000) && (time<(sysvar(2)/1000)%1000) && (statetype!=a)
	value=1
	movecamera=0,0
	ignorehitpause=1
[state 0] ;[.03a5]
	type=width
	trigger1=(time>sysvar(2)%1000) && (time<(sysvar(2)/1000)%1000) ;;@@&& (statetype!=a)
	player=const(size.ground.front)*2,const(size.ground.back)*2
	edge=0,floor(backedgedist)
	ignorehitpause=1
[state 0] ;[.03a6]
	type=width
	trigger1=time=1
	player=const(size.ground.front)+floor(p2bodydist x),const(size.ground.back)*2
	ignorehitpause=1

;---
[state 0] ;[.03b] ; stop-envshave
	type=envshake
	trigger1=1
	time=1
	ampl=0
	ignorehitpause=1
;---
[state 0] ;[.04a] ; life-recover ; 体力回復
	type=lifeadd
	trigger1=!time && (sysvar(0)=3)
	value=lifemax/500 ;;<-(+0.2%)
[state 0] ;[.04b]
	type=playsnd
	trigger1=!time
	value=f2500,ifelse(sysvar(0)=2,1,0)
	channel=1
;--- spark
;; f210200+ifelse(sysvar(0)=2,0,100)
[state 0] ;[.05a2]
	type=explod
	trigger1=!time
	anim=f6660 ; <MASK>
	postype=p1
	pos=const(size.mid.pos.x)+const(size.ground.front), const(size.mid.pos.y)
	sprpriority=4
	ownpal=1
	scale=-0.5,1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.05a3]
	type=explod
	trigger1=!time
	anim=f6610+(sysvar(0)=2)*3
	postype=p1
	pos=const(size.mid.pos.x)+const(size.ground.front), const(size.mid.pos.y)
	sprpriority=5
	ownpal=1
	scale=-0.5,1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.05a6]
	type=explod
	trigger1=!time
	anim=f210201+(sysvar(0)=3)*10
	postype=p1
	pos=const(size.mid.pos.x)+const(size.ground.front), const(size.mid.pos.y)
	sprpriority=6
	ownpal=1
	scale=-0.5,1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.05a7]
	type=explod
	trigger1=!time
	anim=f210200
	postype=p1
	pos=const(size.mid.pos.x)+const(size.ground.front), const(size.mid.pos.y)
	sprpriority=7
	ownpal=1
	scale=0.3,0.8
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.05b] ; reset-palfx
	type=palfx
	trigger1=!time
	add=ifelse(sysvar(0)=2,-100,120),ifelse(sysvar(0)=2,120,-50),ifelse(sysvar(0)=2,120,-100)
	time=5
[state 0] ;[.06a] ; stop_afterimage
	type=afterimagetime
	trigger1=!time
	time=0
[state 0] ;[.07]
	type=poweradd
	trigger1=!time
	value=118
;---
[state 0] ;[.08]
	type=pause
	trigger1=!time
	time=5
	movetime=0
	persistent=0
;---
[state 0] ;[.09]
	type=nothitby
	trigger1=1
	value=sca
	time=18  ;; advantage in moving ; 行動上優位
	ignorehitpause=1
;---
[state 0] ;[.12a1]
	type=assertspecial
	trigger1=1
	flag=nowalk
	flag2=nostandguard
	flag3=nocrouchguard
;;	flag=noairguard
	ignorehitpause=1
[state 0] ;[.12a2]
	type=ctrlset
	trigger1=!ctrl && (time>=sysvar(2)%1000)
	trigger1=(command="a"||command="b"||command="c"||command="x"||command="y"||command="z")
	value=1
[state 0] ;[.12b1]
	type=hitby
	trigger1=!ctrl && (time>=sysvar(2)%1000)
	value=sca,na,sa,ha,np,sp,hp
	time=1
	ignorehitpause=1
[state 0] ;[.12b2]
	type=hitoverride
	trigger1=!ctrl && (time>=sysvar(2)%1000)
	attr=sca,na,sa,ha,np,sp,hp
	stateno=stateno
	time=1
	slot=0
	ignorehitpause=1
;---
[state 0] ;[.13]
	type=changestate
	trigger1=(time>(sysvar(2)/1000)%1000)
	value=ifelse(statetype=s,0,ifelse(statetype=a,195505,11))
	ctrl=1

;------------
; Jump-down-after_bk/jd
[statedef 195505]
type=a
physics=a
movetype=i
anim=ifelse(selfanimexist(41),41,142)
ctrl=1
;---
[state 0] ;[.03]
	type=changeanim
	trigger1=(vel y>-2) && selfanimexist(anim+3)
	value=anim+3
	persistent=0


;==========================
;==========================
; fall-down ; (崩れ倒れ)
;==========================
[statedef 195200]
type=u
movetype=h
physics=n
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
[state 0] ;[.01a]
	type=changeanim
	trigger1=!time
	value=ifelse(statetype=s, ifelse((anim>5010), 5002, 5012), 5022)
[state 0] ;[.01b]
	type=changeanim
	trigger1=(anim=[5002,5012]) && ((animtime=0)||(time>16))
	value=5022 ;;Crouch Hit (hard)
[state 0] ;[.02a]
	type=changeanim
	trigger1=(anim=5022) && ((animtime=0)||(time>26))
	value=5080 ;;LieDown Hit (stay down)
[state 0] ;[.02b]
	type=selfstate
	trigger1=(anim=5080) && ((animtime=0)||(time>36))
	value=5110 ;;LieDown

;==========================
; fall-down-alive ; (崩れ倒れ-生存時)
;==========================
[statedef 195201]
type=u
movetype=h
physics=n
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
[state 0] ;[.00c]
	type=selfstate
	trigger1=selfanimexist(195200)
	value=195200
[state 0] ;[.01a]
	type=changeanim
	trigger1=!time
	value=ifelse(statetype=s, ifelse((anim>5010), 5002, 5012), 5022)
[state 0] ;[.01b]
	type=changeanim
	trigger1=(anim=[5002,5012]) && ((animtime=0)||(time>16))
	value=5022 ;;Crouch Hit (hard)
[state 0] ;[.02a]
	type=changeanim
	trigger1=(anim=5022) && ((animtime=0)||(time>26))
	value=5080 ;;LieDown Hit (stay down)
[state 0] ;[.02b]
	type=selfstate
	trigger1=(anim=5080) && ((animtime=0)||(time>36))
	value=195110 ;;LieDown-GetUp


;==========================
;==========================
; Guard Crush ; (ガードクラッシュ)
;==========================
[statedef 190010]
type=u
physics=u
velset=0,0
ctrl=0
[state 0] ;[.00] ; sound eff
	type=playsnd
	trigger1=!time
	value=f10010,0
;---
[state 0] ;[.01a] ; ring
	type=explod
	trigger1=!time
	anim=f6567
	postype=p1
	pos=floor((const(size.mid.pos.x))*const(size.xscale)),floor(const(size.mid.pos.y)*const(size.yscale)*ifelse(statetype=c,0.5,1))
	sprpriority=7
	ownpal=1
	scale=0.15,4.5
	trans=add
alpha=256,256 ;;***
	ignorehitpause=1
	pausemovetime=-1
	ignorehitpause=1
[state 0] ;[.01b] ; glass
	type=explod
	trigger1=time<13
	anim=f210100+(random%3)
	postype=p1
	pos=floor((const(size.mid.pos.x))*const(size.xscale)),floor(const(size.mid.pos.y)*const(size.yscale)*ifelse(statetype=c,0.5,1))
	sprpriority=6
	ownpal=1
	random=floor(const(size.height)/8*const(size.xscale)),floor(const(size.height)*const(size.yscale))
	scale=(random%9)*0.03+0.25,(random%9)*0.03+0.25
	vel=-((random%18)+5)*0.36,((random%19)-8)*0.36
	accel=0.038,0
	facing= ifelse(random<500,1,-1)
	vfacing=ifelse(random<500,1,-1)
	ignorehitpause=1
	pausemovetime=-1
	ignorehitpause=1
;--
[state 0] ;[.01c] ; bg
	type=explod
	trigger1=!time
	anim=f3530
	sprpriority=-52
	space=screen
	postype=left
	ownpal=1
	scale=3200,1
	bindtime=-1
	ignorehitpause=1
	pausemovetime=-1
	ignorehitpause=1
;---
[state 0] ;[.02]
	type=pause
	trigger1=!time
	time=13
	movetime=13
;---
[state 0] ;[.03]
	type=statetypeset
	trigger1=!time
	physics=statetype
[state 0] ;[.04]
	type=changeanim
	trigger1=!time
	value=ifelse(statetype=s,5002,ifelse(statetype=c,5022,5012))  ;;<-see air.txt
[state 0] ;[.05]
	type=selfstate
	trigger1=(time>13 && animtime=0) || time>36
	value=190011

;----------------
[statedef 190011]
type=u
physics=u
velset=0,0
ctrl=0
[state 0] ;[.00]
	type=statetypeset
	trigger1=!time
	physics=statetype
[state 0] ;[.01a]
	type=changeanim
	trigger1=!time
	value=ifelse(statetype=s,5007,ifelse(statetype=c,5027,5017))
[state 0] ;[.01b]
	type=changeanim
	trigger1=time<=80
	value=anim	
[state 0] ;[.02]
	type=offset
	trigger1=time<=80 && (time%2=0)
	x=ifelse(time%4,-1,1)
[state 0] ;[.03]
	type=selfstate
	trigger1=animtime=0||time>99
	value=ifelse(statetype=s,0,11)
	ctrl=1


;==========================
;==========================
; Dizzy / Stun ; 気絶
;==========================
; x [statedef 190110]
; x [statedef 190111]	;down
; x [statedef 190112]	;hit bounce-1
; x [statedef 190113]	;hit_bounce (bounce into air)
; x [statedef 190114]	;hit_liedown 2nd time
; x [statedef 190115]	;getup
;------------------------
[statedef 190116]
type=s
movetype=i; u 
; h: ヒットは連続しますが、投げられません
; i: 投げられますが、ヒットは連続しません
; u: 直前のタイプを継承
physics=s
anim=5300
movehitpersist=1
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=posset
	trigger1=!time
	y=0
; dizzy bg
[state 0] ;[.01a]
	type=helper
	trigger1=!time && (prevstateno=[5001,5051]) && !numhelper(88892) && !numhelper(403000)
	id=88892
	stateno=88892
	ownpal=1
	persistent=0
; dizzy birds
[state 0] ;[.01b]
	type=helper
	trigger1=!numhelper(403000)
	id=403000
	stateno=190140
	ownpal=1
	size.height=ifelse(life<200,3,(random%3))
	persistent=0
; dizzy sound
[state 0] ;[.02]
	type=playsnd
	trigger1=(time%42=0)
	value=f10400,0
	channel=2

[state 0] ;[.03]
	type=selfstate
	triggerall=time>8
	trigger1=sysfvar(0)>id && playeridexist(floor(sysfvar(0))) && (prevstateno!=190120)
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(52)>300
	trigger2=(time>88 && prevstateno=190120) || (roundstate>2) || (time>312) ;; for_safety
	value=0
	ctrl=1


;==========================
;==========================
; Dizzy Birds [helper]
;==========================
[statedef 190140]
type=a
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.03]
	type=varset
	trigger1=(parent,stateno=190116)
	var(0)=-1 ;; in dizzy/stun state
[state 0] ;[.03b] ; over
	type=varset
	trigger1=(roundstate!=2) || (parent,alive=0) || (parent,ctrl) || (parent,movetype=a) || (var(0)=-1 && (parent,stateno!=190116))
	var(0)=1
;---
[state 0] ;[.04]
	type=posset
	trigger1=var(0)<1
	x=(parent,pos x)
	y=(parent,pos y)
[state 0] ;[.04b]
	type=varadd
	trigger1=(parent,statetype!=c) && (parent,anim!=[5110,5119]) && (parent,anim!=[5170,5179])
	trigger1=fvar(12):=parent,const(size.head.pos.y)+1
	trigger2=(parent,statetype=c)
	trigger2=fvar(12):=parent,const(size.head.pos.y)*0.5
	trigger3=(parent,anim=[5110,5119])||(parent,anim=[5170,5179])
	trigger3=fvar(12):=parent,const(size.head.pos.y)*0.2
	trigger4=!time
	trigger4=fvar(11):=parent,const(size.head.pos.y)-3
	fvar(11)=(fvar(12)-fvar(11))*0.25
;---
[state 0] ;[.05] ; init
	type=null
	trigger1=!time
	trigger1=1|| var(2):=(parent,const(size.ground.back)+parent,const(size.ground.front)) ;; bird type
	trigger1=1|| var(10):= (random%6) ;; width
	trigger1=1|| fvar(11):=fvar(12) ;; pos y
	persistent=0
;---
[state 0] ;[.06]
	type=removeexplod
	trigger1=1
	id=0
;---
[state 0] ;[.07a] ; bird_1/4
	type=explod
	trigger1=(var(1):=var(1)+1) && (var(3):=((parent,stateno=[5000,5199])||(parent,stateno=190116)||(parent,stateno=195050)||(parent,stateno=195110)||(parent,stateno=[195200,195205]))) ;; counter , flag
	id=0
	anim=f403000+var(10)
	postype=p1
	pos=floor(sin(fvar(14):=var(1)*0.0698)*var(2)) , floor( (fvar(15):= cos(fvar(14))*var(2)*0.25) +fvar(11))
	sprpriority=ifelse(fvar(15)>0,6,-6)
	ownpal=1
	scale=(fvar(16):=(cos(fvar(14))+3)*0.12 *ifelse((fvar(15)<0),-1,1) *(fvar(17):=(time%9)*0.05+1) ) , abs(fvar(16))
	vel=0,-var(2)*0.05
	facing=-1
[state 0] ;[.07b] ; bird_2/4
	type=explod
	trigger1=var(3)
	id=0
	anim=f403000+var(10)
	postype=p1
	pos=floor(sin(fvar(14):=(var(1)+22.5)*0.0698)*var(2)) , floor( (fvar(15):= cos(fvar(14))*var(2)*0.25) +fvar(11))
	sprpriority=ifelse(fvar(15)>0,6,-6)
	ownpal=1
	scale=(fvar(16):=(cos(fvar(14))+3)*0.12 *ifelse((fvar(15)<0),-1,1) *fvar(17) ) , abs(fvar(16))
	vel=0,-var(2)*0.05
	facing=-1
[state 0] ;[.07c] ; bird_3/4
	type=explod
	trigger1=var(3)
	id=0
	anim=f403000+var(10)
	postype=p1
	pos=floor(sin(fvar(14):=(var(1)+45)*0.0698)*var(2)) , floor( (fvar(15):= cos(fvar(14))*var(2)*0.25) +fvar(11))
	sprpriority=ifelse(fvar(15)>0,6,-6)
	ownpal=1
	scale=(fvar(16):=(cos(fvar(14))+3)*0.12 *ifelse((fvar(15)<0),-1,1) *fvar(17) ) , abs(fvar(16))
	vel=0,-var(2)*0.05
	facing=-1
[state 0] ;[.07d] ; bird_4/4
	type=explod
	trigger1=var(3)
	anim=f403000+var(10)
	id=0
	postype=p1
	pos=floor(sin(fvar(14):=(var(1)+67.5)*0.0698)*var(2)) , floor( (fvar(15):= cos(fvar(14))*var(2)*0.25) +fvar(11))
	sprpriority=ifelse(fvar(15)>0,6,-6)
	ownpal=1
	scale=(fvar(16):=(cos(fvar(14))+3)*0.12 *ifelse((fvar(15)<0),-1,1) *fvar(17) ) , abs(fvar(16))
	vel=0,-var(2)*0.05
	facing=-1
;---
[state 0] ;[.08]
	type=destroyself
	trigger1=var(0)>0
	ignorehitpause=1


;==========================
;==========================
; Guard Breaking p2state ; (ガードブレーキングやられ)
;==========================
[statedef 190120]
type=u
movetype=i
physics=n
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
	ignorehitpause=1

[state 0] ;[.01a]
	type=changeanim
	trigger1=!time
	value=ifelse(statetype=s,5002,ifelse(statetype=c,5022,5012))
;;	5002-5007:	立-(stand hit -hard) ; loop-no loop
;;	5012-5017:	空-(stand/air low -hard)
;;	5022-5027:	屈-(crouch hit -hard)

[state 0] ;[.01b]
	type=changeanim
	trigger1=anim=5002||anim=5012||anim=5022
	trigger1=animtime=0 && pos y>=0
	value=anim+5

[state 0] ;[.02a]
	type=velset
	trigger1=!time
	x=-ifelse(statetype=a,4,8)
	y=9

[state 0] ;[.02b]
	type=posset
	trigger1=(pos y+vel y>=0)
	y=0
[state 0] ;[.02c]
	type=velset
	trigger1=(pos y>=0)
	y=0
[state 0] ;[.02d]
	type=velmul
	trigger1=(pos y>=0)
	x=0.9

[state 0] ;[.03]
	type=envshake
	trigger1=time=1
	time=6
	ampl=3
	ignorehitpause=1

[state 0] ;[.04]
	type=lifeadd
	trigger1=time=1
	value=-180
;op;	kill=0
	ignorehitpause=1
[state 0] ;[.05]
	type=statetypeset
	trigger1=time=1
	movetype=h
	ignorehitpause=1
[state 0] ;[.05a]
	type=statetypeset
	trigger1=time>0 && pos y>=0
	statetype=s
	movetype=h
	physics=n
	ignorehitpause=1
[state 0] ;[.05b]
	type=statetypeset
	trigger1=(anim=5007||anim=5017||anim=5027) && (animelem=1,>12)
	movetype=i
	ignorehitpause=1
[state 0] ;[.06]
	type=selfstate
	trigger1=(anim=5007||anim=5017||anim=5027) && (animelem=1,>12)
	trigger2=time>36 ;;<-for_safety
	value=ifelse(!win && roundstate>2,195200,190116)
	ctrl=0
;---
[state 0] ;[.07]
	type=playsnd
	trigger1=!time
	value=f10010,0
	ignorehitpause=1
;---
[state 0] ;[.08a] ; fx_bg
	type=bgpalfx
	trigger1=!time && roundstate=2
	time=16
	add=0,0,0
	mul=255,255,255
	sinadd=96,96,96,32
[state 0] ;[.08b] ; lighting
	type=explod
	trigger1=numexplod(505000)<8 && (gametime%3<2)
	id=505000
	anim=f210520+(random%4)
	postype=p1
	pos=0,-ifelse(statetype=c,30,50)
	random=80,ifelse(statetype=c,80,160)
	scale=0.5*ifelse(random<500,1,-1),0.5*ifelse(random<500,1,-1)
	sprpriority=7
	ownpal=1
	ignorehitpause=1


;==========================
;==========================
; Against Throw (p1&p2) ; 投げ外し
;==========================
[statedef 190130]
type=u
movetype=u ;; i
physics=n
velset=0,0
ctrl=0

[state 0] ;[.00]
	type=nothitby
	trigger1=1
	value=sca
;op;	time=2
	ignorehitpause=1
[state 0] ;[.01]
	type=playerpush
	trigger1=1
	value=0
	ignorehitpause=1

[state 0] ;[.02a]
	type=posset
	trigger1=!time
	x=pos x-const(size.ground.front)*facing
	y=0
[state 0] ;[.02b]
	type=afterimagetime
	trigger1=!time
	time=0
;---
[state 0] ;[.03a]
	type=changeanim
	trigger1=!time && !numtarget
	value=150 ;;<-5002->5007
;op;[state 0] ;[.03a2]
;op;	type=stopsnd
;op;	trigger1=!time && !numtarget
;op;	channel=0
;---
; freeze
[state 0] ;[.03b]
	type=changeanim
	trigger1=time>8 && numtarget
	value=anim
	elem=animelemno(0)
;---
[state 0] ;[.03c]
	type=targetfacing
	trigger1=numtarget
	value=-1

; opponent ; 投げ外し_相手
[state 0] ;[.04a1]
	type=targetstate
	trigger1=!time && numtarget ;;&& gethitvar(isbound)=0
	value=stateno

[state 0] ;[.04b]
	type=velset
	trigger1=time
	x=-0.6
[state 0] ;[.04c]
	type=playsnd
	trigger1=!time && numtarget
	value=f2500,1

[state 0] ;[.04a2]
	type=targetfacing
	trigger1=numtarget
	trigger1=facing=target,facing
	value=-facing
[state 0] ;[.04a3]
	type=targetbind
	trigger1=!time && numtarget
	pos=floor(const(size.ground.front)+target,const(size.ground.front))
;---
[state 0] ;[.05] ; ground_wave
	type=helper
	trigger1=!time && !numtarget
	id=159005
	stateno=159005
	ownpal=1
	size.height=2
;---
[state 0] ;[.05a] ; spark
	type=explod
	trigger1=!time && !numtarget
	anim=f6567 ; <MASK>
	scale=0.06,2.8
	postype=p1
	pos=floor(const(size.ground.front)),floor(const(size.mid.pos.y))
	sprpriority=5
	ownpal=1
	bindtime=1
	trans=add
alpha=256,256 ;;***
[state 0] ;[.05b]
	type=explod
	trigger1=!time && !numtarget
	anim=f6562 ; <DXOR>
	scale=0.06,2.8
	postype=p1
	pos=floor(const(size.ground.front)),floor(const(size.mid.pos.y))
	sprpriority=6
	ownpal=1
	bindtime=1
	trans=sub
;--- mark; 標記
[state 0] ;[.05c]
	type=explod
	trigger1=time=18
	anim=f296000+teamside
	postype=p1
	pos=0,floor( (const(size.head.pos.y)-const(size.ground.front)/2-const(size.ground.back)/2) )
	sprpriority=5
	ownpal=1
	facing=ifelse(facing=1,1,-1)
	scale=0.5,0.5
	bindtime=-1
	supermovetime=-1
	pausemovetime=-1
	ignorehitpause=1
	removeongethit=1
	persistent=0
;---
[state 0] ;[.06]
	type=selfstate
	trigger1=time>18
	value=105 ;; goto back step
	ctrl=0


;==========================
;==========================
; Partner Action in TagMode ; (タッグモード時パートナー処理)
; [190190-190196]
;==========================
; out screen ; (画面外へ)
[statedef 190190]
type=a
movetype=h
physics=n
anim=40
sprpriority=-2
velset=0,0
ctrl=0
facep2=1
;---
;sys::partner_life-recover1
[state 0]
	type=lifeadd
	trigger1=!time && life<1
	value=1
;---
[state 0]
	type=posset
	trigger1=!time
	y=0
;---
;sys::partner_jump-init1
[state 0]
	type=nothitby
	trigger1=1
	value=sca
[state 0]
	type=screenbound
	trigger1=!time && !ishelper && roundstate=2 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(7)&65536)
	value=0
	movecamera=0,0
[state 0]
	type=playerpush
	trigger1=1
	value=0
[state 0]
	type=assertspecial
	trigger1=(pos y!=0)
	flag=noshadow
;---
[state 0]
	type=afterimagetime
	trigger1=!time
	time=0
;;---
;sys::partner_run-anim2
[state 0]
	type=changeanim
	trigger1=(anim=40) && (animtime=0) && selfanimexist(100)
	value=100
	persistent=0
[state 0]
	type=turn
	trigger1=(anim=100)
	persistent=0
;sys::partner_run-vel2
[state 0]
	type=velset
	trigger1=(anim=100)
	x=9.6*const(movement.yaccel)
	y=0
;---
;---
; take off ; 離陸
;sys::partner_jump-anim1
[state 0]
	type=changeanim
	trigger1=(anim=40) && (animtime=0)
	value=41
[state 0]
	type=changeanim
	trigger1=(anim=[41,43]) && (animtime=0) && selfanimexist(anim+3)
	value=anim+3
;sys::partner_jump-vel1
[state 0]
	type=velset
	trigger1=(anim=[41,46])
	x=-20*const(movement.yaccel)
	y= -7*const(movement.yaccel)
;---
;sys::player_type_change1
[state 0]
	type=varset
	trigger1=1
	sysfvar(4)=1 ;; (0:main / 1:assist)
;---
;sys::face_d_clear
[state 0]
	type=removeexplod
	trigger1=!time
	id=490600
;---
;sys::player_pos_y_outscreen1
[state 0]
	type=posset
	trigger1=backedgedist<-const240p(160) || frontedgedist<-const240p(160)
	y=0
[state 0]
	type=velset
	trigger1=backedgedist<-const240p(160) || frontedgedist<-const240p(160)
	x=0
	y=0
;---
;sys::partner_goto-standby1
[state 0]
	type=changestate
	triggerall=time>59 ;;<<- (60F) interval ; 間隔
	triggerall=backedgedist<-const240p(100) || frontedgedist<-const240p(100) || pos y>100 || time>218
	trigger1=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(28)>200
	trigger2=roundstate>2
	value=190191
	ctrl=0

;------------------------
; Stand-By1 (Change OK) ; 待機中1(交替可)
;------------------------
[statedef 190191]
type=l
movetype=h
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0]
	type=screenbound
	trigger1=1
	value=0
	movecamera=0,0
[state 0]
	type=assertspecial
	trigger1=1
	flag=noshadow
;---
;sys::partner-standby_id_input2
[state 0]
	type=varset
	trigger1=!time
	sysvar(0)=0
[state 0]
	type=varset
	trigger1=!ishelper && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(15)!=id
	sysvar(0)=playerid(floor(sysfvar(0))),var(15)
;---
;sys::partner-standby-set3
[state 0]
	type=turn
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=facing!=playerid(sysvar(0)),facing
[state 0]
	type=posset
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0)) && numenemy
	x=playerid(sysvar(0)),pos x+ifelse(playerid(sysvar(0)),p2dist x<0,8,-8)*facing
	y=playerid(sysvar(0)),pos y-8
[state 0]
	type=offset
	trigger1=1
	y=800
;---
;sys::partner-standby-out1 ; 出る
[state 0]
	type=varset
	trigger1=!ishelper && roundstate=2 && numpartner && sysvar(0)>0 && playeridexist(sysvar(0)) && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(sysvar(0)),alive=0 && playerid(sysvar(0)),stateno=5150) || (playerid(sysvar(0)),sysfvar(4)>0)
	trigger1=id=playerid(floor(sysfvar(0))),var(49)
	sysfvar(4)=0 ;; (0:main / 1:assist)
;---
;sys::partner-standby-out2
[state 0]
	type=changestate
	;;---// normal
	trigger1=time>0 && sysfvar(4)<1
	;;---// round-over
	trigger2=(roundstate>2)
	value=190193
	ctrl=0
;---
;sys::partner_goto-standby2
[state 0]
	type=changestate
	trigger1=time>=158 ;;<<- (158F) interval / charge-time ; 間隔/蓄積期間
	value=190192

;------------------------
; Stand-By2 (Change / Partner-Assist-OK, Life-Recover) ; 待機中2(交替/支援可,体力回復)
;------------------------
[statedef 190192]
type=u
movetype=u
physics=n
velset=0,0
ctrl=0
;---
[state 0]
	type=screenbound
	trigger1=1
	value=0
	movecamera=0,0
[state 0]
	type=assertspecial
	trigger1=1
	flag=noshadow
;---
;sys::partner_life-recover3
[state 0]
	type=lifeadd
	trigger1=(time%20=19) && (life<lifemax-1)
	value=1
;---
;sys::partner-standby_id_input3
[state 0]
	type=varset
	trigger1=!ishelper && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900
	sysvar(0)=playerid(floor(sysfvar(0))),var(15)
;---
;sys::partner-standby-set5
[state 0]
	type=turn
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=facing!=playerid(sysvar(0)),facing
[state 0]
	type=posset
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0)) && numenemy
	x=playerid(sysvar(0)),pos x+ifelse(playerid(sysvar(0)),p2dist x<0,8,-8)*facing
	y=playerid(sysvar(0)),pos y-8
[state 0]
	type=offset
	trigger1=1
	y=800
;---
;sys::partner-standby-out3 ; 出る
[state 0]
	type=varset
	trigger1=!ishelper && roundstate=2 && numpartner && sysvar(0)>0 && playeridexist(sysvar(0)) && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(sysvar(0)),alive=0 && playerid(sysvar(0)),stateno=5150) || (playerid(sysvar(0)),sysfvar(4)>0)
	trigger1=id=playerid(floor(sysfvar(0))),var(49)
	sysfvar(4)=0 ;; to main-player
;---
;sys::partner_goto-out1
[state 0]
	type=changestate
	;;---// normal
	trigger1=time>1 && sysfvar(4)<1
	;;---// round-over
	trigger2=roundstate>2
	;;---// striker-call / summon ; (ストライカー呼出)
	trigger3=sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger3=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(48)=12 && id=playerid(floor(sysfvar(0))),var(49)
	value=190193
	ctrl=0

;------------------------
; in (190193-190195) ; 登場
;------------------------
[statedef 190193]
type=u
movetype=u
physics=n
sprpriority=-2
velset=0,0
ctrl=0
;---
;sys::partner-out-set1
[state 0]
	type=nothitby
	trigger1=1
	value=sca
[state 0]
	type=screenbound
	trigger1=1
	value=0
	movecamera=0,0
[state 0]
	type=playerpush
	trigger1=1
	value=0
[state 0]
	type=assertspecial
	trigger1=1
	flag=invisible
;---
;sys::face_d_clear
[state 0]
	type=removeexplod
	trigger1=!time
	id=490600
;---
;sys::init_assist_no
[state 0]
	type=varset
	trigger1=!time
	sysvar(1)=-1
;---
;sys::partner-out-set2
[state 0]
	type=turn
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=facing!=playerid(sysvar(0)),facing
;sys::partner-out-pos2
[state 0]
	type=posset
	trigger1=roundstate=2 && sysvar(0)>0 && playeridexist(sysvar(0))
	x= (playerid(sysvar(0)),pos x)-(playerid(sysvar(0)),backedgebodydist+const240p(90))*facing
	y=-const240p(180)
;sys::partner-out-pos3
[state 0]
	type=posset
	trigger1=roundstate>2 && sysvar(0)>0 && playeridexist(sysvar(0))
	x= (playerid(sysvar(0)),pos x)-facing*const240p(28)*(id-sysvar(0))
	y=-(playerid(sysvar(0)),screenpos y)-const240p(80)
;---
;sys::partner-landing-pos2
[state 0]
	type=helper
	trigger1=!time && !ishelper && roundstate=2 && sysfvar(4)=0 && !numhelper(909606) && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && !(playerid(floor(sysfvar(0))),var(7)&65536)
	trigger1=sysvar(0)>0 && playeridexist(sysvar(0))
	pos=floor(playerid(sysvar(0)),pos x-pos x)*facing, floor(playerid(sysvar(0)),pos y-pos y)
	id=909606
	stateno=190202
;---
;sys::partner-out-vel2
[state 0]
	type=velset
	triggerall=sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=time>1+99*(roundstate>2)*(!win)
	x=abs(pos x-playerid(sysvar(0)),pos x)/20.0*(roundstate=2)
	y=abs(pos y)/20.0
;---
;sys::partner_goto-out2
[state 0]
	type=changestate
	trigger1=time>1+99*(roundstate>2)*(!win)
	value=ifelse((sysfvar(4)<1), 190194, 190196)
	ctrl=0

;------------------------
; Empty States for override ; ストライカー出現 上書き用中間ステート
;------------------------
[statedef 190196]
type=u
movetype=u
ctrl=0
;---
;sys::partner_goto-out3
[state 0]
	type=changestate
	trigger1=!time
	value=190194
	ctrl=0

;------------------------
; Striker-Call / Summon ; ストライカー召喚
;------------------------
[statedef 190194]
type=a
movetype=u
physics=n
anim=ifelse(selfanimexist(44),44,41)
sprpriority=-2
ctrl=0
;---
;sys::partner_assist-mark1
[state 0] ;; Mark: "p-1" / "p-2" / "cpu"
	type=explod
	trigger1=!time && roundstate=2 && !numexplod(296000) && numpartner
	id=296000
	anim=f296000+(matchno<2||ishometeam=0)*teamside
	postype=p1
	pos=0,floor( (const(size.head.pos.y)-const(size.ground.front)/2-const(size.ground.back)/2) )
	facing=ifelse(facing=1,1,-1)
	scale=0.5,0.5
	sprpriority=5
	ownpal=1
	bindtime=-1
	supermovetime=-1
	pausemovetime=-1
	ignorehitpause=1
	persistent=0
;---
;sys::partner-out-set4
[state 0]
	type=nothitby
	trigger1=!time && sysvar(0)>0 && playeridexist(sysvar(0))
	value=sca
	time=ifelse(playerid(sysvar(0)),alive=0,25,10)
[state 0]
	type=assertspecial
	trigger1=(pos y<0)
	flag=noshadow
[state 0]
	type=screenbound
	trigger1=1
	value=0
	movecamera=0,0
[state 0]
	type=playerpush
	trigger1=1
	value=0
;---
;sys::partner_goto-assist1
[state 0]
	type=changestate
	trigger1=(anim=[41,46])
	trigger1=(pos y>=0) || ((pos y+vel y>=0)&&(vel y>0))
	value=190195 ;; land
	ctrl=0
;---
[state 0]
	type=palfx
	trigger1=!time && sysfvar(4)=0 && sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=playerid(sysvar(0)),sysfvar(4)=2 ;; "switch-canneling"
	time=20
	add=-256,0,256
;---
;sys::player_cost_sc0 ;; パワー消費量
[state 0]
	type=poweradd
	trigger1=!time && sysfvar(4)=0 && sysvar(0)>0 && playeridexist(sysvar(0))
	trigger1=playerid(sysvar(0)),sysfvar(4)=2 ;; "switch-canneling"
	value=-500
	persistent=0
;---
;sys::partner_run-anim2
[state 0]
	type=changeanim
	trigger1=!time && roundstate=2 && selfanimexist(100)
	value=100
	persistent=0
[state 0]
	type=velset
	trigger1=(anim=100)
	y=0
[state 0]
	type=posset
	trigger1=(anim=100)
	y=0
;sys::partner_goto-assist1
[state 0]
	type=changestate
	trigger1=(anim=100) && (time>=20)
	value=190195 ;; stop
	ctrl=0
;;---

;------------------------
; Land > RoundOver ; 着地>ラウンド終了
;------------------------
[statedef 190195]
type=s
movetype=i
physics=s
anim=47
sprpriority=-2
velset=0,0
ctrl=0
;---
;sys::partner_anim_change5
[state 0]
	type=changeanim
	triggerall=!time
	trigger1=(animtime>0) ;;loop-type
	trigger2=(animtime<-5) ;;too-long
	value=40 ;;start_jump
;---
;sys::partner-out-set5
[state 0]
	type=posset
	trigger1=!time
	y=0
;---
;sys::partner_goto-assist2
[state 0]
	type=changestate
	trigger1=animtime=0 && roundstate=2 && sysfvar(4)>0 && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900
	value=playerid(floor(sysfvar(0))),var(53+id-playerid(floor(sysfvar(0))),sysvar(0))
	ctrl=0
;---
;sys::partner_ex-change_safety
[state 0]
	type=changestate
	trigger1=(animtime=0)
	trigger2=(animtime>0) && (time>5)
	value=0
	ctrl=1


;==========================
;==========================
; Static Pos [helper] ; 座標固定
[statedef 190202]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0]
	type=screenbound
	trigger1=1
	value=1
	movecamera=1,1
[state 0]
	type=destroyself
	trigger1=(parent,stateno!=[190190,190196]) || (roundstate!=2) || time>56 ;;20


;==========================
;==========================
; Projctile [helper] ; 飛び道具
; ---	---
; v00:	proj alive flag
; ---	---
; v01:	proj id (multi proj)
; v02:	attack id (target,id)->(numtarget(v02))
; v04:	proj remove_time
; v06:	max_hits
; v07:	hits_miss_time
; v08:	damage_hit
; v09:	damage_guard
; v10:	hit fall
; v11:	options_type
	; 00:hado / 10:fire_hado / 11:blue_fire_hado / 20:air_hado(no_hit_crouch)
	; 40:knife
; v12:	counter/timer (can be reinited)
; v13:	hit_anim_type
	; animtype:: 0:light / 1:medium / 2:hard / 3:back / 4:up / 5:diag-up
; v14:	remove_type
; ---	---
; v15-18:	code_set: 10311+10212+10113=30636 (xxx)
; ---	---
; v19:	hit self switch (E-F)
; v20:	fall switch / last hit (->v10)
; v21-29:	palfx RGB(R,G,B)
; v30:	init flag / counter/timer (can be reinit)
; v31:	reset flag
; ---	---
; v32:	projtime from a to z (can NOT be reinited)
; v33:	target id
; ---	---
; v34:	hitsound (300,v34)
; v35:	hitspark v35+(random%4)*10
; v36:	palfx time (off:0)
; v37:	CanGetHit Flag:: 0:Normal(default) / 1:CanGetHit
; ---	---
; v40:	p2dist x (width)
; v41:	p2dist x _level
; ---	---
; f00:	speed_x 1/1000
; f01:	speed_y
; f02:	hit_vel x 1/1000
; f03:	hit_vel y
; f04-05:	sparkxy
; ---	---
;==========================
[statedef 91000]
type=a
movetype=a
physics=n
anim=const(size.head.pos.x)
sprpriority=5
;-; ownpal=1
poweradd=0
velset=0,0
ctrl=0
;---
;;[state 0] ;[.00a0] ; code_set
;;	type=varset
;;	trigger1=!var(32)
;;	var(18)=(var(15):=10311)+(var(16):=10212)+(var(17):=10113) ; ###
;---
[state 0] ;[.00a1]
	type=assertspecial
	trigger1=1
	flag=invisible
;op;	flag2=noshadow
	ignorehitpause=1
[state 0] ;[.00a2]
	type=nothitby
	trigger1=1
	value=sca
	ignorehitpause=1
;---
; affectteam_reset
[state 0] ;[.05a]
	type=turn
	trigger1=var(31)
	ignorehitpause=1
[state 0] ;[.05b]
	type=varset
	trigger1=var(31)
	var(19)=!var(19) ;; E -> F
	ignorehitpause=1
;---
[state 0] ;[.06a]
	type=modifyexplod
	trigger1=var(31)
	id=1
	scale=ifelse(var(19),-1,1)*const(size.xscale)
	trans=sub ;;**
	ignorehitpause=1
[state 0] ;[.06b]
	type=modifyexplod
	trigger1=var(31)
	id=2
	scale=ifelse(var(19),-1,1)*const(size.xscale)
	ignorehitpause=1
;---
; re_init
[state 0] ;[.07a1]
	type=varset
	trigger1=var(31)
	var(31)=0  +( var(30):=0 ) ;;<- re_init
	ignorehitpause=1
;--- {init.start}
;; all helper id (attack id -> target,id)
;; 1000: special proj / 3000: hyper/super proj
[state 0] ;[.07a2]
	type=varset
	trigger1=!var(32) ;;<-only once
	var(2)=ifelse(ishelper(3000),3000,1000)
	ignorehitpause=1
;---
[state 0] ;[.10c1]
	type=null
	trigger1=!var(30)
	trigger1=1|| var(1):=ifelse(ishelper(3000),60000,10000)+(gametime%40000)
		;//; * use "gametime" to avoid ID dublication (id range [10000-60000])
		;//; * IDを重複させない為に"gametime"を使います
	trigger1=1|| var(4):=ifelse((const(size.height)%1000)<1,1,const(size.height)%1000) ;;<- remove_time
	trigger1=1|| fvar(0):=const(size.mid.pos.x)/1000.000 || fvar(1):=const(size.mid.pos.y)/1000.000 ;;<- speed_x / y
	trigger1=1|| fvar(6):=-(((const(size.air.front)/1000)%1000)-500)/10.0 || fvar(7):=-((const(size.air.front)%1000)-500)/10.0  ;;<- vel_xy_hit
	trigger1=1|| fvar(8):=-(((const(size.air.back)/1000)%1000)-500)/10.0  || fvar(9):=-((const(size.air.back)%1000)-500)/10.0   ;;<- vel_xy_guard
	trigger1=1|| var(6):=const(size.ground.front)/1000 || var(7):=const(size.ground.front)%1000 ;;<- max_hits / hittime
	trigger1=1|| var(8):=const(size.ground.back)/10000 || var(9):=const(size.ground.back)%10000 ;;<- damage_hit / damage_guard
	trigger1=1|| var(10):=const(size.shadowoffset) ;;<- fall_ground
	trigger1=1|| var(11):=(const(size.height)/1000)%100 ;;<- options_type
		;//; 00:hado / 10:fire_hado / 11:blue_fire_hado / 20:air_hado(no_hit_crouch)
		;//: 40:knife
	trigger1=1|| var(12):=0 ;;<- counter/timer reset
	trigger1=1|| var(13):=(const(size.height)/100000)%10 ;;<- hit_anim_type
		;//; animtype:: 0:light / 1:medium / 2:hard / 3:back / 4:up / 5:diag-up
	trigger1=1|| var(14):=(const(size.height)/1000000)%10 ;;<- remove_type
	trigger1=1|| var(37):=(const(size.height)/10000000)%10 ;;<- cangethit_flag
		;;//; cangethit flag:: 0:normal / 1:cangethit
	trigger1=1|| var(34):=(var(11)<10||var(11)=20)*30 +(var(11)=[10,12])*20 +(var(11)=40)*41 ;;<-hitsound
	trigger1=1|| var(35):=((var(2)>=3000)+3)*(var(11)<40) +(var(11)=40)*6 ;;<-hitspark
	ignorehitpause=1
;--- 
[state 0] ;[.10c2] ; damage revise
	type=null
	trigger1=!var(30) && numenemy && root,sysfvar(0)>0 && playeridexist(floor(root,sysfvar(0))) && enemy,sysfvar(0)>0 && playeridexist(floor(enemy,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900 && playerid(floor(root,sysfvar(0))),var(51)<1 && playerid(floor(enemy,sysfvar(0))),var(0)=90900 && playerid(floor(enemy,sysfvar(0))),var(51)>0
	trigger1=1|| var(8):=floor(var(8)/((roundno*0.5+matchno*0.5+ (playerid(floor(enemy,sysfvar(0))),var(51)) )*0.1+0.7))
	trigger1=1|| var(9):=floor(var(9)/((roundno*0.5+matchno*0.5+ (playerid(floor(enemy,sysfvar(0))),var(51)) )*0.1+0.7))
;--- {init.end}
;---
; countter / ticks elapsed
; 発射後時間経過(カウントダウン)
[state 0] ;[.12a2]
	type=varadd
	trigger1=hitpausetime<1
	var(12)=1 ;; (only once)
	ignorehitpause=1
[state 0] ;[.12a3]
	type=varadd
	trigger1=1
	var(30)=1 ;; (reinit flag)
	ignorehitpause=1
;---
[state 0] ;[.13b1] ; fx_mask
	type=palfx
	trigger1=1
	time=1
	add=0,0,0
	mul=384,384,384
	color=0
	ignorehitpause=1
[state 0] ;[.13b5] ; mask/sub
	type=explod
	trigger1=!time && !numexplod(1)
	anim=anim
	id=1
	postype=p1
	sprpriority=5
	ownpal=0 ;;**
	bindtime=-1
	removetime=-1
	scale=const(size.xscale),const(size.yscale)
	trans=sub
	ignorehitpause=1
[state 0] ;[.13b6] ; dxor
	type=explod
	trigger1=!time && !numexplod(2)
	anim=anim
	id=2
	postype=p1
	sprpriority=6
	ownpal=1 ;;**
	bindtime=-1
	removetime=-1
	scale=const(size.xscale),const(size.yscale)
	ignorehitpause=1
;---
;---
; fall switch ; 倒れスイッチ
[state 0] ;[.15a]
	type=varset
	trigger1=(var(3)+1>=var(6))&&((var(10)%10=1)||(var(10)%10>2))
	var(20)=1
	ignorehitpause=1
; pal eff ; パレット効果
[state 0] ;[.15b]
	type=null
	triggerall=var(30)<2
	trigger1=var(11)=10 ;;<-red fire
	trigger1=1|| (var(21):=208)||(var(22):=010)||(var(23):=-208) ||(var(24):=255)||(var(25):=200)||(var(26):=200)  ||(var(27):=255)||(var(28):=196)||(var(29):=196)
	trigger1=1|| (var(36):=var(7)+18) ;;<-palfx timer
	trigger2=var(11)=11 ;;<-blue fire
	trigger2=1|| (var(21):=048)||(var(22):=001)||(var(23):=168)  ||(var(24):=196)||(var(25):=196)||(var(26):=255)  ||(var(27):=168)||(var(28):=128)||(var(29):=255)
	trigger2=1|| (var(36):=var(7)+18) ;;<-palfx timer
;---
;---
; CanGetHit Type:: 0:Normal
[state 0] ;[.16a]
	type=hitby
	trigger1=!var(0) && var(12)>1 ;;<- Changable Timer
	value=sca,np,sp,hp
	ignorehitpause=1
; CanGetHit Type:: 1:CanGetHit
[state 0] ;[.16b]
	type=hitby
	trigger1=!var(0) && var(12)>1 ;;<- Changable Timer
	trigger1=var(37)=1 ;;CanGetHit
	value=sca,na,sa,ha,np,sp,hp
	ignorehitpause=1
; for Reflection
[state 0] ;[.16e]
	type=nothitby
	trigger1=var(19)=1 ;;<- for Reflection
	value=sca
	ignorehitpause=1
;---
[state 0] ;[.18a] ; Normal
	type=hitoverride
	trigger1=!var(0) && var(12)>1 ;;<- Changable Timer
	attr=sca,np,sp,hp
	stateno=stateno
	ignorehitpause=1
[state 0] ;[.18b] ; CanGetHit
	type=hitoverride
	trigger1=!var(0) && var(37)=1 && var(12)>1 ;;<- Changable Timer
	attr=sca,na,sa,ha,np,sp,hp
	stateno=stateno
	ignorehitpause=1

;---
;---; v11:hittype / v13:animtype=sca / v19:affectteam=e
[state 0] ;[.20a1]
	type=hitdef
	trigger1=!var(0) && var(11)!=20 && var(13)=0 && var(19)=0
	attr=a,sp
	affectteam=e ; -> f
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=back
	ground.type=high
	air.type=low
	hitflag=mhaf ; mhafp ;; <- hit all
	guardflag=ma
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
;op;	fall.recovertime=18
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
;op;	envshake.time=0
;op;	envshake.ampl=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;---; v11:hittype / v13:animtype=sca / v19:affectteam=f
[state 0] ;[.20a2]
	type=hitdef
	trigger1=!var(0) && var(11)!=20 && var(13)=0 && var(19)=1
	attr=a,sp
	affectteam=f ; -> e
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=back
	ground.type=high
	air.type=low
	hitflag=mhaf ; mhafp ; <- hit all
	guardflag=ma
	hitsound= -1; 300,var(34)
	guardsound= 41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;--- ---
;---; v11:hittype_c / v13:animtype / v19:affectteam=e
[state 0] ;[.20b1]
	type=hitdef
	trigger1=!var(0) && var(11)=20 && var(13)=0 && var(19)=0
	attr=a,sp
	affectteam=e
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=back
	ground.type=low
	air.type=low
	hitflag=haf ; hafp ; <- not hit crouching
	guardflag=ma
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;---; v11:hittype_c / v13:animtype / v19:affectteam=f
[state 0] ;[.20b2]
	type=hitdef
	trigger1=!var(0) && var(11)=20 && var(13)=0 && var(19)=1
	attr=a,sp
	affectteam=f
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=back
	ground.type=low
	air.type=low
	hitflag=haf ; hafp ; <- not hit crouching
	guardflag=ma
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;--- ---
;---; v11:hittype_sca / v13:animtype=diagup / v19:affectteam=e
[state 0] ;[.20c1]
	type=hitdef
	trigger1=!var(0) && var(11)!=20 && var(13)=5 && var(19)=0
	attr=a,hp
	affectteam=e
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=diagup
	ground.type=high
	air.type=low
	hitflag=mhaf ; mhafp ; <- hit all
	guardflag=m
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;---; v11:hittype_sca / v13:animtype=diagup / v19:affectteam=f
[state 0] ;[.20c2]
	type=hitdef
	trigger1=!var(0) && var(11)!=20 && var(13)=5 && var(19)=1
	attr=a,hp
	affectteam=f
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=diagup
	ground.type=high
	air.type=low
	hitflag=mhaf ; mhafp ; <- hit all
	guardflag=m
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;---
;---; v11:hittype_c / v13:animtype=diagup / v19:affectteam=e
[state 0] ;[.20d1]
	type=hitdef
	trigger1=!var(0) && var(11)=20 && var(13)=5 && var(19)=0
	attr=a,hp
	affectteam=e
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=diagup
	ground.type=low
	air.type=low
	hitflag=haf ; hafp ; <- not hit crouching
	guardflag=m
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;---; v11:hittype_c / v13:animtype=diagup / v19:affectteam=f
[state 0] ;[.20d2]
	type=hitdef
	trigger1=!var(0) && var(11)=20 && var(13)=5 && var(19)=1
	attr=a,hp
	affectteam=f
	id=var(2)
	damage=var(8),var(9)
	animtype=heavy
	air.animtype=back
	fall.animtype=diagup
	ground.type=low
	air.type=low
	hitflag=haf ; hafp ; <- not hit crouching
	guardflag=m
	hitsound= -1; 300,var(34)
	guardsound=41,0
	pausetime=var(7),var(7)+1
	sparkno= -1; var(35)+(random%4)*10
	guard.sparkno= -1; 41
	sparkxy=0,0
	ground.slidetime=var(7)+12
	ground.hittime=  var(7)+12
	air.hittime=     var(7)+12
	ground.velocity=   fvar(6)*ifelse(var(20),0.5,1), fvar(7)*var(20)
	guard.velocity=    fvar(8)
	air.velocity=      fvar(6)*0.5, fvar(7)
	airguard.velocity= fvar(8)*0.5, fvar(9)
	yaccel=0.5
	fall=var(20)
	air.fall=(var(10)%10>=2)
	fall.recover=((var(10)/10)%10=0)
	air.juggle=(!var(3))*const(data.airjuggle)
	ground.cornerpush.veloff=0
	air.cornerpush.veloff=0
	guard.ctrltime=0
	guard.dist=32
	fall.envshake.time=id
	fall.envshake.ampl=0
	palfx.time=var(36)
	palfx.add=   var(21),var(22),var(23)
	palfx.mul=   var(24),var(25),var(26)
	palfx.sinadd=var(27),var(28),var(29),20
	palfx.color=0
	palfx.invertall=1
;--- ---
;---
;--- *Reflection ; *反射判定

; player id set
[state 0] ;[.22-0]
	type=varset
	trigger1=(movecontact) || (!time)
	var(33)=id ;; <- set to self
	persistent=0
[state 0] ;[.22-1]
	type=varset
	trigger1=(movecontact) && numtarget(var(2))
	var(33)=target(var(2)),id
	ignorehitpause=1

; check enemy type: reflection
[state 0] ;[.22-5]
	type=varset
	trigger1=var(33)>0 && playeridexist(var(33))
	trigger1=(playerid(var(33)),ishelper)
	trigger1=(playerid(var(33)),var(15)=10311) && (playerid(var(33)),var(16)=10212) && (playerid(var(33)),var(17)=10113) && (playerid(var(33)),var(18)=30636)
	trigger1=var(30)>2 ;; <-counter
	var(31)=1 ;;-> reset
	ignorehitpause=1

; flag reset***
[state 0] ;[.22a]
	type=varset
	trigger1=var(31)
	var(3)=0 ;;<-hit count
	ignorehitpause=1
[state 0] ;[.22b]
	type=movehitreset
	trigger1=var(31)
	ignorehitpause=1

[state 0] ;[.23a]
	type=statetypeset
	trigger1=var(19)=1 && var(30)<9
	movetype=i
	ignorehitpause=1
[state 0] ;[.22b]
	type=statetypeset
	trigger1=var(19)=1 && var(30)>8
	movetype=a
	ignorehitpause=1
;---
;--- hit_sound
[state 0] ;[.23a]
	type=playsnd
	trigger1=(movehit=1) && numtarget && (hitpausetime>0) && (hitpausetime=[var(7)-1,var(7)])
	trigger1=var(31)!=1 ;;<-not a reflection
	value=f300,var(34)
	channel=1
	ignorehitpause=1

;--- hit_spark_dist_x
[state 0] ;[.23e] ;; Get P2Dist X
	type=varset
	trigger1=(movecontact=1)
	trigger1=var(31)!=1 ;;<-not a reflection
	trigger1=var(33)>0 && playeridexist(var(33)) || (fvar(4):=0) ;;<- init
	fvar(4)=(playerid(var(33)),pos x-pos x)*facing ;;<- P2Dist X
	ignorehitpause=1
;--- hit_spark
[state 0] ;[.23g]
	type=helper
	trigger1=(movecontact=1) && (!movereversed) && numtarget && (hitpausetime>0) && (hitpausetime=[var(7)-1,var(7)])
	trigger1=var(31)!=1 ;;<-not a reflection
	id=152100
	stateno=152100
	helpertype=normal
	ownpal=1
	keyctrl=0
	postype=p1
	pos=floor(fvar(4))
	size.height=ifelse(movehit,var(35),43+(var(2)>=3000)) ;; hit/guard_spark
	ignorehitpause=1
	facing=-1
;--- burn_spark
[state 0] ;[.23i]
	type=helper
	trigger1=(movehit=1) && (!movereversed) && numtarget(var(2)) && (hitpausetime>0) && (hitpausetime=[var(7)-1,var(7)])
	trigger1=var(31)!=1 ;;<-not a reflection
	trigger1=(var(11)=[10,12]) && (numhelper(152200)=0) && (root,numhelper(152200)=0) ;; fire switch & fire-helper existing
	trigger1=var(33)>0 && playeridexist(var(33))
	trigger1=(playerid(var(33)),var(15)!=10311)||(playerid(var(33)),var(16)!=10212)||(playerid(var(33)),var(17)!=10113)||(playerid(var(33)),var(18)!=30636)
	id=152200
	stateno=152200
	helpertype=normal
	ownpal=1
	keyctrl=0
	;;--- property reset
	size.height=(var(33)*10)+(var(11)%10) ;; player id * 10 + type(0:red/1:blue)
	size.head.pos=(root,const(size.head.pos.x)),(root,const(size.head.pos.y)) ;; <-anim,hitanim
	size.mid.pos= (root,const(size.mid.pos.x)), (root,const(size.mid.pos.y))  ;; <-speed_x,y(1/1000)
	size.ground.front=root,const(size.ground.front) ;; <-max_hits/miss_time
	size.ground.back= root,const(size.ground.back)  ;; <-damage hit/guard
	size.air.front=   root,const(size.air.front)    ;; <-hit_x(1/1000)
	size.air.back=    root,const(size.air.back)     ;; <-hit_y(1/1000)
	size.shadowoffset=root,const(size.shadowoffset) ;; <-fall(10=recovery/1=ground/2=air/3=g&a)
;op;	ownpal=1
	size.xscale=1
	size.yscale=1
	;---
	ignorehitpause=1
persistent=0 ;*@@@@@@@@
;--- getpower/givepower
[state 0] ;[.23k]
	type=poweradd
	trigger1=(movecontact=1) && numtarget && (hitpausetime>0) && (hitpausetime=[var(7)-1,var(7)])
	trigger1=var(31)!=1 ;;<-not a reflection
	value=ifelse(movehit,80,40) *(var(2)<3000)
	ignorehitpause=1
;---
;--- moving
[state 0] ;[.24a]
	type=velset
	trigger1=1
	x=fvar(0)
	y=fvar(1)
[state 0] ;[.24b]
	type=posfreeze
	trigger1=movecontact && !var(31)
	trigger2=numtarget(var(2)) && !var(31)
	trigger2=target(var(2)),hitshakeover=0
	trigger3=!time && var(30)>1
	trigger4=var(0)
	ignorehitpause=1

; count contacts ; 接触数加算
[state 0] ;[.24e]
	type=varadd
	trigger1=!time && var(30)>1
	trigger2=(movecontact=1) && !var(31)
	trigger3=var(12)>1 && (root,numprojid(var(1))=0) && (root,projcanceltime(var(1))=1) && var(19)=0 ;;|| (var(19)=1 && var(30)>9)
	var(3)=1 ; <- hitcount ; 命中数加算
	ignorehitpause=1

; check-out ; 消滅判定
[state 0] ;[.24i]
	type=varset
	trigger1=var(3)>=var(6) ;;<- hit times ;命中数
	trigger2=fvar(1)>0 && (pos y+vel y>=0) ;;<- on ground ;地面接触
	trigger3=var(12)>var(4) ;;<- time elapsed ;発射後時間経過(カウントダウン)
	trigger4=time>3456 ;;<- for safety
	var(0)=1 ;;<-contact switch ;接触消滅スイッチ
	ignorehitpause=1
[state 0] ;[.24j]
	type=varset
	trigger1=var(12)>var(4) ;;<- time elapsed ;発射後時間経過(カウントダウン)
	trigger1=var(14)>=5 ;;<-options
	trigger2=frontedgedist<=-128 ;;<- out screen ;画面外
	var(0)=2 ;;<- non-contact ;無接触消滅スイッチ
	ignorehitpause=1
;---
; temp proj for contact ; プロジェ接触判定用ダミー
[state 0] ;[.24n]
	type=projectile
	trigger1=!var(0) && var(19)=0 ;;<-for enemy
	projid=var(1)
	affectteam=e
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projedgebound=600
	projstagebound=600
	getpower=0,0
	givepower=0,0
	projremovetime=1
	ignorehitpause=1
[state 0] ;[.24m]
	type=projectile
	trigger1=!var(0) && var(19)=1 ;;<-for self
	projid=var(1)
	affectteam=f
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projedgebound=600
	projstagebound=600
	getpower=0,0
	givepower=0,0
	projremovetime=1
	ignorehitpause=1
;---
[state 0] ;[.24o]
	type=movehitreset
	trigger1=1
	ignorehitpause=1
;---
;--- temp proj for screen-in ; 出現判定用ダミー
[state 0] ;[.24p]
	type=projectile
	trigger1=var(19)=0 ;;<-for enemy
	projid=stateno
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projremovetime=1
	ignorehitpause=1

;--- --- temy proj for distance check ; 距離計用ダミー
; give opponent informatimes to against proj
; 飛び道具対処(相手)
; ID	action
; 010	guard
; 020	guard/roll/jump
; 030	roll/jump
; 040	jump
; 050	jump fwd
[state 0] ;st.220-1
	type=varset
	trigger1=numenemy
	var(40)=floor((enemynear,screenpos x-screenpos x)*facing/ifelse(fvar(0),fvar(0),0.0001))
;//;v(40):相手に接触までのフレーム数カウントダウン(概算)
[state 0] ;[.25a]
	type=varset
	trigger1=1
	var(41)=(1+(var(40)>17)+(var(40)>26)+(var(40)>36)+(var(40)>188))*10
[state 0] ;[.25b]
	type=projectile
	trigger1=var(40)>0 && var(19)=0 ;;<-for enemy
	projid=stateno+var(41)
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projremovetime=1
	ignorehitpause=1
;--- ---
;;[state 0] ; target_distance
;;	type=displaytoclipboard
;;	trigger1=numenemy
;;	text="V=[%d] VD=[%d] x=[%d] target_x=[%d]"; D=[%d]"
;;	params=var(41),var(40),floor(screenpos x),floor(enemynear,screenpos x);,floor(enemynear,screenpos x-screenpos x)*facing
;--- ---
;---
[state 0] ;[.25d] ; hit_end
	type=helper
	trigger1=var(0)=1
	stateno=91100
	postype=p1
	pos=0,0
	ownpal=1
	size.head.pos=const(size.head.pos.y),0 ;;<- anim,
	size.height= ( var(31) || (var(0)=1 && var(3)>=var(6)) ) ;;<-effect_type
	;;--- v30:reflection swotch  /  v0:contact switch  /  v3,6: max hit times
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.25e] ;; ground_wave
	type=helper
	trigger1=var(0)=1 && (pos y+vel y>0)
	id=159005
	stateno=159005
	ownpal=1
	pos=0,floor(-pos y)
	size.height=0
	size.ground.front=(root,const(size.ground.front))
	size.ground.back= (root,const(size.ground.back))
	persistent=0
[state 0] ;[.25g] ;; dash_dust - hit on ground
	type=helper
	trigger1=var(0)=1 && (pos y+vel y>0)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(-18*const(size.xscale)),floor(-pos y)
	size.xscale=0.5*const(size.xscale)
	size.yscale=0.5*const(size.yscale)
	size.ground.front=(root,const(size.ground.front))
	size.ground.back= (root,const(size.ground.back))
	persistent=0
[state 0] ;[.25i] ;; dash_dust - hit on ground
	type=helper
	trigger1=var(0)=1 && (pos y+vel y>0)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(18*const(size.xscale)),floor(-pos y)
	size.xscale=-0.5*const(size.xscale)
	size.yscale= 0.5*const(size.yscale)
	size.ground.front=(root,const(size.ground.front))
	size.ground.back= (root,const(size.ground.back))
	persistent=0
;---
;---
[state 0] ;[.25k]
	type=removeexplod
	trigger1=var(0)
	id=1
	ignorehitpause=1
[state 0] ;[.25m]
	type=removeexplod
	trigger1=var(0)
	id=2
	ignorehitpause=1
[state 0] ;[.25n]
	type=destroyself
	trigger1=var(0)
	ignorehitpause=1
;---
;--- eject effect ; 射出演出
[state 0] ;[.25o]
	type=explod
	trigger1=!var(32) && (root,pos y>-18) && !root,numprojid(91005)
	anim=f210560
	postype=p1
	pos=floor(root,pos x-pos x)*facing,floor(-pos y)
	scale=-ifelse(ishelper(3000),1.5,1),ifelse(ishelper(3000),2.2,1.5)
	sprpriority=-8
	ownpal=1
	trans=sub
	persistent=0
[state 0] ;[.25p]
	type=explod
	trigger1=!var(32) && (root,pos y>-18) && !root,numprojid(91005)
	anim=f210560
	postype=p1
	pos=floor(root,pos x-pos x)*facing,floor(-pos y)
	scale=-ifelse(ishelper(3000),1.5,1),ifelse(ishelper(3000),2.2,1.5)
	sprpriority=5
	ownpal=1
	persistent=0
;---
[state 0] ;[.25q] ;; dash_dust - eject
	type=helper
	trigger1=!var(32) && (vel y<=0) && (pos y>-100) && !root,numprojid(91005)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(-52*root,const(size.xscale)),floor(-pos y)
	size.xscale=ifelse(ishelper(3000),1.10,0.75)
	size.yscale=ifelse(ishelper(3000),1.10,0.75)
	size.ground.front=(root,const(size.ground.front))
	size.ground.back= (root,const(size.ground.back))
	persistent=0
[state 0] ;[.25r] ;; dash_dust - ejject
	type=helper
	trigger1=!var(32) && (vel y<=0) && (pos y>-100) && !root,numprojid(91005)
	id=152040
	stateno=152040
	ownpal=1
	pos=floor(-12*root,const(size.xscale)),floor(-pos y)
	size.xscale=-ifelse(ishelper(3000),0.65,0.45)
	size.yscale= ifelse(ishelper(3000),0.65,0.45)
	size.ground.front=(root,const(size.ground.front))
	size.ground.back= (root,const(size.ground.back))
	persistent=0
[state 0] ;[.25s] ;; eject flag
	type=projectile
	trigger1=!var(32) ;;<-only once
	projid=91005
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projremovetime=32;; <- within 32 frames
;---
;--- counter
[state 0] ;[.26]
	type=varadd
	trigger1=1
	var(32)=1
	ignorehitpause=1
;--- ---
;--- ---

;==========================
;==========================
; proj chaser after Reflecsion [helper]
; 飛び道具反射後追跡用

; 反射後の飛び道具を,発射主がガードできないため
; 防御誘発用ヘルパー(反射後飛び道具に同行)
;==========================
[statedef 91050]
type=a
movetype=a
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
; temp proj alive flag ; プロジェ有無判定用ダミー
[state 0] ;[.01a]
	type=projectile
	trigger1=1
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
;@;	projremanim=-1
;@;	projcancelanim=-1
	projremovetime=0 ;1
	ignorehitpause=1
;---
; proj chaser id ; 追跡飛び道具識別番号
[state 0] ;[.01b]
	type=varset
	trigger1=!time
	var(33)=const(size.height)
	ignorehitpause=1
[state 0] ;[.01c]
	type=posset
	trigger1=var(33)>0 && playeridexist(var(33))
	x=playerid(var(33)),pos x
	y=playerid(var(33)),pos y-80000+(teamside)*8000 ;;88888
	ignorehitpause=1
[state 0] ;[.04]
	type=destroyself
	trigger1=!playeridexist(var(33)) || roundstate!=2
;op;	trigger2=time>512 ;;<-for_safety
	ignorehitpause=1

;==========================
;==========================
; Proj Disappearing [helper] ; 飛び道具消滅
;==========================
[statedef 91100]
type=a
sprpriority=5
anim=const(size.head.pos.x)
ownpal=1
velset=0,0
ctrl=0
;---
; temp proj for ending flag ; 出現判定用ダミー
[state 0] ;[.00a]
	type=projectile
	trigger1=!time
	projid=91100+anim
	projanim=909601 ;; empty
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projremovetime=1
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.00b]
	type=assertspecial
	trigger1=1
	flag=invisible
;op;	flag2=noshadow
	ignorehitpause=1
[state 0] ;[.00c]
	type=nothitby
	trigger1=1
	value=sca
	ignorehitpause=1
;---
[state 0] ;[.02a] ; fx_mask
	type=palfx
	trigger1=1
	time=1
	add=0,0,0
	mul=384,384,384
	color=0
[state 0] ;[.02b] ; MASK
	type=explod
	trigger1=!time
	anim=anim
	postype=p1
	pos=0,0
	sprpriority=5
	ownpal=0 ;;**
	bindtime=-1
	scale=const(size.xscale),const(size.yscale)
	trans=sub
[state 0] ;[.02c] ; DXOR
	type=explod
	trigger1=!time
	anim=anim
	postype=p1
	pos=0,0
	sprpriority=6
	ownpal=1 ;;**
	bindtime=-1
	scale=const(size.xscale),const(size.yscale)
;---
[state 0] ;[.03a]
	type=explod
	trigger1=!time && const(size.height)=1
	anim=f6565 ; <MASK>
	postype=p1
	pos=0,0
	scale=0.28*ifelse(ishelper(3000),1.5,1),2.3*ifelse(ishelper(3000),1.5,1)
	sprpriority=2
	ownpal=1
	trans=add
alpha=256,256 ;;***
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.03b]
	type=explod
	trigger1=!time && const(size.height)=1
	anim=f6560
	postype=p1
	pos=0,0
	scale=0.28*ifelse(ishelper(3000),1.5,1),2.3*ifelse(ishelper(3000),1.5,1)
	sprpriority=3
	ownpal=1
	trans=sub
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.04]
	type=destroyself
	trigger1=(animtime=0) || (time>=256) ;;<-for_safety
	ignorehitpause=1

;==========================
;==========================
; Super Pause [helper] ; スーパーコンボ効果
;==========================
; level 1
[statedef 88880]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.00a]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
;op;	flag2=nofg
	ignorehitpause=1
;--- init
[state 0] ;[.00b]
	type=null
	trigger1=!time
	trigger1=1|| var(0):=26 ;;<-timer
	trigger1=(root,sysfvar(0)>id) && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| var(20):=playerid(floor(root,sysfvar(0))),var(22) ;;<-type
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.02a]
	type=pause
	trigger1=!time && roundstate<=2
	time=var(0)
	movetime=var(0)
[state 0] ;[.02b]
	type=playsnd
	trigger1=!time && roundstate<=2
	value=f20,0
;--- * use bg palfx ctrl
[state 0] ;[.02c] ; dark_depth
	type=varset
	trigger1=!time
	var(7)=ifelse(var(20)=3,152,ifelse(var(20)=2,128,88))
[state 0] ;[.02d] ; fx_start
	type=bgpalfx
	trigger1=!time
	time=5
	add=0,0,0
	mul=255,255,255
	sinadd=-var(7),-var(7),-var(7),20
[state 0] ;[.02e] ; fx_end
	type=bgpalfx
	trigger1=time>4
	time=var(0)
	add=-var(7),-var(7),-var(7)
	mul=255,255,255
	sinadd=var(7),var(7),var(7),var(0)*4
;---
[state 0] ;[.03a] ; axis_fg
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33000+(var(20)=3)
	id=10
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.03b]
	type=modifyexplod
	trigger1=numexplod(10)
	id=10
	scale=(21-time)*0.15,(21-time)*0.15
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.04a] ; ring-out
	type=explod
	trigger1=time=7 && roundstate<=2
	anim=f33020+(var(20)=3)
	id=12
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.04b]
	type=modifyexplod
	trigger1=numexplod(12)
	id=12
	scale=(time-6)*0.1,(time-6)*0.1
	ignorehitpause=1
;---
[state 0] ;[.04c]
	type=explod
	trigger1=time=7 && var(20)=2 && roundstate<=2
	anim=f33010+(var(30)=3)
	id=11
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.04d]
	type=modifyexplod
	trigger1=numexplod(11)
	id=11
	scale=(time-6)*0.2,(time-6)*0.2
	ignorehitpause=1
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>var(0)
	ignorehitpause=1

;==========================
;==========================
; Level 2 (Max) [helper]
;==========================
[statedef 88882]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.00a]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
;op;	flag2=nofg
	ignorehitpause=1
;--- init
[state 0] ;[.00b]
	type=null
	trigger1=!time
	trigger1=1|| var(0):=33 || var(3):=320 || var(4):=240 || fvar(0):=1
	;--- timer | root_type | bg_scale/localcoord(default)
	trigger1=(root,sysfvar(0)>id) && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| fvar(0):=playerid(floor(root,sysfvar(0))),fvar(0)
	trigger1=1|| var(3):=floor(const240p((playerid(floor(root,sysfvar(0))),var(3)/fvar(0)))) || var(4):=floor(const240p((playerid(floor(root,sysfvar(0))),var(4)/fvar(0))))
	trigger1=1|| var(20):=playerid(floor(root,sysfvar(0))),var(22) ;;<-type
	;--- BG_SCALE
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.01b]
	type=pause
	trigger1=!time && roundstate<=2
	time=var(0)
	movetime=var(0)
[state 0] ;[.01c]
	type=playsnd
	trigger1=!time && roundstate<=2
	value=f20,1
;--- * use bg palfx ctrl
[state 0] ;[.02a] ; dark_depth
	type=varset
	trigger1=!time
	var(7)=ifelse(var(20)=3,255,ifelse(var(20)=2,188,168))
[state 0] ;[.02b] ; fx_start
	type=bgpalfx
	trigger1=!time
	time=5
	add=0,0,0
	mul=255,255,255
	sinadd=-var(7),-var(7),-var(7),20
[state 0] ;[.02c] ; fx_end
	type=bgpalfx
	trigger1=time>4
	time=var(0)
	add=-var(7),-var(7),-var(7)
	mul=255,255,255
	sinadd=var(7),var(7),var(7),var(0)*4
;---
[state 0] ;[.03a] ; axis_fg
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33001-(var(20)=2)
	id=10
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.03b]
	type=modifyexplod
	trigger1=numexplod(10)
	id=10
	scale=(21-time)*0.15,(21-time)*0.15
	ignorehitpause=1
;---
[state 0] ;[.04a] ; axis_fg
	type=explod
	trigger1=roundstate<=2
	anim=f33003-(var(20)=2)
	postype=p1
	sprpriority=-127
	ownpal=1
	bindtime=-1
	scale=0.5*ifelse(random<500,-1,1),0.5*ifelse(random<500,-1,1)
	removetime=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.04b] ; ring-out
	type=explod
	trigger1=time=7 && roundstate<=2
	anim=f33021-(var(20)=2)
	id=12
	postype=p1
	sprpriority=-127
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.04c]
	type=modifyexplod
	trigger1=numexplod(12)
	id=12
	scale=(time-6)*0.1,(time-6)*0.1
	ignorehitpause=1
;---
[state 0] ;[.04d]
	type=explod
	trigger1=time=7 && roundstate<=2
	anim=f33011-(var(20)=2)
	id=11
	postype=p1
	sprpriority=-127
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.04e]
	type=modifyexplod
	trigger1=numexplod(11)
	id=11
	scale=(time-6)*0.2,(time-6)*0.2
	ignorehitpause=1
;---
[state 0] ;[.04f] ; BG
	type=explod
	trigger1=!time && (var(20)=[2,4]) && roundstate<=2
	anim=f33051-(var(20)=2)
	id=15
	space=screen
	postype=left
	pos=var(3)/2,var(4)/2
	scale=var(3)/const240p(320),var(4)/const240p(240)
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	sprpriority=-128
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>var(0)
	ignorehitpause=1

;==========================
;==========================
; Level 3 (Max2) [helper]
;==========================
[statedef 88883]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.00a]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
	flag2=nofg
	ignorehitpause=1
[state 0] ;[.01a]
	type=poweradd
	trigger1=!time
	value=-2000
[state 0] ;[.01b]
	type=null
	trigger1=!time
	trigger1=1|| var(0):=38 || var(2):=214
	ignorehitpause=1
	persistent=0
[state 0] ;[.01c]
	type=pause
	trigger1=!time
	time=var(0)
	movetime=var(0)
[state 0] ;[.01d]
	type=playsnd
	trigger1=!time && roundstate<=2
	value=f20,2
;---
[state 0] ;[.02a1] ; fx_start
	type=bgpalfx
	trigger1=!time && roundstate<=2
	time=13
	add=0,0,0
	mul=255,255,255
	sinadd=-var(2),-var(2),-var(2),52
[state 0] ;[.02a3] ; fx_end
	type=bgpalfx
	trigger1=time>=13 && roundstate<=2
	time=13
	add=-var(2),-var(2),-var(2)
	mul=255,255,255
	sinadd=var(2),var(2),var(2),52
	ignorehitpause=1
;---
[state 0] ;[.02c1] ; axis_fg
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33000
	id=10
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02c2] ; axis_fg
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33001
	id=10
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing=-1
	vfacing=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02e]
	type=modifyexplod
	trigger1=numexplod(10)
	id=10
	scale=(21-time)*0.1,(21-time)*0.1
	ignorehitpause=1
;---
[state 0] ;[.02f] ; axis_fg
	type=explod
	trigger1=roundstate<=2
	anim=f33002+(time%2)
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	scale=0.5*ifelse(random<500,-1,1),0.5*ifelse(random<500,-1,1)
	removetime=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.02g] ; ring-in
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33030
	id=12
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02h] ; ring-in
	type=explod
	trigger1=!time && roundstate<=2
	anim=f33031
	id=12
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing= -1
	vfacing=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02i]
	type=modifyexplod
	trigger1=numexplod(12)
	id=12
	scale=(22-time)*0.16,(22-time)*0.16
	ignorehitpause=1
;---
[state 0] ;[.03a] ; wave
	type=explod
	trigger1=time=7 && roundstate<=2
	anim=f33010
	id=11
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.03b] ; wave
	type=explod
	trigger1=time=7 && roundstate<=2
	anim=f33011
	id=11
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	facing= -1
	vfacing=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.03c]
	type=modifyexplod
	trigger1=numexplod(11)
	id=11
	scale=(time-6)*0.2,(time-6)*0.2
	ignorehitpause=1
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>var(0)
	ignorehitpause=1

;==========================
;==========================
; Max2 BG [helper] ; MAX2 背景
;==========================
[statedef 88870]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
; stop_switch
[state 0] ;[.00a]
	type=varset
	triggerall=!parent,numexplod(88879)
	trigger1=(roundstate!=2) || (parent,ctrl) || (parent,stateno<1000) || (parent,movetype=h)
	trigger2=(parent,numhelper(88870)>1) || (parent,numexplod(88870))
	trigger3=numenemy
	trigger3=(enemy,numhelper(88870)>1) || (enemy,numexplod(88870))
	var(0)=1
	ignorehitpause=1
;--- init
[state 0] ;[.00b]
	type=null
	triggerall=!time
	trigger1=1|| var(1):=const(size.height) || var(1):=var(1)*(var(1)=[0,8]) ||var(2):=214 ||var(4):=240 || var(20):=ifelse(root,facing=1,1,-1) || fvar(0):=1
	;;--- bg type | facing | bg_darkness | bg_scale/localcoord(default)
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| fvar(0):=playerid(floor(root,sysfvar(0))),fvar(0)
	trigger1=1|| var(4):=floor(const240p((playerid(floor(root,sysfvar(0))),var(4)/fvar(0))))
	trigger1=1|| var(46):=playerid(floor(root,sysfvar(0))),var(46) ;;SprPriority
	;;--- BG_SCALE
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.00d]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
	flag2=nofg
	ignorehitpause=1
;---
[state 0] ;[.02a3] ; fx_end
	type=bgpalfx
	trigger1=time>0
	time=40
	add=-var(2),-var(2),-var(2)
	mul=255,255,255
	sinadd=var(2),var(2),var(2),160
	ignorehitpause=1
;---
[state 0] ;[.02b1] ; BG_START
	type=explod
	trigger1=!time && !var(0) && roundstate<=2
	id=1
	anim=f3501+var(1)
	space=screen
	postype=left
	pos=0,0
	removetime=-1
	scale=800,(fvar(1):=var(4)/const240p(240))
	sprpriority=var(46)-31
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02b2] ; BG_END
	type=explod
	trigger1=var(0) && numexplod(1)
	anim=f3551+var(1)
	space=screen
	postype=left
	pos=0,0
	scale=800,fvar(1)
	sprpriority=var(46)-31
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02c] ; BG_LINEs
	type=explod
	trigger1=(time%2) && numexplod(2)<7
	id=2
	anim=f3511
	postype=p1
	pos=floor(50-(random%100) +(parent,pos x-pos x)*facing), ((random%260)-130) +floor(parent,pos y-pos y)
	scale=fvar(3):=(1+(random*0.0025)),fvar(3)*0.025
	sprpriority=var(46)-30
	ownpal=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.03]
	type=removeexplod
	trigger1=var(0)
	id=1
	ignorehitpause=1
;---
[state 0] ;[.04]
	type=destroyself
	trigger1=var(0)
	ignorehitpause=1

;==========================
; Type 2 [helper]
;==========================
[statedef 88872]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
; stop_switch
[state 0] ;[.00a]
	type=varset
	triggerall=!parent,numexplod(88879)
	trigger1=(roundstate!=2) || (parent,ctrl) || (parent,stateno<1000) || (parent,movetype=h)
	trigger2=(parent,numhelper(88870)>1) || (parent,numexplod(88870))
	trigger3=numenemy
	trigger3=(enemy,numhelper(88870)>1) || (enemy,numexplod(88870))
	var(0)=1
	ignorehitpause=1
;--- init
[state 0] ;[.00b]
	type=null
	triggerall=!time
	trigger1=1|| var(2):=214 || var(3):=320 || var(4):=240 || fvar(0):=1
	;;--- bg type | facing | bg_darkness | bg_scale/localcoord(default)
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| fvar(0):=playerid(floor(root,sysfvar(0))),fvar(0)
	trigger1=1|| var(3):=floor(const240p((playerid(floor(root,sysfvar(0))),var(3)/fvar(0)))) || var(4):=floor(const240p((playerid(floor(root,sysfvar(0))),var(4)/fvar(0))))
	trigger1=1|| var(46):=playerid(floor(root,sysfvar(0))),var(46) ;;SprPriority
	;;--- BG_SCALE
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.00d]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
	flag2=nofg
	ignorehitpause=1
;---
[state 0] ;[.02a3] ; fx_end
	type=bgpalfx
	trigger1=time>0
	time=50
	add=-var(2),-var(2),-var(2)
	mul=255,255,255
	sinadd=var(2),var(2),var(2),200
	ignorehitpause=1
;---
[state 0] ;[.02b1] ; BG_START
	type=explod
	trigger1=!time && !var(0) && roundstate<=2
	id=1
	anim=f3521
	space=screen
	postype=left
	pos=0,0
	scale=(fvar(1):=var(3)/const240p(320)*2), (fvar(2):=var(4)/const240p(240))
	removetime=-1
	sprpriority=var(46)-31
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02b2] ; BG_END
	type=explod
	trigger1=var(0) && numexplod(1)
	anim=f3522
	space=screen
	postype=left
	scale=fvar(1),fvar(2)
	sprpriority=var(46)-31
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.02c]
	type=removeexplod
	trigger1=var(0)
	id=1
	ignorehitpause=1
[state 0] ;[.04]
	type=destroyself
	trigger1=var(0)
	ignorehitpause=1

;==========================
;==========================
; Guard Breaking [helper] ; ガードブレ−キング
;==========================
[statedef 88890]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- init
[state 0] ;[.00c]
	type=null
	trigger1=!time
	trigger1=var(2):=22 || var(10):=-96
	;;---    time (>=6) || color
;-; charging ; (溜め)
;-;[state 0] ;[.00d]
;-;	type=varset
;--;	triggerall=time=[var(2),var(2)+40]
;-;!!;	trigger1=parent,command="hold_y"||parent,command="hold_b"
;-;	trigger1=parent,command="holddown"
;-;	var(2)=time+1
;---
[state 0] ;[.01a]
	type=varset
	trigger1=(parent,movetype=h)
	var(3)=1
	ignorehitpause=1
[state 0] ;[.01b]
	type=playsnd
	trigger1=!time && roundstate=2
	value=f2100,1
;---
[state 0] ;[.02a]
	type=bgpalfx
	trigger1=!time && roundstate=2
	time=var(2)
	add=0,0,0
	mul=255,255,255
	sinadd=var(10),var(10),var(10),var(2)*2
;---
[state 0] ;[.02b] ; axis_fg
	type=explod
	trigger1=!time && roundstate=2
	anim=f33000
	id=10
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02c]
	type=modifyexplod
	trigger1=numexplod(10)
	id=10
	scale=(21-time)*0.012,(21-time)*0.318
	ignorehitpause=1
;---
[state 0] ;[.02d] ; axis_fg
	type=explod
	trigger1=!time && roundstate=2
	anim=f33000
	id=11
	postype=p1
	sprpriority=6
	ownpal=1
	bindtime=-1
	facing= ifelse(random<500,-1,1)
	vfacing=ifelse(random<500,-1,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;[.02e]
	type=modifyexplod
	trigger1=numexplod(11)
	id=11
	scale=(21-time)*0.318,(21-time)*0.012
	ignorehitpause=1
;---
[state 0] ;[.02f] ; axis_bg
	type=explod
	trigger1=roundstate=2
	anim=f33002
	postype=p1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	scale=0.5*ifelse(random<500,-1,1),0.5*ifelse(random<500,-1,1)
	removetime=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.02g]
	type=removeexplod
	trigger1=var(3)
	ignorehitpause=1
[state 0] ;[.03]
	type=poweradd
	trigger1=time>=var(2) || var(3)
	value=-1000
;---
[state 0] ;[.04]
	type=destroyself
	trigger1=time>=var(2) || var(3)
	ignorehitpause=1

;==========================
;==========================
; Guard Cancel [helper] ; ガードキャンセル
;==========================
[statedef 88891]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
;[state 0] ;[.00a]
;	type=assertspecial
;	trigger1=1
;;op;	flag=nojugglecheck
;	ignorehitpause=1
[state 0] ;[.01a]
	type=poweradd
	trigger1=!time
	value=-1000
	ignorehitpause=1
	persistent=0
[state 0] ;[.01b]
	type=playsnd
	trigger1=!time
	value=f10010,0
	ignorehitpause=1
	persistent=0
;--- init
[state 0] ;[.01c]
	type=null
	trigger1=!time
	trigger1=var(2):=9 || var(10):=128
	;;--- v2: pausetime , v10: evn_color
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.01d]
	type=pause
	trigger1=!time
	time=var(2)
;;op;	movetime=var(2)-3
	ignorehitpause=1
[state 0] ;[.02a] ; fx
	type=bgpalfx
	trigger1=!time && roundstate=2
	time=var(2)
	add=0,0,0
	mul=255,255,255
	sinadd=var(10),var(10),var(10),var(2)*2
	ignorehitpause=1
;---
[state 0] ;[.02b]
	type=explod
	trigger1=!time && roundstate=2
	anim=f6565 ;<MASK>
	postype=p1
	scale=0.28,2.3
	sprpriority=2
	ownpal=1
	bindtime=-1
	trans=add
alpha=256,256 ;;***
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
[state 0] ;[.02c] ; DXOR
	type=explod
	trigger1=!time && roundstate=2
	anim=f6560
	postype=p1
	scale=0.28,2.3
	sprpriority=3
	ownpal=1
	bindtime=-1
	trans=sub
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
[state 0] ;[.02d] ; bg
	type=explod
	trigger1=!time && roundstate=2
	anim=f2560
	postype=p1
	pos=0,floor(-pos y)
	scale=3,1200 ;120
	sprpriority=-9
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
[state 0] ;[.02e] ; thander
	type=explod
	trigger1=!time && roundstate=2
	anim=f2561
	postype=p1
	pos=0,floor(-pos y)
	scale=1.5*ifelse((gametime%2),1,-1),2.25
	sprpriority=6
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
;---
[state 0] ;[.03]
	type=destroyself
	trigger1=time>var(2)
	ignorehitpause=1

;==========================
;==========================
; Guard Crush [helper] ; ガードクラッシュ
;==========================
[statedef 88892]
type=a
physics=n
movetype=i
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.01] ; init
	type=null
	triggerall=!time
	trigger1=1|| var(4):=240 || var(46):=-5240 || fvar(0):=1
	;---
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| fvar(0):=playerid(floor(root,sysfvar(0))),fvar(0)
	trigger1=1|| var(4):=floor(const240p((playerid(floor(root,sysfvar(0))),var(4)/fvar(0))))
	trigger1=1|| var(46):=playerid(floor(root,sysfvar(0))),var(46) ;;SprPriority
	;---
	ignorehitpause=1
	persistent=0
;---
[state 0] ;[.02] ; BG
	type=explod
	trigger1=!time
	anim=f3531
	space=screen
	postype=left
	scale=3200,var(4)/const240p(240)
	sprpriority=var(46)-40
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0] ;[.03]
	type=destroyself
	trigger1=1
	ignorehitpause=1


;==========================
;==========================
; Addon Main [Helper] ; アドオン中心
;==========================
; sv00:		root id
; sv01-03:	xxx partner index/id
; --- ---
; v00:		helper id # const=90900
; v01-02:	xxx
; v03-04:	gamewidth/gameheight
; v05-06:	xxx
; v07:		<<bit flag>> system_switch
; v08:		<<bit flag>>
;	01:	---modify life
;	02:	---modify power
;	03:	---modify guard point
;	04:	x--modify combo
;	05-06:	---modify pos y>=0 p1,p2
;	07-09:	xxx
;	10-11:	---alive flag
;	12:	---screenbound switch
;	13:	xxx
;	14-25:	---key pressed switch
; v09:		<<bit flag>>
;	01:	---getting nums of combo
;	02:	x--timer check
;	03:	---draw lifebar
;	04:	---draw power
;	05:	---getting damage
;	06-07:	---first attack
;	08:	---hyper combo finish
;	09:	---speci combo finish
;	10:	---round over
;	11:	---(perfect) not used
;	12:	---bonus statge / no result / no combo
;	13:	---red 1/3 life
;	14-15:	---counter hit
;	16:	---options-noko
;	17-18:	---options-mod-life
;	19:	---options-mod-face
; v10:		xxx
; v11-13:	combo / real combo / counter pos / hits type
; v14:		temp
; v15-16:	current player/enemy ID //プレーヤー/相手識別番号
; v17:		against_throw //投げ外し
; v18-19:	ReAction ID Ref.(for a.i.) / 行動対処参照用(主にAIに提供)
; v20-21:	power0/power_view
; v22:		players type
; v23:		life-mod (recover-damage...)
; v24:		stages type (1:water...)
; v25:		pow-max mode timer
; v26-27:	player time
; v28:		roundstate_time
; v29:		--- counter
; v30:		=powermax
; v31-32:	lifebar draw x/y
; v33-34:	powerbar draw x/y
; v35-37:	guard crush
; v38-39:	message type / pos(index)
; v40:		life0/players life (!=root,life)
; v41:		---::options_life-mod
; v42:		damage_real
; v43:		life_view
; v44:		jump counter
; v45:		xxx
; v46:		draw depth //描画深度
; v47:		debug_key_input
; v48:		switch_tag_mode_change_call_striker
; v49:		partner_id in tag-mode
; v50:		dizzy
; v51:		ai(def:/player:-1/cpu:1-8)
; v52:		dizzy recover counter
; v53-56:	striker stateno (p1-p4)
; v57-58:	score
; v59:		xxx
; --- ---
; f00:		zoom / local / scale 1/2/3 [const240/480/720p]
; f01-02:	xxx
; --- ---	[ranking]
; f03:		maxhitcombo
; f04:		xxx
; f05:		rank counter hits
; f06:		rank bk/jd
; f07:		rank defence
; f08:		rank attack
; f09-11:	xxx
; --- ---	[temp]
; f12-13:	pos / scale x1/y1
; f14-15:	pos / scale x2/y2
; f16-17:	pos / scale x3/y3
; --- ---
; f18-19:	p2bodydist x/y
; f20-26:	p1 face info - player-main
; f27-28:	p2 face pos_offset_x/y
; f29:		xxx
; f30-36:	p2 face info - partners
; f37:		face scale
; f38-39:	xxx

;==========================
; starter [helper for init]
; 初期化用
;==========================
[statedef 90909]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0]
	type=assertspecial
	trigger1=1
	flag=nobardisplay
;---
;>>sys::root_id
[state 0]
	type=varset
	trigger1=!time
	sysvar(0)=root,id
[state 0]
	type=varset
	trigger1=!time
	var(15)=sysvar(0)
[state 0]
	type=varset
	trigger1=!time
	var(0)=90900
;---
;;[state 0]
;;	type=posset
;;	trigger1=!time
;;	y=0
;---
;---
;>>sys::init::system_switch_plus
;;>>@Config.System_Switch>>
;; システム設定
; v07: bit flag
[state 0] ;[.01]
	type=null
	trigger1=!time
	trigger1=1 || var(7):= 1073741823 ;;2147483647 ;; ;; default (enable all) (初期値全有効)
;; uncomment to disable (コメントを外すと無効にできます)
;x	trigger1=1 || var(7):=(var(7)^1)        ;; 1st - dizzy/stun system
;x	trigger1=1 || var(7):=(var(7)^2)        ;; 2nd - guard_break system
;	trigger1=1 || var(7):=(var(7)^4)        ;; 3rd - show combo_counter
;	trigger1=1 || var(7):=(var(7)^8)        ;; 4th - show message
;x	trigger1=1 || var(7):=(var(7)^16)       ;; 5th - show score/cpu_level
;	trigger1=1 || var(7):=(var(7)^32)       ;; 6th - show result_panel
;	trigger1=1 || var(7):=(var(7)^64)       ;; 7th - play system voice
	trigger1=1 || var(7):=(var(7)^128)      ;; 8th - show key_input
;	trigger1=1 || var(7):=(var(7)^256)      ;; 9th - show lifebar
;	trigger1=1 || var(7):=(var(7)^512)      ;;10th - show powerbar
;	trigger1=1 || var(7):=(var(7)^1024)     ;;11th - tag system
;	trigger1=1 || var(7):=(var(7)^2048)     ;;12th - tag_assist
;	trigger1=1 || var(7):=(var(7)^4096)     ;;13th - round_call
;	trigger1=1 || var(7):=(var(7)^8192)     ;;14th - ko_call
;	trigger1=1 || var(7):=(var(7)^16384)    ;;15th - show ground_dust effect
;	trigger1=1 || var(7):=(var(7)^32768)    ;;16th - show portrait / face
;x	trigger1=1 || var(7):=(var(7)^65536)    ;;17th - slow camera (warning: this may break your characters)
;x	trigger1=1 || var(7):=(var(7)^131072)   ;;18th - tag_special_partners
;x	trigger1=1 || var(7):=(var(7)^262144)   ;;19th - ai action switch
;@@Debug@@;


;---
;---
;>>sys::init::localcoord
; f0: scale: height [1:240p / 2:480p / (3:720p) / 4:1280p]
[state 0] ;[.02]
	type=null
	trigger1=!time
	trigger1=1|| fvar(0):=1.00 || fvar(0):=const240p(1) ;;<- 
	trigger1=1|| var(3):=floor(320*fvar(0)) || var(4):=floor(240*fvar(0)) || var(4):=floor(gameheight/gamewidth*var(3))
	;;* (vWin) game screen width/Height / (v1.0 / v1.1)	;(画面横/縦)
;;v1.0;;---
;;	trigger1=1|| var(3):=floor(gamewidth) || var(4):=floor(gameheight)
	;;* (v1.0) game screen width/Height	;(画面横/縦)
	;;* (v1.0):   横幅に合わせて縦高を調整 -> 240p(320)
	;;* (IKEMEN): 縦高に合わせて横幅を調整 -> 240p(gamewidth/fvar(0))
;;v1.1 / IKEMEN;;---
	trigger1=1|| var(3):=floor(screenwidth) || var(4):=floor(screenheight)
;@@Debug@@;
	;;* (v1.1) game screen Width/Height	;(画面横/縦)

;---
;---
;;>>sys::bonus_stages_flag ; (12th bit)
; no result panel / no combo
; ボーナスステージ
[state 0] ;[.03] ; on
	type=varset
	trigger1=root,numexplod(920000)
	trigger2=numenemy
	trigger2=enemy,numexplod(920000)
	var(9)=var(9)|4096
;---
;>>sys::stage_type_set
;;>>@Config.Stage_Type>>
; stage type: ( 0: normal 1: water... )
[state 0] ;[.04]
	type=varset
	triggerall=!time && (var(7)&16384) ;; system_switch
	;;--- vWin
;vWin;	trigger1=abs(root,pos x/fvar(0))=73 || abs(root,p2dist x/fvar(0))=146
	;;--- v1.x / ikemen
	trigger1=stagevar(info.author)="WATER" ;;(v1.0)
	var(24)=1
;@@Debug@@;

;---
;;>>@Config.Power_Mode>>
; powerbar mode setting (v22: mode:1-4 / 10:off)
; パワーバーモード設定
;>>sys::init_mode_single
[state 0] ;[.05a]
	type=varset
	trigger1=!time
	var(22)= 1 ;; ifelse(!((root,palno)%3), 3, ((root,palno)%3) )
;>>sys::init_mode_turns
[state 0] ;[.05b]
	type=varset
	trigger1=!time && (var(7)&1024) ;; system_switch
	trigger1=(root,teammode=turns) || (root,numpartner)
	var(22)= 4 ;; tag / team mode


;---
;---
[state 0] ;[.08]
	type=null
	trigger1=!time

;---
;;>>@Config.LifeBar>>
;; lifebar init ; ライフバー 初期値
;sys::init_lifebar
	trigger1=1|| var(31):=floor(ifelse(teamside=1,-18,18)*fvar(0)+var(3)*0.5) ;;<- LifeBar_Pos_X ;(X座標)
	trigger1=1|| var(32):=floor(16*fvar(0)) ;;<- LifeBar_Pos_Y - Fix ;(Y座標-固定)
;;op;	trigger1=1|| var(32):=floor(18*fvar(0)) +floor((1-var(3)*9/16.0/var(4))*16*fvar(0)) ;;<- LifeBar_Pos_Y - Relative ;(Y座標-相対)

;---
;;>>@Config.PowerBar>>
;; powerbar init ; パワーバー 初期値
;sys::init_powerbar
	trigger1=1|| var(33):=var(3)*(teamside=2)+floor(92*fvar(0))*ifelse(teamside=1,1,-1) ;;<- powerbar_pos_x ;(X座標)
	trigger1=1|| var(34):=var(4)-floor(8*fvar(0)) ;;<- powerbar_pos_y ;(Y座標)

	trigger1=1|| fvar(37):=1.0 ;;<- face scale ;(顔サイズ)
	trigger1=1|| var(46):=-5200 ;;<- draw_depth ;(描画深度)
	trigger1=1|| var(57)=ifelse((root,sysvar(4)),(root,var(58)),0) ;;<- get root scores ;(親の点数取得)

;---
;---face draw info ; 顔描画情報
;; fv30-36
;; player-main:     f20-21: pos_x/y,  f22-23:scale,  f24-25:alpha,  f26:spr-priority
;; player-partners: f30-31: pos_x/y,  f32-33:scale,  f34-35:alpha,  f36:spr-priority
;sys::lifebar_face_partner_info ; パートナー顔描画情報

	;;--- player-main
	trigger1=1|| fvar(20):=var(31)/fvar(0) + 142 *ifelse(teamside=1,-1,1)
	trigger1=1|| fvar(21):=var(32)/fvar(0) - 3
	trigger1=1|| fvar(22):=fvar(37) || fvar(23):=fvar(37) ;; sacle
	trigger1=1|| fvar(24):=256 || fvar(25):=0 ;; alpha
	trigger1=1|| fvar(26):=var(46)+6 ;; spr-priority
	;;--- partners
	trigger1=1|| fvar(30):=var(31)/fvar(0) + ifelse(numpartner=1,136,142) *ifelse(teamside=1,-1,1)
	trigger1=1|| fvar(31):=var(32)/fvar(0) - 3
	trigger1=1|| fvar(32):=fvar(37) || fvar(33):=fvar(37) ;; sacle
	trigger1=1|| fvar(34):=64 || fvar(35):=192 ;; alpha
	trigger1=1|| fvar(36):=var(46)-6 ;; spr-priority


;---
;---
; Get Tag-Team assist-stateno (v53-56)
; タッグ時支援ステート番号取得
;sys::tag_assist_stno-1
[state 0] ;[.20]
	type=varset
	trigger1=!time && numpartner
	var(53)=ifelse((root,sysvar(0)>159), (root,sysvar(0)), 1000)
;sys::tag_assist_stno-2
[state 0] ;[.21]
	type=varset
	trigger1=numpartner && playeridexist(root,id+1)
	var(54)=ifelse((playerid(root,id+1),sysvar(0)>159), (playerid(root,id+1),sysvar(0)), 1000)
;--- plus
;sys::tag_assist_stno-3
[state 0] ;[.22]
	type=varset
	trigger1=numpartner>1 && playeridexist(root,id+2)
	var(55)=ifelse((playerid(root,id+2),sysvar(0)>159), (playerid(root,id+2),sysvar(0)), 1000)
;sys::tag_assist_stno-4
[state 0] ;[.23]
	type=varset
	trigger1=numpartner>2 && playeridexist(root,id+3)
	var(56)=ifelse((playerid(root,id+3),sysvar(0)>159), (playerid(root,id+3),sysvar(0)), 1000)

;---
;---
[state 0]
	type=screenbound
	trigger1=(var(7)&65536) || (numpartner>1) ;; system_switch
	value=0
	movecamera=1,1

;---
;---
;>>sys::addon_version_check
;; アドオン版番確認
[state 0] ;[.ver]
	type=explod
	trigger1=!time && const(size.air.front)!=1702252
	anim=f231330
	space=screen
	postype=left
	sprpriority=800
	ownpal=1
	pos=floor(ifelse(teamside=1,60*fvar(0),var(3)-60*fvar(0))), 0
	scale=1,1
	bindtime=-1
	ontop=1
	removetime=-1
	supermovetime=-1
	pausemovetime=-1
	persistet=0
;---
;---
;;sys::over
[state 0] ;[.end]
	type=selfstate
	trigger1=time>=numpartner
	value=90900


;==========================
; main-loop
;==========================
[statedef 90900]
type=s
movetype=i
physics=n
anim=909601 ;; empty
ownpal=1
poweradd=0
velset=0,0
ctrl=0

;---
[state 0]
	type=assertspecial
	trigger1=(roundstate!=2) || (var(9)&4096) || (win) || (lose)
	flag=nobardisplay
;---
;>>sys::starter
[state 0]
	type=changestate
	trigger1=!var(0)
	value=90909
	persistent=0
;---
;---
;>>sys::camera::set
;--- let camera_pos follow me (v1.1 only) ; 焦点をこのﾍﾙﾊﾟｰに従わせる (v1.1 専用)
;; screenbound (12th bit)
[state 0] ; init -on
	type=varset
	trigger1=(var(8)&4096)
	var(8)=var(8)^4096
[state 0] ; check -off
	type=varset
	trigger1=!(var(8)&4096)
	trigger1=var(15)>0 && (playeridexist(var(15)))
	trigger1=(playerid(var(15)),gethitvar(isbound)>0)||(playerid(var(15)),numprojid(920851))||(playerid(var(15)),numexplod(920851)) ;; switch id
	var(8)=var(8)|4096
[state 0]
	type=screenbound
	trigger1=(var(7)&65536) || (numpartner>1) ;; system_switch
	value=0 ;; [def=0]
	movecamera=1,1 ;; [x,y]
;--- bind helper(me) to players position ; プレーヤーに位置を合わせる
[state 0]
	type=posadd
	trigger1=!(var(8)&4096) ;; screenbound switch
	trigger1=roundstate>=2 && var(15)>0 && playeridexist(var(15))
	trigger1=(playerid(var(15)),stateno!=[190190,190196]) ;;<- not as a striker
	x= (playerid(var(15)),pos x-pos x!=[-1,1]) *(playerid(var(15)),pos x-pos x) *facing /20.0  ;;<- speed
	y= (playerid(var(15)),pos y-pos y-const240p(50) ) /20.0  ;;<- speed
[state 0]
	type=posadd
	trigger1=(var(8)&4096) ;; screenbound switch
	trigger1=roundstate>=2 && pos y<-const240p(50) ;; ground pos
	y=1-(pos y / 5.0) ;; init pos y

;---
;>>sys::ai_switch
;;>>@Config.AI>>
;; ai判定  v51 [def:0 / ai:1-8 / hum:-1]
[state 0]
	type=varset
	trigger1=1
	;;--- vWin
;vWin	var(51)=ifelse((matchno>1&&ishometeam=1), ifelse(matchno+roundno-1<8, matchno+roundno-1, 8), 0)
	;;--- v1.0
	var(51)=(root,ailevel) ;; (v1.x)
;;@@Debug@@;

;==========================
;==========================
; current player ID / player change
; 現在プレーヤー識別番号 / 切換
;------------------------

;>>sys::mod-face-flag
[state 0]
	type=varset
	trigger1=(var(9)&262144)
	var(9)=var(9)^262144

;>>sys::partner_id_get1
[state 0] ;;+1
	type=varset
	trigger1=numpartner && roundstate=2 && playeridexist(root,id+1)
	trigger1=playerid(root,id+1),ishelper=0 && playerid(root,id+1),alive && playerid(root,id+1),teamside=teamside && playerid(root,id+1),sysfvar(4)<1
	trigger1=var(15)!=root,id+1
	var(15)=root,id+1  +(var(9):=(var(9)|262144))*0
[state 0] ;;+2
	type=varset
	trigger1=numpartner>1 && roundstate=2 && playeridexist(root,id+2)
	trigger1=playerid(root,id+2),ishelper=0 && playerid(root,id+2),alive && playerid(root,id+2),teamside=teamside && playerid(root,id+2),sysfvar(4)<1
	trigger1=var(15)!=root,id+2
	var(15)=root,id+2  +(var(9):=(var(9)|262144))*0
[state 0] ;;+3
	type=varset
	trigger1=numpartner>2 && roundstate=2 && playeridexist(root,id+3)
	trigger1=playerid(root,id+3),ishelper=0 && playerid(root,id+3),alive && playerid(root,id+3),teamside=teamside && playerid(root,id+3),sysfvar(4)<1
	trigger1=var(15)!=root,id+3
	var(15)=root,id+3  +(var(9):=(var(9)|262144))*0

;---
;>>sys::partner_id_get2
[state 0]
	type=varset
	triggerall=var(15)!=root,id
	trigger1=root,alive && roundstate=2 && root,sysfvar(4)<1
	trigger2=!numpartner || !time
	var(15)=root,id  +(var(9):=(var(9)|262144))*0

;;---
;;>>@Config.Tag_FirstPlayer_Select>>
;>>sys::first_player_select
;; 先発キャラ選択
[state 0]
	type=explod
	trigger1=numpartner && roundstate<2 && root,stateno!=5500
	trigger1=(root,command="holdfwd" || root,command="holdback") && (var(7)&1024) ;; system_switch
	trigger1=1|| var(15):=(root,id)+(root,command="holdback")
	postype=p1
	facing=root,facing
	anim=f296000+teamside
	pos= floor(playerid(var(15)),pos x-pos x)*facing , floor(playerid(var(15)),pos y-pos y +playerid(var(15)),const(size.head.pos.y)-12*fvar(0))
	scale=0.5,0.5
	sprpriority=6
	ownpal=1
	bindtime=-1
	removetime=1


;---
[state 0] ;;<-for safety
	type=varset
	trigger1=!playeridexist(var(15))
	var(15)=root,id

;---
;>>sys::oppenent_id_get1
;; current enemy/oppenents ID ; 相手識別番号
[state 0]
	type=varset
	trigger1=numenemy
	trigger1=enemy,sysfvar(0)>0 && playeridexist(floor(enemy,sysfvar(0)))
	trigger1=var(16)!=playerid(floor(enemy,sysfvar(0))),var(15) && playerid(floor(enemy,sysfvar(0))),var(0)=90900
	var(16)=playerid(floor(enemy,sysfvar(0))),var(15)


;==========================
;;>>@Config.Tag_Command>>
; Tag-Mode Command:: "Change","Partner-Assist" (v48)
; タッグモード時操作コマンド
;>>sys::tag_mode_cmd_reset
[state 0]
	type=varset
	trigger1=var(48)
	var(48)=0 ;; reset

;; change [v48=11] ; 交替
;>>sys::tag_mode_cmd_change
[state 0]
	type=varset
	triggerall=roundstate=2 && numpartner && var(22)=4 && !var(48)
	triggerall=var(15)!=var(49) && playeridexist(var(49))
	triggerall=playerid(var(49)),stateno=[190191,190192] ;; stand-by ;; 待機中
	;;--- player-controlled ;; 操作交替
	;trigger1=(root,command="y") && (root,command="a") && ((root,command="holdfwd") || (root,command="holdback"))
	trigger1=(root,command="v")
	trigger1=var(51)<1 && var(28)>200 ;; helpers_timer ; 内部経過時間
	;;--- ai
	trigger2=var(51)>0 && var(28)>200 ;; helpers_timer ; 内部経過時間
	trigger2=playerid(var(15)),sysfvar(4)<1 && (random%50=0) && playerid(var(15)),life<playerid(var(49)),life
	;;--- forced change (not-alive, stand-by) ;; 強制交替（終止、待機中）
	trigger3=playeridexist(var(15))
	trigger3=(playerid(var(15)),alive=0 && playerid(var(15)),stateno=5150) || (playerid(var(15)),stateno=[190191,190192])
	;;---
	var(48)=11

;; change-interrupted [v48=21] ; 割り込み交替
;>>sys::tag_mode_cmd_change_interrupted
[state 0] ;; "Switch-Canceling"
	type=varset
	trigger1=var(48)=11 && var(15)!=var(49) && playeridexist(var(49))
	trigger1=playerid(var(49)),stateno=190192 ;; stand-by + Assist-OK ;; 待機中+支援OK
	;---
	trigger1=power>=500 ;; player_cost_sc0 ;; パワー消費量
	;---
	trigger1=playerid(var(15)),sysfvar(4)<1 && playerid(var(15)),alive && playerid(var(15)),stateno<3000 && playerid(var(15)),time>2
	trigger1=playerid(var(15)),movetype!=h && playerid(var(15)),gethitvar(isbound)=0
	var(48)=21

;; striker-call / summon [v48=12] ; ストライカー呼出
;>>sys::tag_mode_cmd_call
[state 0]
	type=varset
	triggerall=roundstate=2 && numpartner && var(22)=4 && !var(48) && (var(7)&2048) ;; system_switch
	triggerall=playerid(var(15)),sysfvar(4)<1 && playerid(var(15)),movetype!=h && playerid(var(15)),gethitvar(isbound)=0 && (playerid(var(15)),stateno!=[190190,190199])
	;;--- player-controlled
	;trigger1=(root,command="y") && (root,command="a") && var(51)<1 ;;<- player-controlled
	trigger1=(root,command="w") && var(51)<1 ;;<- player-controlled
	;;--- ai
	trigger2=var(51)>0 && var(15)!=var(49) && playeridexist(var(49))
	trigger2=playerid(var(15)),sysfvar(4)<1 && (random%180=0) && random>(playerid(var(49)),life-playerid(var(15)),life)*100
	;;---
	var(48)=12


;;--- search partner for change or strike
; v14: temp v49: partners id

;>>sys::partner_id_search_init
[state 0]
	type=varset
	trigger1=!time
	var(49)=(root,id)+(numpartner>0)
	persistent=0

;>>sys::partner_id_search_def
[state 0]
	type=null
	triggerall=numpartner && (var(48)=12 || var(15)=var(49) || (playerid(var(15)),alive=0 && playerid(var(15)),stateno=5150 && playerid(var(15)),time=1))
	;;--- p+1
	trigger1=playeridexist(var(14):=var(15)+1)
	trigger1=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger1=var(49):=var(14)
	;;--- p-3
	trigger2=playeridexist(var(14):=var(15)-3)
	trigger2=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger2=var(49):=var(14)
	;;--- p+2
	trigger3=playeridexist(var(14):=var(15)+2)
	trigger3=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger3=var(49):=var(14)
	;;--- p+3
	trigger4=playeridexist(var(14):=var(15)+3)
	trigger4=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger4=var(49):=var(14)
	;;--- p-2
	trigger5=playeridexist(var(14):=var(15)-2)
	trigger5=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger5=var(49):=var(14)
	;;--- p-1
	trigger6=playeridexist(var(14):=var(15)-1)
	trigger6=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && playerid(var(14)),alive
	trigger6=var(49):=var(14)

;>>sys::partner_id_search_change1 ;; shift_fwd (default)
[state 0]
	type=null
	triggerall=(var(48)=11 || var(48)=21)
	;;--- p-1
	trigger1=playeridexist(var(14):=var(15)-1)
	trigger1=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger1=var(49):=var(14)
	;;--- p-2
	trigger2=playeridexist(var(14):=var(15)-2)
	trigger2=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger2=var(49):=var(14)
	;;--- p+3
	trigger3=playeridexist(var(14):=var(15)+3)
	trigger3=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger3=var(49):=var(14)
	;;--- p+2
	trigger4=playeridexist(var(14):=var(15)+2)
	trigger4=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger4=var(49):=var(14)
	;;--- p-3
	trigger5=playeridexist(var(14):=var(15)-3)
	trigger5=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger5=var(49):=var(14)
	;;--- p+1
	trigger6=playeridexist(var(14):=var(15)+1)
	trigger6=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger6=var(49):=var(14)

;;>>sys::partner_id_search_change2 ;; shift_back
[state 0]
	type=null
	triggerall=(var(48)=11 || var(48)=21) && root,command="holdback"
	;;--- p+1
	trigger1=playeridexist(var(14):=var(15)+1)
	trigger1=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger1=var(49):=var(14)
	;;--- p-3
	trigger2=playeridexist(var(14):=var(15)-3)
	trigger2=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger2=var(49):=var(14)
	;;--- p+2
	trigger3=playeridexist(var(14):=var(15)+2)
	trigger3=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger3=var(49):=var(14)
	;;--- p+3
	trigger4=playeridexist(var(14):=var(15)+3)
	trigger4=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger4=var(49):=var(14)
	;;--- p-2
	trigger5=playeridexist(var(14):=var(15)-2)
	trigger5=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger5=var(49):=var(14)
	;;--- p-1
	trigger6=playeridexist(var(14):=var(15)-1)
	trigger6=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside && (playerid(var(14)),stateno=[190191,190192])
	trigger6=var(49):=var(14)

;---
; Get Tag-Team assist-stateno (v53-56)
; タッグ時支援ステート番号取得
;sys::tag_assist_stno-1
[state 0]
	type=varset
	trigger1=(playerid(var(49)),stateno=190193) && (playerid(var(49)),sysvar(1)>0)
	var(53-sysvar(0)+var(49))=playerid(var(49)),sysvar(1)

;;---
;[state 0] ;; id / index
;	type=DisplayToClipboard
;	trigger1=1
;	text="p=(%d,%d,%d,%d), id=(%d ++),  partner_id=(%d)"
;	params=var(15),sysvar(1),sysvar(2),sysvar(3),sysvar(0),var(49)
;;---
;[state 0] ; p-a_stateno
;	type=displaytoclipboard
;	trigger1=numpartner
;	text="root(v53)=[ %d ] p-1(v54)=[ %d ] p-2(v55)=[ %d ] p-3(v56)=[ %d ]"
;	params=var(53),var(54),var(55),var(56)

;==========================
;==========================
;; round-call helper ("fight!") ; ラウンド開始ヘルパー
;sys::helper::round_call
[state 0]
	type=helper
	triggerall=(var(7)&4096) ;; system_switch
	trigger1=roundstate=2 && !numhelper(180000) && (teamside=1)
	id=180000
	stateno=180000
	ownpal=1
	ignorehitpause=1
	supermovetime=88888
	pausemovetime=88888
	persistent=0

;==========================
; Message / 発信 v09,38-39,53
;==========================
; No	Color	Message
; --	---	---
; 01	Yellow	First Attack	(先制攻撃)
; 02	Yellow	Counter Hit.	(後発攻撃)
; 03	Blue..	Technical...	(技巧)
; 04	White.	Blocking....	(ブローキング)
; 05	Red...	Just Defenced	(ジャストディフェンス)
; 06	Green.	Reversal....	(復帰)
; 07	Red...	Danger......	(危険)
; 08	Red...	Stun........	(眩暈)
; 10	Green.	Good........	(連続ヒット評価 1/6)
; 11	Blue..	Great.......	(2/6)
; 12	Yellow	Beautiful...	(3/6)
; 13	Red...	Fantastic...	(4/6)
; 14	White.	Marvelous...	(5/6)
; 15	Color.	M.U.G.E.N...	(6/6 最上位)
; 20	Blue..	Partner Assist	(僚機支援/ストライカー発動)
; 21	Green.	Change.....	(交替)
; 22	Red...	Down.......	(倒れ)
; 23	White.	P-Asisst OK	(僚機支援準備よし/ストライカー待機)

;--- msg type set
;---
;sys::msg_counter_hit
[state 0]
	type=varset
	triggerall=var(38)<99999999
	trigger1=(var(9)&49152)=49152
	var(38)=var(38)*100+2
;---
;sys::msg_first_attack
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2
;__;	trigger1=!(var(9)&32)&&(var(9)&64)
	trigger1=(var(9)&96)=64
	var(38)=var(38)*100+1
;---
;sys::msg_technical
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2
	triggerall=(playerid(var(15)),time=1) && (var(26)!=playerid(var(15)),time)
	trigger1=(playerid(var(15)),stateno=5201) || (playerid(var(15)),stateno=5210) ;;<-recovery
	trigger2=(playerid(var(15)),stateno=115) && (playerid(var(15)),prevstateno=5201)
	trigger3=(playerid(var(15)),prevstateno=5112) ;;<-quick up
	trigger4=(playerid(var(15)),stateno=190130) && (playerid(var(15)),numtarget=0) ;;<-against throw
	trigger5=(playerid(var(15)),stateno=110 || playerid(var(15)),stateno=115) && (playerid(var(15)),prevstateno=[150,152]) ;;<-guard cancel
	var(38)=var(38)*100+3
;;---
;;sys::msg_partner_assist
;[state 0]
;	type=varset
;	triggerall=var(38)<99999999 && roundstate=2 && numpartner
;	trigger1=playerid(var(49)),stateno=190193 && playerid(var(49)),time=2 && var(27)!=playerid(var(49)),time
;	var(38)=var(38)*100+20
;;sys::msg_change
;[state 0]
;	type=varset
;	triggerall=var(38)<99999999 && roundstate=2 && numpartner
;	trigger1=playerid(var(15)),stateno=190193 && playerid(var(15)),time=2 && var(26)!=playerid(var(15)),time && playerid(var(15)),sysfvar(4)=0
;	var(38)=var(38)*100+21
;sys::msg_partner_assist ##+20
;sys::msg_change ##+21
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2 && numpartner
	trigger1=playerid(var(49)),stateno=190193 && playerid(var(49)),time=2 && var(27)!=playerid(var(49)),time
	var(38)=var(38)*100+20+(playerid(var(15)),sysfvar(4)=0)
;sys::msg_p-assist_ok
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2 && numpartner
	trigger1=playerid(var(49)),stateno=190192 && playerid(var(49)),time=2 && var(27)!=playerid(var(49)),time
	var(38)=var(38)*100+23
;---
;sys::msg_down
[state 0]
	type=varset
	trigger1=var(38)<99999999 && roundstate=2
	trigger1=(var(8)&512) && (playerid(var(15)),alive)!=(playerid(var(49)),alive)
	var(38)=var(38)*100+22
;sys::helper::down
[state 0]
	type=helper
	trigger1=(var(8)&512) && (playerid(var(15)),alive)!=(playerid(var(49)),alive)
	trigger1=roundstate=2 && !numhelper(180020)
	id=180020
	stateno=180020
	ownpal=1
	ignorehitpause=1
	supermovetime=88888
	pausemovetime=88888

;; player_alive_flag (10-11th bit) ; プレーヤー生存確認
;sys::flag_player_alive
[state 0] ; off
	type=varset
	trigger1=numpartner && (var(8)&512) && roundstate=2 && win=0 && lose=0
	trigger1=(playerid(var(15)),alive)!=(playerid(var(49)),alive)
	var(8)=var(8)^512
[state 0] ; on
	type=varset
	trigger1=numpartner && !(var(8)&512) && var(15)!=var(49)
	trigger1=(playerid(var(15)),alive)&&(playerid(var(49)),alive)
	var(8)=var(8)|512

;---
;sys::msg_bk/jd
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2
	trigger1=playerid(var(15)),stateno=195500 && playerid(var(15)),time=2 && var(26)!=playerid(var(15)),time
	var(38)=var(38)*100+4+(var(22)=3)
;---
;sys::msg_danger
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2
	trigger1=playerid(var(15)),stateno=190010 && playerid(var(15)),time=2 && var(26)!=playerid(var(15)),time ;;<-guard crush
	trigger2=var(22)=2 && !(var(9)&8192) && (playerid(var(15)),life)<=(playerid(var(15)),lifemax)/3 ;;<-red life
	var(38)=var(38)*100+7
;---
;sys::msg_stun
[state 0]
	type=varset
	triggerall=var(38)<99999999 && roundstate=2
	trigger1=playerid(var(15)),stateno=190116 && playerid(var(15)),time=2 && var(26)!=playerid(var(15)),time ;;<-dizzy state / stun
	var(38)=var(38)*100+8
;---
; warnning sound / announcer.danger! (get danger)
;sys::sound_danger
[state 0]
	type=playsnd
	trigger1=(var(38)%100=[7,8]) && (var(7)&64) ;; system_switch
	value=f10200,1
	channel=0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;---
;sys::msg_reversal
;[state 0]
;	type=varset
;	triggerall=var(38)<99999999 && roundstate=2 && playerid(var(15)),time=1 && (var(26)!=playerid(var(15)),time)
;	trigger1=playerid(var(15)),stateno=0 && (playerid(var(15)),prevstateno=190011||playerid(var(15)),prevstateno=190116)
;	trigger2=numexplod(1856852) && (playerid(var(15)),movetype=a) && (playerid(var(15)),stateno>=1000)
;	var(38)=var(38)*100+6
[state 0]
	type=removeexplod
	triggerall=var(38)<99999999 && roundstate=2 && playerid(var(15)),time=1 && (var(26)!=playerid(var(15)),time)
	trigger1=playerid(var(15)),stateno=0 && (playerid(var(15)),prevstateno=190011||playerid(var(15)),prevstateno=190116)
	trigger1=1|| var(38):=var(38)*100+6
	trigger2=numexplod(1856852) && (playerid(var(15)),movetype=a) && (playerid(var(15)),stateno>=1000)
	trigger2=1|| var(38):=var(38)*100+6
	id=1856852
;sys::msg_reversal_checker
[state 0]
	type=explod
	trigger1=playerid(var(15)),time=1 && (var(26)!=playerid(var(15)),time) && !numexplod(1856852)
	trigger1=(playerid(var(15)),prevstateno=[5000,5212]) || (playerid(var(15)),prevstateno=[140,142])
	anim=0
	id=1856852
	scale=0,0
	removetime=9
;--- ---
;;[state 0] ; msg_type
;;	type=displaytoclipboard
;;	trigger1=1
;;	text="message type=[ %d ] index(v39)=[ %d ]"
;;	params=var(38),var(39)
;--- ---

;--- allocate pos_y(index) max=5 ; 描画番号(位置)を割り当てる 五個まで
;sys::msg_pos_y
;[state 0]
;	type=null
;	triggerall=(var(38)%100)>0
;	triggerall=(var(7)&8) ;; system_switch
;	trigger1=numexplod(66001)=0
;	trigger1=var(39):=1
;	trigger2=numexplod(66001)&&numexplod(66002)=0
;	trigger2=var(39):=2
;	trigger3=numexplod(66001)&&numexplod(66002)&&numexplod(66003)=0
;	trigger3=var(39):=3
;	trigger4=numexplod(66001)&&numexplod(66002)&&numexplod(66003)&&numexplod(66004)=0
;	trigger4=var(39):=4
;	trigger5=numexplod(66001)&&numexplod(66002)&&numexplod(66003)&&numexplod(66004)&&numexplod(66005)=0
;	trigger5=var(39):=5
;	trigger6=numexplod(66001)&&numexplod(66002)&&numexplod(66003)&&numexplod(66004)&&numexplod(66005)&&numexplod(66006)=0
;	trigger6=var(39):=6
;	trigger7=numexplod(66001)&&numexplod(66002)&&numexplod(66003)&&numexplod(66004)&&numexplod(66005)&&numexplod(66006)
;	trigger7=1||var(39):=0

[state 0]
	type=varset
	trigger1=(var(38)%100>0) && (var(7)&8) ;; system_switch
	var(39)=ifelse(!numexplod(66001),1,ifelse(!numexplod(66002),2,ifelse(!numexplod(66003),3,ifelse(!numexplod(66004),4,ifelse(!numexplod(66005),5,ifelse(!numexplod(66006),6,0))))))

;;>>@Config.Message_Pos>>
;sys::msg_draw ;; draw_messages
[state 0] ; bg
	type=explod
	trigger1=(var(38)%100>0) && var(39) && !numexplod(66100+var(39))
	id=66100+var(39)
	anim=f66005+(var(38)%100)*10
	space=screen
	postype=left
	sprpriority=var(46)+20
	ownpal=1
	pos=floor(ifelse(teamside=1,50*fvar(0),var(3)-50*fvar(0))), floor((76+var(39)*10)*fvar(0))
	scale=0.5*ifelse(teamside=1,1,-1),0.15
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ; msg
	type=explod
	trigger1=(var(38)%100>0) && var(39) && !numexplod(66000+var(39))
	id=66000+var(39)
	anim=f66000+(var(38)%100)*10+teamside
	space=screen
	postype=left
	sprpriority=var(46)+21
	ownpal=1
	pos=floor(ifelse(teamside=1,50*fvar(0),var(3)-50*fvar(0))), floor((76+var(39)*10-6)*fvar(0))
	scale=0.5,0.5
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::rank_get_tech1/2
[state 0]
	type=varadd
	triggerall=roundstate=2 && var(38)
;;	trigger1=(var(38)%100=1) ;;<-first_attack
;;	trigger2=(var(38)%100=2) ;;<-counter_hit
;;	trigger3=(var(38)%100=3) ;;<-technical
;;	trigger4=(var(38)%100=[4,5]) ;;<-bk/jd
;;	trigger5=(var(38)%100=6) ;;<-reversal
	trigger1=(var(38)%100=[1,6])
	fvar(5)=0.025

;---
;sys::msg_id_init ;; (right_shift)
[state 0]
	type=varset
	trigger1=var(38)
	var(38)=var(38)/100

;==========================
; against throw ; 投げ外し判定 v17
;==========================
;sys::counter_against_throw
[state 0]
	type=varset
	trigger1=roundstate=2 && numenemy
	trigger1=(enemynear,ctrl) || (enemynear,stateno=[120,159])
	var(17)=10
[state 0]
	type=varadd
	trigger1=var(17)>0 && numenemy
	trigger1=(enemynear,gethitvar(isbound)=0)
	var(17)=-1

;==========================
; life setting ; ライフ設定
;==========================
; indicate life bar (3rd bit) v10,40-43 ; ライフバー表示スイッチ
;sys::lifebar_display_switch
[state 0] ; on
	type=varset
	trigger1=!(var(9)&4) && roundstate=2
	var(9)=var(9)|4
[state 0] ; off
	type=varset
	triggerall=(var(9)&4)
	trigger1=(roundstate!=2) || win || lose || drawgame || (var(9)&4096)
	trigger2=playerid(var(15)),numexplod(920861) ;; switch id
	trigger3=numenemy
	trigger3=enemy,numexplod(920861) ;; switch id
	var(9)=var(9)^4


;------------------------
; getting damage switch (5th bit) ; ダメージ時判定
;sys::lifebar_get_damage_switch
[state 0] ; off
	type=varset
	trigger1=(var(9)&16)
	var(9)=var(9)^16
[state 0] ; on
	type=varset
	triggerall=!(var(9)&16) && (playerid(var(15)),ctrl=0)
	trigger1=(playerid(var(15)),movetype=h) || (playerid(var(15)),gethitvar(isbound))
	trigger2=(playerid(var(15)),stateno=[5000,5120]) || (playerid(var(15)),stateno=[190110,190116]) ; stun/dizzy
	trigger3=(playerid(var(15)),gethitvar(hittime)>0)
	var(9)=var(9)|16 ;;<- damage


;------------------------
;------------------------
;; [OPTIONS]
;sys::options_noKO-off (16th bit,17th bit)
[state 0] ; opt-noko-off
	type=varset
	trigger1=(var(9)&65536)
	trigger1=!(var(9)&16) ;;get_damage_flag
	var(9)=var(9)^65536

;sys::options_mod-life-stop
[state 0] ; opt-mod-life-off
	type=varset
	triggerall=(var(9)&131072) && !(var(9)&65536)
	trigger1=var(41)<=(playerid(var(15)),life) ;;life-recover/damage
	trigger2=playerid(var(15)),movetype=h
	trigger2=playerid(var(15)),stateno!=[120,159] ;;guard
	trigger2=playerid(var(15)),stateno!=195500 ;;bk/jd
	var(9)=var(9)^131072

;sys::options_noko_set
[state 0] ; opt-noko-on / opt-mod-life-on
	type=varset
	;;---
	trigger1=playerid(var(15)),gethitvar(chainid)=8200
;op;	trigger1=playerid(var(15)),gethitvar(hitshaketime)>0
	;---
	trigger2=var(16)>0 && playeridexist(var(16))
	trigger2=playerid(var(16)),stateno=8200 && playerid(var(16)),movehit=1
	;---
	;;---
;__;	var(9)=var(9)|65536  ;;<-(1)opt-noko
;__;	var(9)=var(9)|131072 ;;<-(2)opt-mod-life
	var(9)=var(9)|196608 ;;(1)+(2)

;sys::options_mod-life v23
[state 0] ; off
	type=varset
	trigger1=var(23)
	var(23)=0
[state 0] ; mod-life
	type=varset
	triggerall=(var(9)&131072)
	trigger1=var(41)>playerid(var(15)),life && playerid(var(15)),movetype!=h && (time%5=0)
	trigger2=playerid(var(15)),life<=0
	var(23)=1


;------------------------
;------------------------
; red life flag , under 1/3 (13th bit) ; 赤体力判定、三分の一以下
;sys::lifebar_red_switch
[state 0] ; off
	type=varset
	trigger1=(var(9)&8192) && var(22)=2
	trigger1=(playerid(var(15)),life>playerid(var(15)),lifemax/3)
	var(9)=var(9)^8192
[state 0] ; on
	type=varset
	trigger1=!(var(9)&8192) && var(22)=2
	trigger1=(playerid(var(15)),life<=playerid(var(15)),lifemax/3)
	var(9)=var(9)|8192


;------------------------
;------------------------
;;>>@Config.LifeBar_Draw>>
; draw life bar ; ライフバー描画
;------------------------
;sys::lifebar_cls0
; alpha blend shadow ; 半透明影
[state 0]
	type=removeexplod
	trigger1=!(var(9)&4) || (roundstate!=2)
;;op;	trigger2=var(40)!=(playerid(var(15)),life) ;;<-life
;;op;	trigger3=var(42)!=(playerid(var(15)),life) && !(var(9)&16) ;;<-damage
	id=490000
; frame ; 外枠
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	id=490100
; life-bar
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	id=490200
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	id=490210
; life-bar-color2
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	id=490205
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	id=490215
; face-bg / mask
[state 0]
	type=removeexplod
;;old;	trigger1=!numexplod(490000)
	trigger1=!(var(9)&4) || (roundstate!=2)
	id=490600
; p2/partner-life-bar
[state 0]
	type=removeexplod
	trigger1=!numexplod(490600)
	id=490604
[state 0]
	type=removeexplod
	trigger1=!numexplod(490600)
	id=490605
[state 0]
	type=removeexplod
	trigger1=!numexplod(490600)
	id=490606

;------------------------
;sys::lifebar_draw0
;sys::lifebar_d_shadow ; 半透明影
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(7)&256) ;; system_switch
	trigger1=!numexplod(490000)
	id=490000
	anim=f200100
	sprpriority=var(46)-3
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(100*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	removetime=-1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_timer_bg ; 時間背景
[state 0]
	type=explod
	trigger1=teamside=1 && numexplod(490000)=1
	id=490000
	anim=f200600
	sprpriority=var(46)-2
	ownpal=1
	space=screen
	postype=left
	pos=var(3)/2,var(32)
	removetime=-1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_mod-life_bar ; ライフ変量バー
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000) ;;<- no-life-bars
	trigger2=!(var(9)&131072) ;;<-opt-mod-life
	id=490203
[state 0]
	type=explod
	trigger1=var(41)>playerid(var(15)),life && var(41)>1
	trigger1=numexplod(490000) && !numexplod(490203)
	id=490203
	anim=f200020
	sprpriority=var(46)
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14):=var(31)+ceil(var(41)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=var(41)*0.25/(playerid(var(15)),lifemax), 0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	trans=addalpha
	alpha=128,128
[state 0]
	type=explod
	trigger1=numexplod(490000) && numexplod(490203)=1
	id=490203
	anim=f200010
	sprpriority=var(46)
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14),var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	trans=addalpha
	alpha=128,128

;---
;sys::lifebar_d_damage_bar ; ダメージバー
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000) ;;<- no-life-bars
	trigger2=var(40)!=(playerid(var(15)),life)
	trigger3=var(42)!=(playerid(var(15)),life) && !(var(9)&16) ;;<-not_get_damage
	id=490201
[state 0]
	type=explod
	trigger1=var(42)>playerid(var(15)),life
	trigger1=numexplod(490000) && !numexplod(490201) && !numexplod(490203)
	id=490201
	anim=f200060+ifelse((var(9)&16),0,1)
	sprpriority=var(46)-1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14):=var(31)+ceil(var(42)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=var(42)*0.25/(playerid(var(15)),lifemax), 0.25
	bindtime=-1
	removetime=-1-ifelse((var(9)&16),0,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=numexplod(490000) && numexplod(490201)=1
	id=490201
	anim=f200050+ifelse((var(9)&16),0,1)
	sprpriority=var(46)-1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14),var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1-ifelse((var(9)&16),0,1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_life_bar ; ライフバー
[state 0]
	type=explod
	trigger1=numexplod(490000) && !numexplod(490200)
	id=490200
	anim=f200020
	sprpriority=var(46)+1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=numexplod(490000) && !numexplod(490210)
	id=490210
	anim=f200010
	sprpriority=var(46)+1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_life_bar_color2 ; ライフバー - 色２
[state 0]
	type=explod
	trigger1=numexplod(490000) && !numexplod(490205)
	id=490205
	anim=f200040
	sprpriority=var(46)+2
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=numexplod(490000) && !numexplod(490215)
	id=490215
	anim=f200030
	sprpriority=var(46)+2
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_life_changed ; ライフ変化
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1)
	id=490200
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14):=var(31)+floor(var(43)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=var(43)/4.0/(playerid(var(15)),lifemax), 0.25 *(var(43)>1)
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1)
	id=490210
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14),var(32)
	scale=0.25, 0.25 *(var(43)>1)
;sys::lifebar_d_life_changed_color2
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1)
	id=490205
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(var(43)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=var(43)*0.25/(playerid(var(15)),lifemax), 0.25 *(var(43)>1)
	trans=addalpha
;;old;	alpha=256-( var(14):=var(43)*256/(playerid(var(15)),lifemax) ), var(14)
	alpha=256-( var(14):=ifelse(var(43)>(playerid(var(15)),lifemax)*7/8, 256, var(43)*8/7*256/(playerid(var(15)),lifemax)) ),  var(14)
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1)
	id=490215
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(var(43)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=0.25, 0.25 *(var(43)>1)
	trans=addalpha
	alpha=256-var(14),var(14)
;sys::lifebar_d_life_changed_color2_warnning
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1) && (var(9)&8192)>0 ;; 1/3 life
	id=490205
	trans=addalpha
	alpha=256-( var(14):=abs((gametime%33)-16)*16 ), var(14)
[state 0]
	type=modifyexplod
	trigger1=(var(8)&1) && (var(9)&8192)>0 ;; 1/3 life
	id=490215
	trans=addalpha
	alpha=256-var(14),var(14)

;---
;sys::lifebar_d_life_no_damage ; ライフバー ダメージなし
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000) || var(43)<(playerid(var(15)),lifemax)
	id=490206
[state 0]
	type=explod
	trigger1=var(43)>=(playerid(var(15)),lifemax)
	trigger1=numexplod(490000) && !numexplod(490206)
	id=490206
	anim=f200000
	sprpriority=var(46)+2
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(100*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_frame ; 外枠
[state 0]
	type=explod
	trigger1=numexplod(490200) && !numexplod(490100)
	id=490100
	anim=f200200
	sprpriority=var(46)+3
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14):=var(31)+floor(100*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::lifebar_d_frame_light ; 外枠光沢
[state 0]
	type=explod
	trigger1=numexplod(490100)=1
	id=490100
	anim=f200220
	sprpriority=var(46)+4
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14),var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_bar_stun_alert ; ピヨリ警告
[state 0]
	type=explod
	trigger1=(var(50)>800)||(playerid(var(15)),anim=5300)||(playerid(var(15)),numhelper(403000)) ;;<- stun_counter,stun_state,dizzy_birds
	trigger1=(numexplod(490100)=2) && (time%12=0)
	id=490100
	anim=f200300
	sprpriority=var(46)+4
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(100*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::lifebar_d_get_damage_light ; ダメージ時 ライト
[state 0]
	type=removeexplod
	trigger1=!numexplod(490000)
	trigger2=var(40)!=(playerid(var(15)),life) ;;<-life
	trigger3=var(42)!=(playerid(var(15)),life) && !(var(9)&16) ;;<-damage
	id=490225
[state 0]
	type=explod
	trigger1=var(40)>(playerid(var(15)),life)
	trigger1=numexplod(490200) && !numexplod(490225)
	id=490225
	anim=f200500
	sprpriority=var(46)+4
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.5,0.5
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=modifyexplod
	trigger1=numexplod(490225)
	id=490225
	postype=left
	pos=var(31)+floor(var(43)*100/(playerid(var(15)),lifemax)*fvar(0))*ifelse(teamside=1,-1,1), var(32)

;---
;---face draw info ; 顔描画情報
;; fv30-36
;; player-main:     f20-21: pos_x/y,  f22-23:scale,  f24-25:alpha,  f26:spr-priority
;; player-partners: f30-31: pos_x/y,  f32-33:scale,  f34-35:alpha,  f36:spr-priority
;sys::lifebar_face_partner_info ; パートナー顔描画情報
;[state 0]
;	type=null
;	trigger1=time=1
;	;;--- player-main
;	trigger1=1|| fvar(20):=var(31)/fvar(0) + 142 *ifelse(teamside=1,-1,1)
;	trigger1=1|| fvar(21):=var(32)/fvar(0) - 3
;	trigger1=1|| fvar(22):=fvar(37) || fvar(23):=fvar(37) ;; sacle
;	trigger1=1|| fvar(24):=256 || fvar(25):=0 ;; alpha
;	trigger1=1|| fvar(26):=var(46)+6 ;; spr-priority
;	;;--- partners
;	trigger1=1|| fvar(30):=var(31)/fvar(0) + ifelse(numpartner=1,136,142) *ifelse(teamside=1,-1,1)
;	trigger1=1|| fvar(31):=var(32)/fvar(0) - 3
;	trigger1=1|| fvar(32):=fvar(37) || fvar(33):=fvar(37) ;; sacle
;	trigger1=1|| fvar(34):=64 || fvar(35):=192 ;; alpha
;	trigger1=1|| fvar(36):=var(46)-6 ;; spr-priority
;	;---
;	persistent=0

;---
;sys::lifebar_d_face_shadow ; 顔影
;sys::lifebar_d_partner_lifebar_bg ; パートナー - ライフ背景
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(7)&32768) ;; system_switch
	trigger1=selfanimexist(909002) && ( (!numpartner && !numexplod(490600)) || (numpartner && numexplod(490600)<numpartner) )
	id=490600 ;; face_draw_flag
	anim=f200110+var(22)
	sprpriority=var(46)+8
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(142*fvar(0))*ifelse(teamside=1,-1,1), var(32)+floor((20+numexplod(490600)*3)*fvar(0))
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::lifebar_partner_life_1 ; パートナー - ライフ
[state 0]
	type=explod
	trigger1=numpartner && numexplod(490600) && !numexplod(490604)
	id=490604
	anim=f200111 ;; yellow
	sprpriority=var(46)+10
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(142*fvar(0))*ifelse(teamside=1,-1,1), var(32)+floor(23*fvar(0))
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::lifebar_partner_life_2
[state 0]
	type=explod
	trigger1=numpartner>1 && numexplod(490600) && !numexplod(490605)
	id=490605
	anim=f200110 ;; green
	sprpriority=var(46)+10
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(142*fvar(0))*ifelse(teamside=1,-1,1), var(32)+floor(26*fvar(0))
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::lifebar_partner_life_3
[state 0]
	type=explod
	trigger1=numpartner>2 && numexplod(490600) && !numexplod(490606)
	id=490606
	anim=f200113 ;; red
	sprpriority=var(46)+10
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(142*fvar(0))*ifelse(teamside=1,-1,1), var(32)+floor(29*fvar(0))
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::lifebar_partner_life_changed
[state 0]
	type=modifyexplod
	trigger1=numpartner
	trigger1=( var(14):=var(15)+1+(time%numpartner) -(var(15)-(root,id)+1+(time%numpartner)>numpartner)*(numpartner+1) ) && playeridexist(var(14))
	trigger1=playerid(var(14)),ishelper=0 && playerid(var(14)),teamside=teamside
	id=490604+(time%numpartner)
	scale=(playerid(var(14)),life)*0.25/(playerid(var(14)),lifemax)
	trans=addalpha
	alpha=ifelse(playerid(var(14)),stateno=190192, abs((playerid(var(14)),time%65)-32)*8, 256), 256

;;--- ---
;[state 0] ; p-id
;	type=displaytoclipboard
;	trigger1=numpartner
;	text="root_id=[ %d ] v15= [ %d ] num_p=[ %d ] count=[ %d ] p_now_v(14)=[ %d ]"
;	params=(root,id),var(15),(numpartner),(time%numpartner),var(14)




;------------------------
;------------------------
;sys::sound_announcer_big_damage ;; (opponent)
; 放送音.大ダメージ (相手)
[state 0]
	type=playsnd
	triggerall=(roundstate=2) && (playerid(var(15)),life)>0 && var(40)-(playerid(var(15)),life)>228 ;; damage is more then 228
	triggerall=(var(7)&64) ;; system_switch
	trigger1=(playerid(var(15)),movetype=h) && (playerid(var(15)),gethitvar(guarded)=0) && (playerid(var(15)),stateno!=[190190,190199])
	value=f10100,2
	channel=0
	abspan=ifelse(teamside=1,1,-1)*facing*320

;------------------------
;------------------------
; combo indicator, code by k' d(^-^)b
; modified by MageKing17
; コンボ数表示、K'さんより、MageKing17さん改良
; v11:	nums temp + now ([0-9999]*1000 + [0-9999])
; v12:	real combo + timer (timer[0-9999]*1000 + [0-9999])
; v13:	pos_x / timer
; v14:	temp: combo_counter / hittype
;--- ---
; >03 hits: good
; >05 hits: great
; >10 hits: beautiful
; >15 hits: fantastic
; >20 hits: marvelous
; >25 hits: m.u.g.e.n
;;--- announcer.combine + msg_combo (opponent)
;sys::sound_announcer_combo
[state 0]
	type=playsnd
	trigger1=(roundstate=2) && var(38)<99999999 && numenemy
	trigger1=(enemy,sysfvar(0)>0) && (playeridexist(floor(enemy,sysfvar(0))))
	trigger1=(playerid(floor(enemy,sysfvar(0))),var(0)=90900) && (playerid(floor(enemy,sysfvar(0))),var(11)%10000<1) && (var(14):=(playerid(floor(enemy,sysfvar(0))),var(12)%10000)) && var(14)>2
	trigger1=(var(38):=var(38)*100+10+(var(14)>4)+(var(14)>9)+(var(14)>14)+(var(14)>19)+(var(14)>24)) && (var(14)>4) && (var(7)&64) ;; system_switch
	value=f10100,3 +(var(14)>9)
	channel=0
	abspan=ifelse(teamside=1,-1,1)*facing*320

;;sys::combo_real_reset
[state 0]
	type=varset
	trigger1=(var(11)%10000<1)
	var(12)=0
;---
;sys::combo_indicate_nums
;; コンボ数計算
[state 0]
	type=varadd
	triggerall=(var(11)/10000)=(var(11)%10000) && (var(11)%10000)<9999 ;;<- max combo
	triggerall=(playerid(var(15)),ctrl=0) && (playerid(var(15)),stateno!=[120,159]) && (playerid(var(15)),stateno!=[190190,190199]) && (playerid(var(15)),stateno!=195500)
	trigger1=var(40)>(playerid(var(15)),life) && (var(9)&16) ;;<-life changed && getting damage
	trigger2=playerid(var(15)),gethitvar(hitshaketime)>0 && playerid(var(15)),gethitvar(damage)=0 && playerid(var(15)),time=1 && (var(26)!=playerid(var(15)),time)
	var(11)=1 +( var(12):=var(12)+(playerid(var(15)),stateno=[5000,5199]) )*0 ;;<-real combo set
	;--- ;memo; v#=v#+(P#,gethitvar(hitcount))*(!P#,gethitvar(guarded))
;sys::combo_indicate_init
[state 0]
	type=varset
	triggerall=(var(11)%10000)>0
	trigger1=(roundstate>3) || !(var(9)&16) ;;<-not getting damage
	trigger2=(playerid(var(15)),ctrl) || (playerid(var(15)),stateno<160) || (playerid(var(15)),stateno=8200) || (var(9)&4096) ;;<-bonus stage
	var(11)=0
;---
;;;>>@Config.Combo.Pos>>
;;sys::combo_d_pos ;; v13: pos x (240p)
[state 0]
	type=null
	trigger1=(var(11)%10000=2) && ((var(11)/10000)!=(var(11)%10000)) ;;<- combo start 
	trigger1=1|| var(13):=ifelse(teamside=2,-150,floor(var(3)/fvar(0))+150) ;;<-init pos x
	trigger2=(var(11)%10000>1) && (var(11)/10000)<(var(11)%10000) ;;<-combo update
	trigger2=1|| var(13):=var(13)+4*ifelse(teamside=2,-1,1) ;;<-shake
	trigger3=numexplod(97800) && ((teamside=2 && var(13)<50) || (teamside=1 && var(13)>floor(var(3)/fvar(0))-50)) ;; goal pos x
	trigger3=1|| var(13):=var(13)+(ifelse(teamside=2,50,floor(var(3)/fvar(0))-50)-var(13))/3 +teamside*2-3 ;;<-combo pos x shift
;---
;sys::combo_d_cls
[state 0]
	type=removeexplod
	trigger1=(var(11)%10000>1) && ((var(11)/10000)!=(var(11)%10000) || (var(12)/10000=0))
	id=97800  +( var(12):= (var(12)%10000) +280000 )*0 ;;<-view time reset
[state 0]
	type=removeexplod
	trigger1=!numexplod(97800)
	id=97801
[state 0]
	type=removeexplod
	trigger1=!numexplod(97800)
	id=97802
[state 0]
	type=removeexplod
	trigger1=!numexplod(97800)
	id=97803
[state 0]
	type=removeexplod
	trigger1=!numexplod(97800)
	id=97804
[state 0]
	type=removeexplod
	trigger1=!numexplod(97800)
	id=97805
;---
;sys::combo_d_bg
[state 0]
	type=explod
	id=97800
	triggerall=(var(7)&4) ;; system_switch
	trigger1=(var(11)%10000>1) && !numexplod(97800)
	anim=f300155 +( var(14):=(playerid(var(15)),stateno!=[5000,5199]) ) ;;<-hit type
	space=screen
	postype=left
	sprpriority=var(46)+22
	ownpal=1
	scale=0.5,0.15
	facing=ifelse(teamside=1,-1,1)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::combo_d_bg_shadow
[state 0]
	type=explod
	id=97800
	trigger1=numexplod(97800)=1
	anim=f300157
	space=screen
	postype=left
	sprpriority=var(46)+20
	ownpal=1
	scale=0.7,1
	facing=ifelse(teamside=1,-1,1)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::combo_d_hits
[state 0]
	type=explod
	id=97801
	trigger1=numexplod(97800) && !numexplod(97801)
	anim=f300150+var(14)
	space=screen
	postype=left
	sprpriority=var(46)+23
	ownpal=1
	scale=0.5,0.5
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::combo_d_nums
[state 0]
	type=explod
	id=97802
	trigger1=numexplod(97800) && !numexplod(97802)
	anim=f300050+((var(11)%10000)%10)  +var(14)*10
	space=screen
	postype=left
	sprpriority=var(46)+24
	ownpal=1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	id=97803
	trigger1=(var(11)%10000>9) && numexplod(97800) && !numexplod(97803)
	anim=f300050+(((var(11)%10000)/10)%10)  +var(14)*10
	space=screen
	postype=left
	sprpriority=var(46)+24
	ownpal=1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	id=97804
	trigger1=(var(11)%10000>99) && numexplod(97800) && !numexplod(97804)
	anim=f300050+(((var(11)%10000)/100)%10)  +var(14)*10
	space=screen
	postype=left
	sprpriority=var(46)+24
	ownpal=1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	id=97805
	trigger1=(var(11)%10000>999) && numexplod(97800) && !numexplod(97805)
	anim=f300050+(((var(11)%10000)/1000)%10)  +var(14)*10
	space=screen
	postype=left
	sprpriority=var(46)+24
	ownpal=1
	scale=0.25,0.25
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::combo_d_changed
[state 0]
	type=modifyexplod
	trigger1=numexplod(97800)
	id=97800
	postype=left
	pos=floor(var(13)*fvar(0)), floor(75*fvar(0))
[state 0]
	type=modifyexplod
	trigger1=numexplod(97801)
	id=97801
	postype=left
	pos=floor((var(13)+(numexplod(97803)+numexplod(97804)+numexplod(97805))*7.5-17)*fvar(0)), floor(69*fvar(0))
[state 0]
	type=modifyexplod
	trigger1=numexplod(97802)
	id=97802
	postype=left
	pos=floor((var(13)+(numexplod(97803)+numexplod(97804)+numexplod(97805))*7.5-9)*fvar(0)), floor(79*fvar(0))
[state 0]
	type=modifyexplod
	trigger1=numexplod(97803)
	id=97803
	postype=left
	pos=floor((var(13)+(numexplod(97803)+numexplod(97804)+numexplod(97805))*7.5-24)*fvar(0)), floor(79*fvar(0))
[state 0]
	type=modifyexplod
	trigger1=numexplod(97804)
	id=97804
	postype=left
	pos=floor((var(13)+(numexplod(97803)+numexplod(97804)+numexplod(97805))*7.5-39)*fvar(0)), floor(79*fvar(0))
[state 0]
	type=modifyexplod
	trigger1=numexplod(97805)
	id=97805
	postype=left
	pos=floor((var(13)+(numexplod(97803)+numexplod(97804)+numexplod(97805))*7.5-54)*fvar(0)), floor(79*fvar(0))
;---
;sys::combo_update_counter
[state 0]
	type=varset
	trigger1=(var(11)/10000)!=(var(11)%10000)
	var(11)=(var(11)%10000)*10001
;sys::combo_d_display_time
[state 0]
	type=varadd
	trigger1=(var(12)>=10000)
	var(12)=-10000

;;--- ---
;;[state 0] ; combo
;;	type=displaytoclipboard
;;	trigger1=1
;;	text="attack=[ %d ] gethit=[ %d ] var12=[ %d ] type=[ %d ]"
;;	params=(playerid(var(15)),gethitvar(hitcount)), var(11), var(12), var(14)
;;--- ---

;------------------------
;------------------------
; modify life bar switch (1st bit)
; 描画変動
;sys::life_changed
[state 0] ; off
	type=varset
	trigger1=(var(8)&1)
	trigger1=var(43)=(playerid(var(15)),life)
	var(8)=var(8)|1
[state 0] ; on
	type=varset
	trigger1=!(var(8)&1)
	trigger1=var(43)!=(playerid(var(15)),life)
	var(8)=var(8)^1
;---
;;>>@Config.DamageToPower>>
;sys::manage_damage_to_pow ; パワー管理 ; pow type v22 [1,2,3,4]
;---
[state 0]
	type=poweradd
	triggerall=roundstate=2 && var(20)=power && (var(22)=1||var(22)=4) ;; type::1,4 ;normal,tag
	trigger1=var(40)-(playerid(var(15)),life)>0 ;; get damage
	value=(var(40)-(playerid(var(15)),life))*ifelse(playerid(var(15)),gethitvar(guarded),3,1)
[state 0]
	type=poweradd
	triggerall=roundstate=2 && var(20)=power && (var(22)=3) ;; type::3 jd
	trigger1=var(40)-(playerid(var(15)),life)>0 ;; get damage
	trigger2=playerid(var(15)),stateno=150||playerid(var(15)),stateno=152||playerid(var(15)),stateno=154 ;air
	trigger2=playerid(var(15)),time=1 && (var(26)!=playerid(var(15)),time)
	value=floor((var(40)-(playerid(var(15)),life)+10)*ifelse(playerid(var(15)),gethitvar(guarded),5,1))
;---
;sys::memo_life ;; ライフ保存
[state 0]
	type=varset
	trigger1=var(40)!=(playerid(var(15)),life) && roundstate=2
	var(40)=(playerid(var(15)),life)

;sys::memo_mod-life ;; ライフ変動保存
[state 0]
	type=varset
	trigger1=var(41)!=(playerid(var(15)),life)
	trigger1=!(var(9)&131072) ;;<-opt-mod-life
	var(41)=(playerid(var(15)),life) +(playerid(var(15)),life<=0) ;; <-avoids zero life

;sys::memo_damage ;; ダメージ保存
[state 0]
	type=varset
	trigger1=var(42)!=(playerid(var(15)),life)
	trigger1=!(var(9)&16) ;;<-get_damage_flag
	var(42)=(playerid(var(15)),life)

;sys::modify_life_for_view ;; ライフ変化
[state 0]
	type=varadd
	trigger1=var(43)!=(playerid(var(15)),life) && roundstate=2
	var(43)=((playerid(var(15)),life)-var(43))/8+ifelse(var(43)>(playerid(var(15)),life),-1,1)


;------------------------
;------------------------


;==========================
; guard crush point
; ガード クラッシュ ポイント
;==========================
; v35-36
;sys::guard_b_recover1 ;; recover -> stop ; (回復 -> 停止)
[state 0]
	type=varset
	triggerall=var(35)
	trigger1=!var(36)
	trigger2=var(36) && (playerid(var(15)),movetype=h)
	var(35)=0
;sys::guard_b_recover2 ;; recover -> start normal speed ; (回復 -> 開始 - 通常速度)
[state 0]
	type=varset
	trigger1=var(35)<1 && playeridexist(var(16))
	trigger1=playerid(var(16)),movetype=h
	var(35)=1
;sys::guard_b_recover3 ;; recover -> start normal speed 2 ; (回復 -> 開始 - 通常速度 2)
[state 0]
	type=varset
	triggerall=var(35)<2
	trigger1=playerid(var(15)),stateno=190010 ;; << ガードクラッシュ
	var(35)=2
;sys::guard_b_cost ;; guard point consumptiom ; (ガードポイント消耗)
[state 0]
	type=varadd
	triggerall=(var(7)&2) ;; system_switch
	trigger1=(playerid(var(15)),stateno=150)||(playerid(var(15)),stateno=152)||(playerid(var(15)),stateno=154) ;air
	trigger1=(playerid(var(15)),time=1) && (var(26)!=playerid(var(15)),time)
;old;	var(36)=1+(playerid(var(15)),gethitvar(damage)+playerid(var(15)),gethitvar(hitshaketime))/10
	var(36)=1+(playerid(var(15)),gethitvar(damage)+playerid(var(15)),gethitvar(hitshaketime))/2 / (11-floor((50-var(36))*0.175))
;sys::guard_b_recover ; (回復)
[state 0]
	type=varadd
	triggerall=var(35) && var(36)>0
	trigger1=var(35)=1 && (gametime%50=0) ;;<-normal speed ;通常速度
	trigger2=var(35)=2 && (gametime%10=0) ;;<-speed2 ;速度2
	var(36)=-1
[state 0]
	type=varset
	trigger1=var(36)
	trigger1=(playerid(var(15)),stateno=190010) ;;<-guardcrush state ガードクラッシュ
	var(36)=var(36)/2
;sys::guard_b_range ; (範囲)
[state 0]
	type=varset
	trigger1=(var(36)!=[0,50])
	var(36)=ifelse(var(36)<0,0,50)

;------------------------
;;>>@Config.GuardBar>>
; draw guard bar ; ガードゲージ描画
;sys::guardbar_d_cls
[state 0] ; bar1
	type=removeexplod
	trigger1=!(var(9)&4)
	id=493000
[state 0] ; bar2
	type=removeexplod
	trigger1=!numexplod(493000)
	id=493010
[state 0] ; warnning bg
	type=removeexplod
	trigger1=!numexplod(493000)||var(37)<=39
	id=493030
;---
;sys::guardbar_d_bar ; ガードゲージ
[state 0]
	type=explod
	trigger1=(var(9)&4) && numexplod(490000) && numexplod(490100) && !numexplod(493000)
	id=493000
	anim=f210000
	sprpriority=var(46)+1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=numexplod(493000) && !numexplod(493010)
	id=493010
	anim=f210005
	sprpriority=var(46)+2
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::guardbar_d_changed ; ガードバー変化
[state 0]
	type=modifyexplod
	trigger1=(var(8)&4)
	id=493000
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14):=var(31)-floor(((50-var(37))*39/50-3)*fvar(0))*ifelse(teamside=1,1,-1), var(32)+floor(6*fvar(0))
	scale=(50-var(37))/200.0, 0.25 *(var(37)<50)
[state 0]
	type=modifyexplod
	trigger1=(var(8)&4)
	id=493010
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(14),var(32)+floor(6*fvar(0))
	scale=0.25,0.25 *(var(37)<50)
;---
;sys::guardbar_d_frame_warnning ; 外枠2 警告
[state 0]
	type=explod
	trigger1=var(37)>39 && numexplod(493010) && !numexplod(493030)
	id=493030
	anim=f210012
	sprpriority=var(46)+6
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31)+floor(100*fvar(0))*ifelse(teamside=1,-1,1), var(32)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;------------------------
;------------------------
;sys::guard_b_modify ; (3rd bit)
; 描画変動
[state 0] ; off
	type=varset
	trigger1=(var(8)&4)
	trigger1=var(37)=var(36)
	var(8)=var(8)|4
[state 0] ; on
	type=varset
	trigger1=!(var(8)&4)
	trigger1=var(37)!=var(36)||!time
	var(8)=var(8)^4

;sys::guard_b_memo_guard_point
; ガードポイント保存
[state 0]
	type=varadd
	trigger1=roundstate=2
	trigger1=var(37)!=var(36)
	var(37)=(var(36)-var(37))/8+ifelse(var(37)>var(36),-1,1)


;==========================
; power bar ; パワーバー
;==========================
; v20-22,25,30
; v22: type
; 1: N(normal)
; 2: C(blobking)
; 3: S(just defense)
; 4: T(team mode striker)

;sys::powerbar_indicate_switch ;; (4th bit)
; パワーバー表示スイッチ

[state 0] ; on
	type=varset
	trigger1=!(var(9)&8) && roundstate=2
	var(9)=var(9)|8

[state 0] ; off
	type=varset
	triggerall=(var(9)&8)
	trigger1=(roundstate!=2) || win || lose || drawgame || (var(9)&4096) || const(size.height)=1 || !(var(7)&512) ;; system_switch
	trigger2=(playerid(var(15)),numexplod(920861)) || (playerid(var(15)),numexplod(920862)) ;; switch id
	trigger3=numenemy
	trigger3=enemy,numexplod(920861) ;; switch id
	var(9)=var(9)^8

;------------------------
; modify power ; パワー制御
;------------------------
;sys::powerbar_update_powermax
[state 0]
	type=varset
	trigger1=var(30)!=playerid(var(15)),powermax
	var(30)=playerid(var(15)),powermax

;------------------------
;;>>@Config.Power_Start>>
;sys::powerbar_start_power ;; パワー量開始時
[state 0]
	type=poweradd
	trigger1=!time && roundno=1 && power<1000 ;; var(30)/3
	value=1000 ;; var(30)/3
	persistent=0
;sys::powerbar_manage_get
[state 0]
	type=poweradd
	triggerall=var(20)>0 && power>var(20)
	triggerall=(playerid(var(15)),stateno!=195500) && (playerid(var(15)),movetype!=h)
	trigger1=(var(22)=2 && power<1000) || (var(22)=3 && power<2000)
	value=-(power-var(20))/ifelse(var(22)=2,2,1)

;------------------------
; type 1 N (normal)
;------------------------

;------------------------
; type 2 C (blocking)
;------------------------
;sys::powerbar_up1 ;; powerup during (1/3)redlife ;; 赤体力(1/3)時増加
[state 0]
	type=poweradd
	trigger1=var(22)=2 && power<1000
	trigger1=(var(9)&8192)
	value=2

;sys::powerbar_range2
[state 0]
	type=powerset
	trigger1=var(22)=2 && power>=1000 && var(20)<=power
	value=ifelse(!(var(9)&8192),1000,var(30))
[state 0]
	type=powerset
	trigger1=var(22)=2 && var(20)>power
	trigger1=power<ifelse(!(var(9)&8192),1000,var(30))
	value=0

;------------------------
; type 3 S (just defense / max mode)
;------------------------
; v25:	max mode timer(マックス状態時間)
;sys::powerbar_max-mode_on ; マックスモード開始
[state 0]
	type=varset
	trigger1=roundstate=2 && var(22)=3 && var(25)=0 ;;<-init
	trigger1=power>=var(30)/3*2
	var(25)=2000 ;;<- max mode time & flag
;---
;sys::powerbar_max-mode_eff ; パワーマックス時効果
;sys::sound_power-max-mode
[state 0]
	type=playsnd
	trigger1=roundstate=2 && var(22)=3 && var(25)=2000 ;;<- just started
	value=f10200,3
	channel=1
[state 0] ; bg
	type=explod
	trigger1=roundstate=2 && var(22)=3 && var(25)=2000 ;;<- just started
	trigger1=!numexplod(21310)
	id=21310
	anim=f210310
	sprpriority=-52
	ownpal=1
	postype=p1
	scale=playerid(var(15)),const(size.xscale)*1.5*ifelse(random<500,1,-1),playerid(var(15)),const(size.yscale)*1.15*ifelse(random<500,1,-1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=modifyexplod
	trigger1=numexplod(21310)
	id=21310
	postype=p1
	pos=floor(playerid(var(15)),pos x-pos x+const(size.mid.pos.x))*facing,floor(playerid(var(15)),pos y-pos y+const(size.mid.pos.y))
;---
[state 0]
	type=powerset
	trigger1=var(22)=3 && var(25)=2000 ;;<- just started
	value=var(30) ;;<- powermax
;---
;sys::powerbar_max-mode_to-max ; パワー制御
[state 0]
	type=varadd
	trigger1=var(22)=3 && var(25)>0
	var(25)=-ifelse(power=var(30),2, ifelse(var(30)-power>var(25),var(25)-2,(var(30)-power)) )
;sys::powerbar_max-mode_free-pow
[state 0]
	type=powerset
	trigger1=var(22)=3 && var(25)>0 && power<var(30)
	value=var(30)
;---
;sys::powerbar_max-mode_over
[state 0]
	type=varset
	trigger1=var(22)=3 && var(25)<1 && power>=var(30)
	var(25)=-2000 ;;<- max mode over flag
;sys::powerbar_max-mode_pow-reset
[state 0]
	type=powerset
	triggerall=var(22)=3
	trigger1=var(25)=-2000 ;;<- just stopped
	trigger1=1|| var(21):=0
	trigger2=!time && power>=var(30)/3*2
	value=var(30)/3
;sys::powerbar_max-mode_init
[state 0]
	type=varset
	trigger1=var(22)=3 && var(25)=-2000 ;;<- just stopped
	var(25)=0

;------------------------
;------------------------
;;>>@Config.PowerBar_Draw>>
; draw power bar ; パワー描画
;------------------------
;sys::powerbar_d_cls
[state 0] ; bg
	type=removeexplod
	triggerall=numexplod(492000)
	trigger1=!(var(9)&8)
	trigger2=(var(20)/1000)!=(power/1000)
	id=492000
[state 0] ; string / numbers ; 文字/数字
	type=removeexplod
	trigger1=!numexplod(492000)
	id=492300
[state 0] ; bar1/2
	type=removeexplod
	trigger1=!numexplod(492000)
	id=492200
[state 0] ; bar2/2
	type=removeexplod
	trigger1=!numexplod(492000)
	id=492201
[state 0] ; frame ; 外枠
	type=removeexplod
	trigger1=!numexplod(492000)
	id=492100
[state 0] ; frame-light ; 外枠光沢
	type=removeexplod
	trigger1=!numexplod(492000)
	id=492101

;------------------------
; type 1 N (normal)
;------------------------
;sys::powerbar_d_bg ; 背景
[state 0]
	type=explod
	trigger1=(var(9)&8) && !numexplod(492000)
	id=492000
	anim=f100050+var(22)
	sprpriority=-1
	ownpal=1
	space=screen
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(33),var(34)
	scale=0.25,0.25
	removetime=-1
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::powerbar_d_bar1-1/2 ; パワーバー
[state 0]
	type=explod
	trigger1=numexplod(492000) && !numexplod(492200)
	id=492200
	anim=f100100 +( var(14):= ifelse(power>=var(30)||power>=10000||(power>=2000&&(var(22)=[2,3])), 10, (power/1000)%6) +((var(22)-1)%3)*1000 )
	sprpriority=0
	ownpal=1
	space=screen
	postype=left
	pos=0,800
	facing=ifelse(teamside=1,-1,1)
	bindtime=-1
	removetime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::powerbar_d_bar1-2/2
[state 0]
	type=explod
	trigger1=numexplod(492000) && !numexplod(492201)
	id=492201
	anim=f100200+var(14)
	sprpriority=0
	ownpal=1
	space=screen
	postype=left
	pos=0,800
	facing=ifelse(teamside=1,-1,1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::powerbar_d_bar2-1/2 ; パワーバー
[state 0]
	type=explod
	trigger1=numexplod(492000) && numexplod(492200)=1
	id=492200
	anim=f100300+var(14)
	sprpriority=1
	ownpal=1
	space=screen
	postype=left
	pos=0,800
	facing=ifelse(teamside=1,-1,1)
	bindtime=-1
	removetime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::powerbar_d_bar2-2/2
[state 0]
	type=explod
	trigger1=numexplod(492000) && numexplod(492201)=1
	id=492201
	anim=f100400+var(14)
	sprpriority=1
	ownpal=1
	space=screen
	postype=left
	pos=0,800
	facing=ifelse(teamside=1,-1,1)
	scale=0.25,0.25
	bindtime=-1
	removetime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::powerbar_d_power_changed-1 ; パワー変化1
[state 0]
	type=modifyexplod
	trigger1=(var(22)!=[2,3]) && (var(9)&8) && (var(8)&2)
	id=492200
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(14):=var(33)+floor((ifelse((var(21)>=var(30)||var(21)>=10000),1000,(var(21)%1000))*80/1000-80)*fvar(0))*ifelse(teamside=1,1,-1),var(34)
	scale=ifelse(var(21)>=var(30)||var(21)>=10000,0.25,(var(21)%1000)*0.25/1000.00), 0.25
;---
;sys::powerbar_d_power_changed-2 ; パワー変化2
[state 0]
	type=modifyexplod
	trigger1=(var(22)=2) && (var(9)&8) && (var(8)&2)
	id=492200
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(14):=var(33)+floor((ifelse((var(21)>0&&var(21)%1000=0),1000,(var(21)%1000))*80/1000-80)*fvar(0))*ifelse(teamside=1,1,-1),var(34)
	scale=ifelse(var(21)>0&&(var(21)%1000=0),0.25,(var(21)%1000)*0.25/1000.00), 0.25
;---
;sys::powerbar_d_power_changed-3a ; パワー変化3a
[state 0]
	type=modifyexplod
	trigger1=(var(22)=3) && (var(9)&8) && (var(8)&2) && !var(25)
	id=492200
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(14):=var(33)+floor((ifelse((var(21)>0&&var(21)%2000=0),1000,(var(21)%2000))*80/2000-80)*fvar(0))*ifelse(teamside=1,1,-1),var(34)
	scale=ifelse(var(21)>0&&(var(21)%2000=0),0.25,(var(21)%2000)*0.25/2000.00), 0.25
;sys::powerbar_d_power_changed-3b ; パワー変化3b
[state 0]
	type=modifyexplod
	trigger1=(var(22)=3) && (var(9)&8) && (var(8)&2) && var(25)>0
	id=492200
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(14):=var(33)+floor((var(25)*80/2000-80)*fvar(0))*ifelse(teamside=1,1,-1),var(34)
	scale=var(25)*0.25/2000.00, 0.25
;---
[state 0]
	type=modifyexplod
	trigger1=(var(9)&8) && (var(8)&2)
	id=492201
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(14),var(34)
;---
;sys::powerbar_d_frame ; 外枠
[state 0]
	type=explod
	trigger1=numexplod(492200)>1 && !numexplod(492100)
	id=492100
	anim=f100000+var(22)
	sprpriority=4
	ownpal=1
	space=screen
	postype=left
	pos=var(33),var(34)
	facing=ifelse(teamside=1,-1,1)
	scale=0.25,0.25
	removetime=-1
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::powerbar_d_frame_light ; 外枠光沢
[state 0]
	type=explod
	trigger1=numexplod(492200) && !numexplod(492101)
	id=492101
	anim=f100060+var(22)
	sprpriority=5
	ownpal=1
	space=screen
	postype=left
	pos=var(33),var(34)
	facing=ifelse(teamside=1,-1,1)
	scale=0.25,0.25
	removetime=-1
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=modifyexplod
	trigger1=numexplod(492101)
	id=492101
	postype=left
	facing=ifelse(teamside=1,-1,1)
	pos=var(33) +floor((gametime%(var(14):=256))*80.00/var(14)*fvar(0))*ifelse(teamside=1,1,-1),var(34)
	trans=addalpha
	alpha= (gametime%var(14)=[128,var(14)-128])*256 +(gametime%var(14)<128)*(gametime%var(14))*2 +(gametime%var(14)>var(14)-128)*(var(14)-(gametime%var(14)))*2, 256
;---
;sys::powerbar_d_nums ; 数字
[state 0]
	type=explod
	trigger1=(var(9)&8) && power>=1000 && !numexplod(492300) && numexplod(492100)
	id=492300
	anim=f100500 +ifelse(power>=ifelse((var(22)=[2,3]),2000,10000), 10, power/1000) +((var(22)-1)%3)*1000
	sprpriority=6
	ownpal=1
	space=screen
	postype=left
	pos=var(33)+floor(60*fvar(0))*ifelse(teamside=1,-1,1), var(34)
	scale=0.25,0.25
	removetime=-1
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;------------------------
;------------------------
;sys::power_changed ;; (2nd bit) ; 描画変動
[state 0] ; off
	type=varset
	trigger1=var(8)&2
	trigger1=var(21)=var(20)
	var(8)=var(8)|2
[state 0] ; on
	type=varset
	trigger1=!(var(8)&2)
	trigger1=var(21)!=var(20)
	var(8)=var(8)^2
;sys::memo_power ; パワー存用
[state 0]
	type=varset
	trigger1=var(20)!=power && (roundstate=2)
	var(20)=power
;sys::modify_power_for_view ; パワー変化
;;[state 0]
;;	type=varadd
;;	trigger1=var(21)!=power && (roundstate=2)
;;	var(21)=(power-var(21))/8+ifelse(var(21)>power,-1,1)
[state 0]
	type=varadd
	trigger1=var(21)!=var(20) && (roundstate=2)
	var(21)=(var(20)-var(21))/8+ifelse(var(21)>var(20),-1,1)

;==========================
;==========================
;sys::jump_counter ;; v44 ; ジャンプ計
[state 0]
	type=varset
	trigger1=(root,command="holddown") && var(44)<2 && playerid(var(15)),statetype!=a
	var(44)=16
[state 0]
	type=varadd
	trigger1=var(44)>0
	var(44)=-1

;sys::blocking/jd_system ; ブロキング/ジャストD (projid=195502/195503)
[state 0]
	type=projectile
	triggerall=(var(22)=[2,3]) && roundstate=2 && (root,numprojid(195502)<3) && (root,numprojid(195503)<3)
	trigger1=(root,command="holdfwd"&&!(var(8)&16384)&&var(22)=2)||(root,command="holdback"&&!(var(8)&32768)&&var(22)=3)
	trigger2=var(51)*120>random ;; ai
;debug;	trigger3=1 ;; for_debug
	projid=195500+var(22)
	projanim=anim
	projscale=0,0
	sparkno=-1
	projhitanim=-1
	projremovetime=6 ;; length
	attr=a,nt
	guard.dist=0
	projedgebound=8000
	projstagebound=8000
	projheightbound=-8000,8000
	postype=left
	offset=ifelse(teamside=1,1,-1)*2000
	ignorehitpause=1

;==========================
;==========================
; First Attack (6th-7th bit) ; 専制攻撃
; for special chars and stages ; 特殊キャラ、ステージ用
;sys::fa_switch
[state 0] ; diasable
	type=varset
	triggerall=!(var(9)&32) && roundstate=2 && win=0 && lose=0
	trigger1=(var(9)&64) ;;<- on
	trigger2=playerid(var(15)),gethitvar(isbound)
	trigger3=playerid(var(15)),movetype=h && playerid(var(15)),gethitvar(guarded)=0 && (playerid(var(15)),stateno!=[190190,190196]) && playerid(var(15)),stateno!=195500
;op;	trigger4=(var(9)&4096) ;;<-bonus stage
	var(9)=var(9)|32
[state 0] ; on
	type=varset
;__;	triggerall=!(var(9)&32) && !(var(9)&64)
	triggerall=!(var(9)&96)
	triggerall=roundstate=2 && win=0 && lose=0 && playeridexist(var(16))
	trigger1=playerid(var(16)),gethitvar(isbound)
	trigger2=playerid(var(16)),movetype=h && playerid(var(16)),gethitvar(guarded)=0 && (playerid(var(16)),stateno!=[190190,190196]) && playerid(var(16)),stateno!=195500
	var(9)=var(9)|64
;---
;;>>@Config.Icon_FirstAttack_Pos>>
;;先制攻撃アイコン
;sys::fa_d_icon
[state 0] ; fa_icon / first attack icon
	type=explod
	triggerall=(var(7)&16) ;; system_switch
;__;	trigger1=(var(9)&4) && (var(9)&64) && !numexplod(400010)
	trigger1=(var(9)&68)=68 && !numexplod(400010)
	id=400010
	anim=f400010
	sprpriority=var(46)
	ownpal=1
	space=screen
	postype=left
	pos=var(31) +floor(98*fvar(0)) *ifelse(teamside=1,-1,1) ,  floor(4*fvar(0))
	scale=0.5,0.5
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::fa_d_cls
[state 0] ; ma_icon_remove
	type=removeexplod
	trigger1=!(var(9)&4) && numexplod(400010)
	id=400010
;---
;sys::sound_announcer_first_attack
[state 0]
	type=playsnd
	triggerall=(var(7)&64) ;; system_switch
;__;	trigger1=!(var(9)&32) && (var(9)&64) && (roundstate=2)
	trigger1=(var(9)&96)=64 && (roundstate=2)
	value=f10100,1
	channel=0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;sys::fa_bonus
[state 0]
	type=varadd
;__;	trigger1=!(var(9)&32) && (var(9)&64) && (roundstate=2)
	trigger1=(var(9)&96)=64 && (roundstate=2)
	var(57)=2000 ;; plus 2k pts

;==========================
;;>>@Config.Counter_Hit>>
;==========================
;sys::counter_hit ;; (14-15th bit) ; カウンター
[state 0] ; init
	type=varset
	trigger1=(var(9)&49152)
;op;	trigger1=numenemy
	trigger1=(playerid(var(15)),movetype!=a)||(playerid(var(15)),stateno=195500) ;;<-bk/jd
	trigger1=playeridexist(var(16))
	trigger1=(playerid(var(16)),movetype!=a)||(playerid(var(16)),stateno=195500) ;;<-bk/jd
	var(9)=(var(9)|49152)^49152
[state 0] ; off - hold
	type=varset
	trigger1=(var(9)&49152)=49152
	var(9)=var(9)^32768
[state 0] ; set
	type=varset
	trigger1=!(var(9)&49152) && (roundstate=2)
;op;	trigger1=numenemy
	trigger1=(playerid(var(15)),movetype!=a)
	trigger1=playeridexist(var(16))
	trigger1=(playerid(var(16)),movetype=a) && (playerid(var(16)),stateno!=195500)
	var(9)=var(9)|32768
[state 0] ; on
	type=varset
	trigger1=(var(9)&49152)=32768 && (roundstate=2)
;op;	trigger1=numenemy
	trigger1=(playerid(var(15)),movetype!=h)
	trigger1=playeridexist(var(16))
	trigger1=(playerid(var(16)),movetype=h) && (playerid(var(16)),stateno!=[120,159]) ;;<-not guard state
	trigger1=(playerid(var(16)),stateno!=[190190,190199]) ;;<-not assist
	trigger1=(playerid(var(16)),stateno!=195500) && (playerid(var(16)),alive)
	var(9)=var(9)|16384
;sys::sound_announcer_counter_hit
[state 0]
	type=playsnd
	triggerall=(var(7)&64) ;; system_switch
	trigger1=(var(9)&49152)=49152 && (roundstate=2)
	value=f10200,0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;op;	channel=0
;sys::counter_hit_bonus
[state 0]
	type=varadd
	trigger1=(var(9)&49152)=49152 && (roundstate=2)
	var(57)=500
;sys::screen_edge_dark_counter_hit
[state 0]
	type=explod
	trigger1=(var(9)&49152)=49152 && (roundstate=2)
	anim=f3020
	sprpriority=var(46)-20
	ownpal=1
	space=screen
	postype=left
	pos=-floor(35*fvar(0)),var(4)/2
	scale=0.5,var(4)/240.0/fvar(0)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=(var(9)&49152)=49152 && (roundstate=2)
	anim=f3020
	sprpriority=var(46)-20
	ownpal=1
	space=screen
	postype=left
	pos=var(3)+floor(35*fvar(0)),var(4)/2
	scale=-0.5,var(4)/240.0/fvar(0)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1


;@@Debug@@;
;==========================
;==========================
; stop envshake, use screen zoom instead ;; fv09
; 画面振動のかわりに、焦点使用
[state 0]
	type=varset
	triggerall=fvar(19)<=30 ;;<- counter start
	triggerall=(playerid(var(15)),gethitvar(fall.envshake.ampl)=0) ;;<- not-fall
	;--- get_hit
	trigger1=playerid(var(15)),stateno=5000 || playerid(var(15)),stateno=5010 || playerid(var(15)),stateno=5020 || playerid(var(15)),stateno=5070
	trigger1=playerid(var(15)),time=1 && var(26)!=playerid(var(15)),time && numenemy
	trigger1=(playerid(var(15)),gethitvar(chainid)=[1000,3999]) || ((playerid(var(16)),movehit=1) && !(playerid(var(16)),hitdefattr=sca,na,np))
	;--- counter_attack
	trigger2=(var(9)&49152)=49152 ;;<- counter attack
	;--- hit_on_ground
	trigger3=playerid(var(15)),stateno=5100 && playerid(var(15)),time=1 && var(26)!=playerid(var(15)),time
	;---
	fvar(9)=180 +( (playerid(var(15)),gethitvar(chainid)>=3000) || (enemynear,hitdefattr=sca,ha,hp) )
[state 0]
	type=zoom ;;@@ZOOM@@;;
	trigger1=fvar(9)>=30 && numenemy
	;;---v1.1 minimum zoom.scale value: 1.0
	;;---v1.1のズーム最小値は 1.0
;;	scale= 1 + cos(((fvar(9):=fvar(9)-30)-90)*0.0174)  *ifelse(floor(fvar(9))%30>0, 0.03, 0.02)
	;---v.IKEMEN
	scale= camerazoom + cos(((fvar(9):=fvar(9)-30)-90)*0.0174)  *ifelse(floor(fvar(9))%30>0, 0.03, 0.02)
	;---
	pos=0,0
	;;---
;;	lag=0   ;;?;
;@@Debug@@;


;==========================
; indicate scores v57-58
; 点数表示
;==========================
; score up ; スコア増
;sys::bonus_up-na
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(16))
	trigger1=(playerid(var(16)),movetype=h && playerid(var(16)),gethitvar(hitshaketime)>0 && playerid(var(16)),gethitvar(guarded)=0)|| playerid(var(16)),gethitvar(isbound)
	var(57)=1
;sys::bonus_up-sa
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15))
	trigger1=playerid(var(15)),movehit && (playerid(var(15)),hitdefattr=sca,sa,st,sp)
	var(57)=9
;sys::bonus_up-ha
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15))
	trigger1=playerid(var(15)),movehit && (playerid(var(15)),hitdefattr=sca,ha,hp,ht)
	var(57)=19
;sys::bonus_up-proj
[state 0]
	type=varadd
	triggerall=roundstate=2
	trigger1=playeridexist(var(15))
	trigger1=playerid(var(15)),projhittime(0)>0 && playerid(var(15)),projhittime(0)<6
	trigger2=numpartner
	trigger2=partner,projhittime(0)>0 && partner,projhittime(0)<6
	var(57)=15
;sys::rank_get_tech2
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15))
	trigger1=(playerid(var(15)),stateno=195500)
	var(57)=5

;------------------------
;;>>@Config.Score>>
; draw scores
; * remove this part to improve speed if you have a slow pc
; 点数描画
; * 「処理落ち」がひどい時は、この部分を削除すれば改善できます。
;------------------------
;sys::score_d_cls
[state 0]
	type=removeexplod
	triggerall=numexplod(98000)
	trigger1=(var(57)%10)!=(var(58)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98000
[state 0]
	type=removeexplod
	triggerall=numexplod(98001)
	trigger1=((var(57)/10)%10)!=((var(58)/10)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98001
[state 0]
	type=removeexplod
	triggerall=numexplod(98002)
	trigger1=((var(57)/100)%10)!=((var(58)/100)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98002
[state 0]
	type=removeexplod
	triggerall=numexplod(98003)
	trigger1=((var(57)/1000)%10)!=((var(58)/1000)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98003
[state 0]
	type=removeexplod
	triggerall=numexplod(98004)
	trigger1=((var(57)/10000)%10)!=((var(58)/10000)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98004
[state 0]
	type=removeexplod
	triggerall=numexplod(98005)
	trigger1=((var(57)/100000)%10)!=((var(58)/100000)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98005
[state 0]
	type=removeexplod
	triggerall=numexplod(98006)
	trigger1=((var(57)/1000000)%10)!=((var(58)/1000000)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98006
[state 0]
	type=removeexplod
	triggerall=numexplod(98007)
	trigger1=((var(57)/10000000)%10)!=((var(58)/10000000)%10)
	trigger2=var(51)>0 || !(var(9)&4) || floor(log(10,var(57)))!=floor(log(10,(var(58))))
	id=98007
;---
;sys::memo_score ;; 点数保存
[state 0]
	type=varset
	trigger1=var(58)!=var(57)
	var(58)=var(57)
;---
;sys::score_d ;; draw scores (00000000)
[state 0] ;1/8
	type=explod
	id=98000
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98000) && var(58)>0
	anim=f300010+(var(58)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-67,62)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;2/8
	type=explod
	id=98001
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98001) && var(58)>9
	anim=f300010+((var(58)/10)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-73,56)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;3/8
	type=explod
	id=98002
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98002) && var(58)>99
	anim=f300010+((var(58)/100)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-79,50)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;4/8
	type=explod
	id=98003
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98003) && var(58)>999
	anim=f300010+((var(58)/1000)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-85,44)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;5/8
	type=explod
	id=98004
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98004) && var(58)>9999
	anim=f300010+((var(58)/10000)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-91,38)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;6/8
	type=explod
	id=98005
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98005) && var(58)>99999
	anim=f300010+((var(58)/100000)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-97,32)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;7/8
	type=explod
	id=98006
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98006) && var(58)>999999
	anim=f300010+((var(58)/1000000)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-103,26)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0] ;8/8
	type=explod
	id=98007
	trigger1=(var(9)&4) && (var(7)&16) ;; system_switch
	trigger1=var(51)<1 && !numexplod(98007) && var(58)>9999999
	anim=f300010+((var(58)/10000000)%10)
	space=screen
	postype=left
	pos=var(31)+floor(ifelse(teamside=1,floor(log(10,var(58)))*6-109,20)*fvar(0)), floor(4*fvar(0))
	sprpriority=var(46)
	ownpal=1
	scale=0.5,0.325
	bindtime=-1
	removetime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;==========================
;==========================
;;>>@Config.Icon_CPU_Pos>>
;sys::cpu_icon ; CPU-標記
[state 0]
	type=explod
	triggerall=(var(7)&16) ;; system_switch
	trigger1=(var(9)&4) && (var(51)>0) && !numexplod(297000)
	id=297000
	anim=f297000+ifelse(var(51)>8,8,var(51))
	space=screen
	postype=left
	pos=var(31) +floor(46*fvar(0)) *ifelse(teamside=1,-1,1) ,  floor(6*fvar(0))
	sprpriority=var(46)
	ownpal=1
	removetime=-1
	bindtime=-1
	scale=0.75,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=removeexplod
	trigger1=numexplod(297000) && (var(51)<1 || !(var(9)&4))
	id=297000

;==========================
;==========================
; stun/dizzy process v50,52
; 気絶処理
;sys::dizzy_recover
[state 0]
	type=varadd
	trigger1=var(50)>0 && (gametime%2=0)
	trigger1=playerid(var(15)),movetype=i || playerid(var(15)),movetype=a || playerid(var(15)),ctrl
	var(50)=-1
;sys::dizzy_reset
[state 0]
	type=varset
	trigger1=playerid(var(15)),stateno=190116
	var(50)=0
;sys::dizzy_accumulate
[state 0]
	type=varadd
	triggerall=(var(7)&1) ;; system_switch
	triggerall=(playerid(var(15)),stateno=5000)||(playerid(var(15)),stateno=5010)||(playerid(var(15)),stateno=5020)||(playerid(var(15)),stateno=5070)
	triggerall=(playerid(var(15)),time=3)&&(playerid(var(15)),gethitvar(isbound)=0)&&(playerid(var(15)),gethitvar(hittime)>0)&&(playerid(var(15)),hitover=0)&&(playerid(var(15)),gethitvar(hitcount)>0)
	triggerall=numenemy
	triggerall=!(enemy,hitdefattr=sca,ha,hp,ht)
	trigger1=(enemy,projhittime(0)>=0)&&(enemy,numtarget(3000)=0)
	trigger2=enemy,projhittime(0)<0
	var(50)=(playerid(var(15)),gethitvar(hitshaketime)*16+1)/playerid(var(15)),gethitvar(hitcount)
	;;; var(50)=1000 ; for_debug
;--- ---
;;[state 0] ; dizzy/stun
;;	type=displaytoclipboard
;;	trigger1=1
;;	text="point=[ %d ] shake_time=[ %d ] hit_time=[ %d ] hit_count=[ %d ]"
;;	params=var(50),(playerid(var(15)),gethitvar(hitshaketime)),(playerid(var(15)),gethitvar(hittime)),(playerid(var(15)),gethitvar(hitcount))
;--- ---
;sys::dizzy_time
[state 0]
	type=varset
	trigger1=(playerid(var(15)),stateno=190116) && (playerid(var(15)),time<2)
	var(52)=0
[state 0]
	type=varadd
	trigger1=(playerid(var(15)),stateno=190116) && (playerid(var(15)),time>1) && (playerid(var(15)),prevstateno!=190120)
	var(52)=1 ;;{max:300}
;sys::dizzy_self_recover
[state 0]
	type=varadd
	triggerall=(playerid(var(15)),stateno=190116) && (playerid(var(15)),time>1) && (playerid(var(15)),prevstateno!=190120)
	;--- ai
	trigger1=var(51)>0 && random<var(51)*90 && random<500
	;--- player
	trigger2=(root,command="holdfwd"&&!(var(8)&16384))||(root,command="holdback"&&!(var(8)&32768))||(root,command="holdup"&&!(var(8)&65536))||(root,command="holddown"&&!(var(8)&131072))
	trigger3=(root,command="x"&&!(var(8)&262144))||(root,command="y"&&!(var(8)&524288))||(root,command="z"&&!(var(8)&1048576))
	trigger4=(root,command="a"&&!(var(8)&2097152))||(root,command="b"&&!(var(8)&4194304))||(root,command="c"&&!(var(8)&8388608))
	var(52)=9

;==========================
;==========================
; evaluate / rank ; (評価)
;sys::rank_get_hitcombo
[state 0]
	type=varset
	trigger1=numenemy && roundstate=2
	trigger1=(enemy,sysfvar(0)>0) && (playeridexist(floor(enemy,sysfvar(0))))
	trigger1=(playerid(floor(enemy,sysfvar(0))),var(0)=90900) && fvar(3)<(playerid(floor(enemy,sysfvar(0))),var(12)%10000)
	fvar(3)=(playerid(floor(enemy,sysfvar(0))),var(12)%10000) ;;<-real combo
;sys::rank_get_tech3
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15)) && playeridexist(var(16))
	trigger1=(playerid(var(15)),stateno=[20,119]) && (playerid(var(15)),inguarddist) && (var(26)!=playerid(var(15)),time)
	fvar(5)=0.00001
;sys::rank_get_bk/jd2
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15))
	trigger1=(playerid(var(15)),stateno=195500) && (var(26)!=playerid(var(15)),time)
	fvar(6)=0.001
;sys::rank_get_guard/def
[state 0]
	type=varadd
	trigger1=roundstate=2 && playeridexist(var(15))
	trigger1=((playerid(var(15)),stateno=[120,155])||(playerid(var(15)),stateno=195500)) && (var(26)!=playerid(var(15)),time)
	fvar(7)=0.05
;sys::rank_get_attack/off
[state 0]
	type=varadd
	triggerall=roundstate=2 && playeridexist(var(16))
	trigger1=(playerid(var(16)),stateno=5000)||(playerid(var(16)),stateno=5010)||(playerid(var(16)),stateno=5020)||(playerid(var(16)),stateno=5070)
	trigger2=(playerid(var(16)),gethitvar(isbound)) || (playerid(var(16)),stateno=190116) ;;<-dizzy
	fvar(8)=0.05
;;--- ---
;;[state 0] ; rank
;;	type=displaytoclipboard
;;	trigger1=1
;;	text="tech=[%f] att=[%f] def=[%f] bk/jd=[%f] maxhit=[%d]"
;;	params=fvar(5),fvar(8),fvar(7),fvar(6),floor(fvar(3))
;;--- ---

;==========================
;==========================
;;>>@Config.KO>>
; call KO_Helper (new helper) ; KOを呼び出す (新ﾍﾙﾊﾟｰ)
;sys::helper::ko
[state 0]
	type=helper
	triggerall=(var(7)&8192) ;; system_switch
	trigger1=win && !(var(9)&512) && !numhelper(180010) && !(var(9)&4096) ;;<- bonus stage
	id=180010
	stateno=180010
	ownpal=1
	ignorehitpause=1
	supermovetime=88888
	pausemovetime=88888
	persistent=0

;------------------------
;------------------------
;sys::roundover-flag ;; (10th bit) ; 終了判定
[state 0]
	type=varset
	trigger1=win && !(var(9)&512)
	var(9)=var(9)|512
	ignorehitpause=1

;==========================
;==========================
; call Result_Helper (new helper) ; 結果を呼び出す (新ﾍﾙﾊﾟｰ)
;sys::helper::result
[state 0]
	type=helper
	trigger1=roundstate>3 && !numhelper(99980)
	id=99980
	stateno=99980
	ownpal=1
	ignorehitpause=1
	supermovetime=88888
	pausemovetime=88888
	persistent=0
;---
;sys::score_up_to_parent ; 親に加算
[state 0]
	type=parentvarset
	trigger1=numhelper(99980) && parent,sysvar(4) && var(58)>parent,var(58)
	var(58)=var(58)


;==========================
;==========================
;;>>@Config.Ground_Dust_Effect>>
;; Ground_Dust ; 埃
;sys::slide_dust
[state 0]
	type=helper
	triggerall=playeridexist(var(14):=var(15)) && (var(7)&16384) ;; system_switch
	triggerall=(playerid(var(14)),stateno!=[190190,190193])
	trigger1=(playerid(var(14)),stateno=151 || playerid(var(14)),stateno=153 || playerid(var(14)),stateno=5001 || playerid(var(14)),stateno=5011)
	trigger1=playerid(var(14)),time=1 && var(26)!=playerid(var(14)),time && playerid(var(14)),pos y=0 && playerid(var(14)),vel x && playerid(var(14)),numhelper(152050)=0 && !numhelper(152050)
	id=152050
	stateno=152050
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	size.xscale=ifelse((playerid(var(14)),stateno<5000), 0.7, 0.8)
	size.yscale=ifelse((playerid(var(14)),stateno<5000), 0.6, 0.7)
	ownpal=1
;sys::slide_dust_partner
[state 0]
	type=helper
	triggerall=numpartner && var(15)!=var(49) && playeridexist(var(14):=var(49)) && (var(7)&16384) ;; system_switch
	triggerall=(playerid(var(14)),stateno!=[190190,190193])
	trigger1=(playerid(var(14)),stateno=151 || playerid(var(14)),stateno=153 || playerid(var(14)),stateno=5001 || playerid(var(14)),stateno=5011)
	trigger1=playerid(var(14)),time=1 && var(27)!=playerid(var(14)),time && playerid(var(14)),pos y=0 && playerid(var(14)),vel x && playerid(var(14)),numhelper(152050)=0 && !numhelper(152050)
	id=152050
	stateno=152050
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	size.xscale=ifelse((playerid(var(14)),stateno<5000), 0.7, 0.8)
	size.yscale=ifelse((playerid(var(14)),stateno<5000), 0.6, 0.7)
	ownpal=1

;sys::ground_wave
[state 0]
	type=helper
	triggerall=playeridexist(var(14):=var(15)) && (var(7)&16384) ;; system_switch
	trigger1=(playerid(var(14)),stateno=5100 || (playerid(var(14)),stateno=[5110,5111])) && playerid(var(14)),time=1 && var(26)!=playerid(var(14)),time
	trigger1=playerid(var(14)),numhelper(159005)=0 && numhelper(159005)=0 && numhelper(159006)=0
	id=159005
	stateno=159005
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	ownpal=1
	size.height=1+(playerid(var(14)),stateno=5100)
	size.ground.front=floor(playerid(var(14)),const(size.ground.front)/fvar(0))
	size.ground.back= floor(playerid(var(14)),const(size.ground.back)/fvar(0))
;sys::ground_wave_partner
[state 0]
	type=helper
	triggerall=numpartner && var(15)!=var(49) && playeridexist(var(14):=var(49)) && (var(7)&16384) ;; system_switch
	trigger1=(playerid(var(14)),stateno=5100 || (playerid(var(14)),stateno=[5110,5111])) && playerid(var(14)),time=1 && var(27)!=playerid(var(14)),time
	trigger1=playerid(var(14)),numhelper(159005)=0 && numhelper(159005)=0 && numhelper(159006)=0
	id=159006
	stateno=159005
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	ownpal=1
	size.height=1+(playerid(var(14)),stateno=5100)
	size.ground.front=floor(playerid(var(14)),const(size.ground.front)/fvar(0))
	size.ground.back= floor(playerid(var(14)),const(size.ground.back)/fvar(0))

;sys::ground_land_dust
[state 0]
	type=helper
	triggerall=playeridexist(var(14):=var(15)) && (var(7)&16384) ;; system_switch
	triggerall=(var(26)!=playerid(var(14)),time) && !numhelper(152000) && !numhelper(152020)
	triggerall=playerid(var(14)),numhelper(159005)=0 && numhelper(159005)=0 && numhelper(159006)=0
	triggerall=(playerid(var(14)),stateno!=[190190,190193])
	trigger1=(playerid(var(14)),pos y=0) && (playerid(var(14)),vel y=0) && (var(8)&16)
	trigger1=1|| var(8):=(var(8)^16)
	trigger1=(playerid(var(14)),stateno!=5030) && (playerid(var(14)),stateno!=5050) && (playerid(var(14)),stateno!=5071) && (playerid(var(14)),stateno!=5100) && (playerid(var(14)),stateno!=[5110,5111])
	trigger2=(playerid(var(14)),pos y<0) && !(var(8)&16)
	trigger2=1|| var(8):=(var(8)|16)
	trigger2=(playerid(var(14)),vel y<0) && (playerid(var(14)),stateno!=5030) && (playerid(var(14)),stateno!=5050) && (playerid(var(14)),stateno!=5071) && (playerid(var(14)),stateno!=5100) && (playerid(var(14)),stateno!=[5110,5111])
	id=152000      +ifelse((playerid(var(14)),pos y<0), 20, 0)
	stateno=152000 +ifelse((playerid(var(14)),pos y<0), 20, 0)
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	ownpal=1
	size.ground.front=floor(playerid(var(14)),const(size.ground.front)/fvar(0))
	size.ground.back= floor(playerid(var(14)),const(size.ground.back)/fvar(0))
;sys::ground_land_dust_partner
[state 0]
	type=helper
	triggerall=numpartner && var(15)!=var(49) && playeridexist(var(14):=var(49)) && (var(7)&16384) ;; system_switch
	triggerall=(var(27)!=playerid(var(14)),time) && !numhelper(152000) && !numhelper(152020)
	triggerall=playerid(var(14)),numhelper(159005)=0 && numhelper(159005)=0 && numhelper(159006)=0
	triggerall=(playerid(var(14)),stateno!=[190190,190193])
	trigger1=(playerid(var(14)),pos y=0) && (playerid(var(14)),vel y=0) && (var(8)&32)
	trigger1=1|| var(8):=(var(8)^32)
	trigger1=(playerid(var(14)),stateno!=5030) && (playerid(var(14)),stateno!=5050) && (playerid(var(14)),stateno!=5071) && (playerid(var(14)),stateno!=5100) && (playerid(var(14)),stateno!=[5110,5111])
	trigger2=(playerid(var(14)),pos y<0) && !(var(8)&32)
	trigger2=1|| var(8):=(var(8)|32)
	trigger2=(playerid(var(14)),vel y<0) && (playerid(var(14)),stateno!=5030) && (playerid(var(14)),stateno!=5050) && (playerid(var(14)),stateno!=5071) && (playerid(var(14)),stateno!=5100) && (playerid(var(14)),stateno!=[5110,5111])
	id=152000      +ifelse((playerid(var(14)),pos y<0), 20, 0)
	stateno=152000 +ifelse((playerid(var(14)),pos y<0), 20, 0)
	facing=playerid(var(14)),facing*facing
	pos=floor(playerid(var(14)),pos x-pos x)*facing,floor(-pos y)
	ownpal=1
	size.ground.front=floor(playerid(var(14)),const(size.ground.front)/fvar(0))
	size.ground.back= floor(playerid(var(14)),const(size.ground.back)/fvar(0))
;---
;sys::water_move ; (水_移動)
[state 0]
	type=explod
	trigger1=var(24)=1
	trigger1=(playerid(var(15)),pos y=0) && (playerid(var(15)),vel x) && (time%16=0) && var(26)!=playerid(var(15)),time && !numexplod(119900)
	id=119900
	anim=f10330
	postype=p1
	sprpriority=7
	ownpal=1
	facing=playerid(var(15)),facing*facing*ifelse((playerid(var(15)),vel x>0), 1, -1)
	pos=floor((playerid(var(15)),pos x-pos x)*facing*10)/10,floor(-pos y*10)/10 ;;{ (#.#*10)/10 -> Ceil(#.#) }
	scale=(playerid(var(15)),const(size.ground.front)+playerid(var(15)),const(size.ground.back))*0.031/fvar(0), (playerid(var(15)),const(size.ground.front)+playerid(var(15)),const(size.ground.back))*0.02/fvar(0)
;;sys::water_move_sound
;[state 0]
;	type=playsnd
;	trigger1=var(24)=1
;	trigger1=(playerid(var(15)),pos y=0) && (playerid(var(15)),vel x) && (time%32=0) && var(26)!=playerid(var(15)),time
;	pan=floor(playerid(var(15)),pos x-pos x)*facing
;	value=f127,(random%2)+1
;	channel=2
;sys::water_move_partner
[state 0]
	type=explod
	trigger1=var(24)=1 && numpartner && !numexplod(119901)
	trigger1=(playerid(var(49)),pos y=0) && (playerid(var(49)),vel x) && (time%16=8) && var(27)!=playerid(var(49)),time
	id=119901
	anim=f10330
	postype=p1
	sprpriority=7
	ownpal=1
	facing=-playerid(var(49)),facing*facing*ifelse((playerid(var(49)),vel x>0), 1, -1)
	pos=floor((playerid(var(49)),pos x-pos x)*facing*10)/10,floor(-pos y*10)/10 ;;{ (#.#*10)/10 -> Ceil(#.#) }
	scale=(playerid(var(49)),const(size.ground.front)+playerid(var(49)),const(size.ground.back))*0.031/fvar(0), (playerid(var(49)),const(size.ground.front)+playerid(var(49)),const(size.ground.back))*0.02/fvar(0)
;sys::water_ground ; (水_足元)
[state 0]
	type=explod
	trigger1=var(24)=1 && !numexplod(119902)
	id=119902
	anim=f10335
	postype=p1
	sprpriority=7
	ownpal=1
	removetime=-1
;sys::water_ground_partner
[state 0]
	type=explod
	trigger1=var(24)=1 && numpartner && !numexplod(119903)
	id=119903
	anim=f10335
	postype=p1
	sprpriority=7
	ownpal=1
	removetime=-1
;sys::water_effect
[state 0]
	type=modifyexplod
	trigger1=numexplod(119902)
	id=119902
	postype=p1
	facing=playerid(var(15)),facing*facing
	pos=floor((playerid(var(15)),pos x-pos x)*facing*10)/10,floor(-pos y*10)/10 ;;{ (#.#*10)/10 -> Ceil(#.#) }
	scale=(playerid(var(15)),const(size.ground.front)+playerid(var(15)),const(size.ground.back))*0.031/fvar(0)*ifelse(playerid(var(15)),statetype=l,2,1), 0.75*(playerid(var(15)),pos y=0)
;sys::water_effect_partner
[state 0]
	type=modifyexplod
	trigger1=numexplod(119903) && numpartner
	id=119903
	postype=p1
	facing=playerid(var(49)),facing*facing
	pos=floor((playerid(var(49)),pos x-pos x)*facing*10)/10,floor(-pos y*10)/10 ;;{ (#.#*10)/10 -> Ceil(#.#) }
	scale=(playerid(var(49)),const(size.ground.front)+playerid(var(49)),const(size.ground.back))*0.031/fvar(0)*ifelse(playerid(var(49)),statetype=l,2,1), 0.75*(playerid(var(49)),pos y=0)


;==========================
; [ai] ReActions ID Ref. / 行動対処参照番号
;==========================
; v14: temp: enemynear,id
; v15: current player ID //プレーヤー識別番号
; v16: current enemy ID //相手識別番号
; v18: action/state no. // 行動/状態番号
; v19: enemy state //相手状態
;---
;sys::ai_get_enemy-id
[state 0]
	type=varset
	trigger1=1
	var(14)=var(16) ;; def_enemy_id
[state 0]
	type=varset
	trigger1=numenemy
	trigger1=enemy(time%numenemy),alive && enemy(time%numenemy),ishelper=0 && (enemy(time%numenemy),stateno!=[190190,190196])
	var(14)=enemy(time%numenemy),id

;sys::ai_act_id
[state 0] ; init
	type=varset
	trigger1=1
	var(19)=0 ;; init

;sys::ai_projid(910#0)_counter
;[state 0]
;	type=varadd
;	trigger1=numenemy
;	var(19)=(1+ (enemy(time%numenemy),numprojid(91010)>0)*10+(enemy(time%numenemy),numprojid(91020)>0)*100+(enemy(time%numenemy),numprojid(91030)>0)*1000+(enemy(time%numenemy),numprojid(91040)>0)*10000+(enemy(time%numenemy),numprojid(91050)>0)*100000 )
[state 0]
	type=varadd
	trigger1=numenemy
	var(19)=(1+ (enemy(0),numprojid(91010)>0)*10+(enemy(0),numprojid(91020)>0)*100+(enemy(0),numprojid(91030)>0)*1000+(enemy(0),numprojid(91040)>0)*10000+(enemy(0),numprojid(91050)>0)*100000 )
[state 0]
	type=varadd
	trigger1=numenemy>1
	var(19)=(1+ (enemy(1),numprojid(91010)>0)*10+(enemy(1),numprojid(91020)>0)*100+(enemy(1),numprojid(91030)>0)*1000+(enemy(1),numprojid(91040)>0)*10000+(enemy(1),numprojid(91050)>0)*100000 )
[state 0]
	type=varadd
	trigger1=numenemy>2
	var(19)=(1+ (enemy(2),numprojid(91010)>0)*10+(enemy(2),numprojid(91020)>0)*100+(enemy(2),numprojid(91030)>0)*1000+(enemy(2),numprojid(91040)>0)*10000+(enemy(2),numprojid(91050)>0)*100000 )
[state 0]
	type=varadd
	trigger1=numenemy>3
	var(19)=(1+ (enemy(3),numprojid(91010)>0)*10+(enemy(3),numprojid(91020)>0)*100+(enemy(3),numprojid(91030)>0)*1000+(enemy(3),numprojid(91040)>0)*10000+(enemy(3),numprojid(91050)>0)*100000 )

;---
;sys::ai_act_id2
[state 0] ; init
	type=varset
	trigger1=1
	var(18)=0 ;; init
;---
;sys::ai_act_san ; 立_近_攻 ; standing near attack
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype!=a && playerid(var(15)),ctrl && playerid(var(14)),statetype!=l
	;---
	trigger1=playerid(var(14)),statetype!=a && playerid(var(14)),movetype!=a && (playerid(var(15)),pos x-playerid(var(14)),pos x=[-55,55]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,55])
	trigger1=!var(19)%10 || (!(var(19)/10)%10 && !(var(19)/100)%10)
	;---
	var(18)=1 ;;######1
;---
;sys::ai_act_sar ; 地_遠_牽制 ; standing retrain
[state 0]
	type=varset
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype!=a && playerid(var(15)),ctrl && (gametime%50>25) && random<200
	;---
	trigger1=playerid(var(14)),stateno!=190116 && (!var(19)%10 || (!(var(19)/10)%10 && !(var(19)/100)%10))
	trigger1=playerid(var(14)),statetype!=l && playerid(var(14)),movetype!=a && (abs(playerid(var(15)),pos x-playerid(var(14)),pos x)=[90,230]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,85])
	;---
	var(18)=2 ;;######2
;---
;sys::ai_act_ca ; 屈_近_攻 ; crouching attack
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype!=a && playerid(var(15)),ctrl && playerid(var(14)),statetype!=l
	;---
	trigger1=playerid(var(14)),statetype!=a && playerid(var(14)),movetype!=a && (playerid(var(15)),pos x-playerid(var(14)),pos x=[-55,55]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,55])
	trigger1=!var(19)%10 || (!(var(19)/10)%10 && !(var(19)/100)%10)
	;---
	var(18)=10 ;;#####1#
;---
;sys::ai_act_aa ; 空_攻 ; jumping attack
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype=a && playerid(var(15)),ctrl && playerid(var(14)),statetype!=l
	;---
	trigger1=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-75,75]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[-65,10]) && playerid(var(15)),vel y>0
	trigger2=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-75,75]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[-35,55]) && playerid(var(15)),vel y<0
	trigger2=(playerid(var(14)),pos y<0) && (playerid(var(14)),vel y<0)
	trigger3=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-28,28]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[-28,28])
	;---
	var(18)=100 ;;####1##
;---
;sys::ai_act_upper-cut ; 対空
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype!=a && playerid(var(15)),ctrl && playerid(var(14)),statetype=a
	;---
	trigger1=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-50,50]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,70])
	trigger1=(!var(19)%10 || (!(var(19)/10)%10 && !(var(19)/100)%10))
	;---
	var(18)=1000 ;;###1###
;---
;sys::ai_act_guard ; 防御
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14)) && random<(roundno+matchno+var(51))*100
	triggerall=playerid(var(15)),inguarddist
	;--- against proj ; 飛び道具対処 ;{ 91#10 guard ;91#20 guard/roll/jump ; 91#30 roll/jump ; 91#40 jump ; 91#50 jump fwd }
	trigger1=(var(19)/10)%10 || ((var(19)/100)%10 && random<100)
	;--- ground_guard
	trigger2=((playerid(var(15)),pos x-playerid(var(14)),pos x=[-85,85])||random<250) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,120])
	trigger2=(playerid(var(15)),statetype!=a) && playerid(var(14)),movetype=a && !(playerid(var(14)),hitdefattr=sca,nt,st,ht)
;;op;	trigger2=(playerid(var(14)),hitdefattr=sca,na,np && random<500) || (playerid(var(14)),hitdefattr=sca,sa,sp && random<750) || (playerid(var(14)),hitdefattr=sca,ha,hp)
	;--- air_guard
	trigger3=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-70,70]) && ((playerid(var(15)),pos y-playerid(var(14)),pos y=[-56,56]) || random<250)
	trigger3=(var(22)!=[2,3]) && (playerid(var(15)),statetype=a) && playerid(var(14)),movetype=a && !(playerid(var(14)),hitdefattr=sca,nt,st,ht)
	trigger3=(playerid(var(14)),hitdefattr=sca,sa,sp && random<500)
	;---
	var(18)=10000 ;;##1####
;sys::ai_act_guard_from_getup ; 起き上がり防御
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14)) && random<(roundno+matchno+var(51))*250
	triggerall=(playerid(var(15)),stateno=0 && playerid(var(15)),ctrl && playerid(var(15)),time<8 && playerid(var(15)),inguarddist && playerid(var(15)),prevstateno=5120) || playerid(var(15)),stateno=5120
	trigger1=playerid(var(14)),movetype=a && !(playerid(var(14)),hitdefattr=sca,nt,st,ht) && (playerid(var(15)),pos x-playerid(var(14)),pos x=[-60,60]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,90])
	;---
	var(18)=10000 ;;##1####
;---
;sys::ai_act_roll ; 回避
[state 0]
	type=varadd
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14)) && random<(roundno+matchno+var(51))*50
	triggerall=(var(22)!=[2,3]) && playerid(var(15)),statetype!=a && playerid(var(15)),ctrl
	;---
	trigger1=playerid(var(14)),movetype=a && !(playerid(var(14)),hitdefattr=sca,nt,st,ht) && (playerid(var(15)),pos x-playerid(var(14)),pos x=[-70,70]) && (playerid(var(15)),pos y-playerid(var(14)),pos y=[0,70])
	;--- against proj ; 飛び道具対処 ;91#20 guard/roll/jump ; 91#30 roll/jump
	trigger2=((var(19)/100)%10 && random<580) || ((var(19)/1000)%10 && random<230)
	;---
	var(18)=100000 ;;#[1-3]#####
;---
;sys::ai_act_jump ; 跳躍
[state 0]
	type=null
	triggerall=var(51)>1 && (var(7)&262144) && roundstate=2 && playeridexist(var(15)) && playeridexist(var(14))
	triggerall=playerid(var(15)),statetype!=a && playerid(var(15)),ctrl

	;;--- jump { 142000 + / n:00 l:+10 s:+20 m+30 / N:+0 F:+1 B:+2 }
	trigger1=(playerid(var(15)),pos x-playerid(var(14)),pos x=[-100,100]) && playerid(var(14)),movetype!=a && !(var(19)/100)%10 && random<10
	trigger1=1|| var(18):= (var(18)%100000)+100000 *(ifelse(random<650,10,(random<650)*20) +4+(random<300))  ;;[0-2][4-7]#####

	;;--- jump long_fwd [142011]
	trigger2=(playerid(var(15)),pos x-playerid(var(14)),pos x!=[-220,220]) && playerid(var(14)),movetype!=a && !(var(19)/100)%10 && random<20
	trigger2=1|| var(18):= (var(18)%100000)+100000 *(ifelse(random<750,10,(random<100)*20) +5) ;;[0-2][4-7]#####

	;;--- small [142020] / mid [142030] / leap [48]
	trigger3=(var(22)=2) && (playerid(var(15)),pos x-playerid(var(14)),pos x=[-80,80]) && (playerid(var(14)),statetype=c || random<250) && random<40
	trigger3=1|| var(18):= (var(18)%100000)+100000 *(ifelse(random<650,10,(random<500)*20) +6+(p2bodydist x>50))

	;;--- against proj ; 飛び道具対処 ;{ 91#10 guard ; 91#20 guard/roll/jump ; 91#30 roll/jump ; 91#40 jump ; 91#50 jump fwd }
	trigger4=((var(19)/100)%10 && random<160) || ((var(19)/1000)%10 && random<520) || ((var(19)/10000)%10 && random<680) || ((var(19)/100000)%10 && random<880) || playerid(var(14)),hitdefattr=sca,nt,st,ht
	trigger4=random<(roundno+matchno+var(51))*50
	trigger4=1|| var(18):= (var(18)%100000)+100000 *( (playerid(var(15)),pos x-playerid(var(14)),pos x!=[-52,52])*10 +4+((var(19)/100)%10 || (var(19)/1000)%10) )

	;;--- after guard cancel ;{  }
	trigger5=playerid(var(15)),time<3 && playerid(var(15)),prevstateno=8200 && playerid(var(15)),numtarget && random<500
	trigger5=1|| var(18):= (var(18)%100000)+100000 *(14+(random<500))  ;;[1][4-5]#####


;==========================
;==========================
;;>>@Config.Display_Input>>
;; display input v47 ; (操作入力表示)
;; (* the result seems NOT always corect. especially when the player has been placed in a custom state)
;; (* 結果がいつも正しいとは限りません、特にステートが奪われたとき)

;sys::ki_arrow_key_hold
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="holdfwd")||(root,command="holdback")||(root,command="holdup")||(root,command="holddown")
	id=230101
	anim=f230150 +((root,command="holdfwd")-(root,command="holdback"))*20*(root,facing) +((root,command="holddown")-(root,command="holdup"))*5
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.45,0.45
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	vel x=10*fvar(0)*ifelse(teamside=1,1,-1)
	removetime=2
	trans=addalpha
	alpha=128,128
;sys::ki_arrow_key_pressed
[state 0]
	type=explod
	triggerall=(var(8)&33554432)
;;old;	trigger1=(root,command="holdfwd"&&!(var(8)&16384))||(root,command="holdback"&&!(var(8)&32768))||(root,command="holdup"&&!(var(8)&65536))||(root,command="holddown"&&!(var(8)&131072))
	trigger1=root,command="holdfwd"  && !(var(8)&16384)
	trigger2=root,command="holdback" && !(var(8)&32768)
	trigger3=root,command="holdup"   && !(var(8)&65536)
	trigger4=root,command="holddown" && !(var(8)&131072)
	id=230100
	anim=f230150 +((root,command="holdfwd")-(root,command="holdback"&&root,command!="holdfwd"))*20*(root,facing) +((root,command="holddown"&&root,command!="holdup")-(root,command="holdup"))*5
;op;	sprpriority=(var(47)%100)
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;--- button
;sys::ki_key_a
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="a") && !(var(8)&2097152)
	id=230100
	anim=f230200
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;sys::ki_key_b
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="b") && !(var(8)&4194304)
	id=230100
	anim=f230201
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;sys::ki_key_c
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="c") && !(var(8)&8388608)
	id=230100
	anim=f230202
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;sys::ki_key_x
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="x") && !(var(8)&262144)
	id=230100
	anim=f230203
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;sys::ki_key_y
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="y") && !(var(8)&524288)
	id=230100
	anim=f230204
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;sys::ki_key_z
[state 0]
	type=explod
	trigger1=(var(8)&33554432)
	trigger1=(root,command="z") && !(var(8)&1048576)
	id=230100
	anim=f230205
	ontop=1
	postype=left
	ownpal=1
	bindtime=-1
	scale=0.5,0.5
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	pos=var(3)*(teamside=2)+floor((12+(var(47)%10)*12)*fvar(0))*ifelse(teamside=1,1,-1) ,  var(4)-floor((35+(var(47)%100)/10*12)*fvar(0))
	removetime=-2  +(var(47):=var(47)+1)*0
;---
;sys::ki_icon_index/pos_reset
[state 0]
	type=varset
	trigger1=(numexplod(230100)=0) || (var(47)%100>29)
	var(47)=(var(47)/100)*100 ;; pos_reset


;==========================
;==========================
;; Key Pressed Switch / ボタン開閉
;; v08: bit flag (15th-24th,26th)
;;---
;sys::ki_switch00
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&16384)
	trigger1=(root,command!="holdfwd")
	var(8)=var(8)^16384
[state 0] ; on
	type=varset
	trigger1=(root,command="holdfwd")
	trigger1=!(var(8)&16384)
	var(8)=var(8)|16384
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&32768)
	trigger1=(root,command!="holdback")
	var(8)=var(8)^32768
[state 0] ; on
	type=varset
	trigger1=(root,command="holdback")
	trigger1=!(var(8)&32768)
	var(8)=var(8)|32768
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&65536)
	trigger1=(root,command!="holdup")
	var(8)=var(8)^65536
[state 0] ; on
	type=varset
	trigger1=(root,command="holdup")
	trigger1=!(var(8)&65536)
	var(8)=var(8)|65536
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&131072)
	trigger1=(root,command!="holddown")
	var(8)=var(8)^131072
[state 0] ; on
	type=varset
	trigger1=(root,command="holddown")
	trigger1=!(var(8)&131072)
	var(8)=var(8)|131072
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&262144)
	trigger1=(root,command!="x")
	var(8)=var(8)^262144
[state 0] ; on
	type=varset
	trigger1=(root,command="x")
	trigger1=!(var(8)&262144)
	var(8)=var(8)|262144
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&524288)
	trigger1=(root,command!="y")
	var(8)=var(8)^524288
[state 0] ; on
	type=varset
	trigger1=(root,command="y")
	trigger1=!(var(8)&524288)
	var(8)=var(8)|524288
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&1048576)
	trigger1=(root,command!="z")
	var(8)=var(8)^1048576
[state 0] ; on
	type=varset
	trigger1=(root,command="z")
	trigger1=!(var(8)&1048576)
	var(8)=var(8)|1048576
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&2097152)
	trigger1=(root,command!="a")
	var(8)=var(8)^2097152
[state 0] ; on
	type=varset
	trigger1=(root,command="a")
	trigger1=!(var(8)&2097152)
	var(8)=var(8)|2097152
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&4194304)
	trigger1=(root,command!="b")
	var(8)=var(8)^4194304
[state 0] ; on
	type=varset
	trigger1=(root,command="b")
	trigger1=!(var(8)&4194304)
	var(8)=var(8)|4194304
;;---
[state 0] ; off
	type=varset
	trigger1=(var(8)&8388608)
	trigger1=(root,command!="c")
	var(8)=var(8)^8388608
[state 0] ; on
	type=varset
	trigger1=(root,command="c")
	trigger1=!(var(8)&8388608)
	var(8)=var(8)|8388608
;;---
;;--- display flag
[state 0] ; off
	type=varset
	trigger1=(var(8)&33554432)
	var(8)=var(8)^33554432
[state 0] ; on
	type=varset
	trigger1=!(var(8)&33554432)
	trigger1=var(51)<1 && (var(7)&128)||Enemy, Name = "Training" ;; system_switch
	trigger1=(root,movetype!=h)||(root,stateno=[120,159])||(root,stateno=[5000,5199])||(root,stateno=[190190,190196])
	var(8)=var(8)|33554432


;==========================
; info. update
;==========================
;--- Player Time
;sys::update_player_time
[state 0]
	type=varset
	trigger1=playeridexist(var(15))
;old;	var(26)=playerid(var(15)),time *(var(26)<playerid(var(15)),time)
	var(26)=ifelse(var(26)<=(playerid(var(15)),time) , (playerid(var(15)),time) , -1 )
;sys::update_partner_time
[state 0]
	type=varset
	trigger1=numpartner && var(15)!=var(49) && playeridexist(var(49))
;old;	var(27)=playerid(var(49)),time *(var(27)<playerid(var(49)),time)
	var(27)=ifelse(var(27)<=(playerid(var(49)),time) , (playerid(var(49)),time) , -1 )

;--- RoundState Time
;sys::update_helpers_timer ; 内部経過時間
[state 0]
	type=varadd
	trigger1=1
	var(28)=1
;sys::timer-reset_roundstate2 ; roundstate2 時再設定
[state 0]
	type=varset
	trigger1=(roundstate=2)
	var(28)=0
	persistent=0
;sys::timer-reset_roundstate3 ; roundstate3 時再設定
[state 0]
	type=varset
	trigger1=(roundstate=3)
	var(28)=0
	persistent=0


;==========================
;==========================
;;>>@Config.Ranking>>
; Ranking [helper] ; ランキング
;==========================
[statedef 99980]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- ---
; v41:	players life >> life / vital bonus
; v42:	damage >> wait time
; v43:	life_view >> contents grid (pos y)
; v44:	jumpcounter >> rank
; v46:	draw depth ;描画深度
; v31-32:	(lifebar) draw pos x y
; v33-36:	(power/graph) bar draw x y
; v37:	panel_color ;色合 (1-4) (+2)
; v44:	rank (0-14) (O1-C3-B3-A3-S3-M)
; f12-15:	bar scale (w or h)
; f16>f25:	bonus_tech
; f17>f1:	bonus_life
; f23>f8:	bonus_offence
; f24>f7:	bonus_defence
;--- ---
[state 0]
	type=assertspecial
	trigger1=1
	flag=nobardisplay
;op;	flag2=invisible
	ignorehitpause=1
[state 0]
	type=width
	trigger1=1
	value=0,0
;---
;sys::init1
[state 0]
	type=null
	trigger1=!time && ishelper(stateno)
	trigger1=1|| var(3):=parent,var(3)||var(4):=parent,var(4)||var(5):=parent,var(5)||var(6):=parent,var(6)||var(7):=parent,var(7)||var(8):=parent,var(8)||var(9):=parent,var(9)
	trigger1=1|| var(15):=parent,var(15)||var(24):=parent,var(24)||var(46):=parent,var(46)||var(51):=parent,var(51)||var(58):=parent,var(58)
	trigger1=1|| fvar(0):=parent,fvar(0)||fvar(3):=parent,fvar(3)||fvar(5):=parent,fvar(5)||fvar(6):=parent,fvar(6)||fvar(7):=parent,fvar(7)||fvar(8):=parent,fvar(8)||fvar(25):=parent,fvar(25)
	persistent=0
;sys::init2
[state 0]
	type=null
	trigger1=!time
	trigger1=1||var(42):=8 ;;<-init wait time
	trigger1=1||var(31):=var(3)/2 +floor(280*fvar(0))*ifelse(teamside=1,-1,1) || var(32):=floor(var(4)*0.4) ;;<- panel_pos_x/y (gameheight*0.4)
	persistent=0
;sys::keep-win1
[state 0]
	type=assertspecial
	trigger1=win
	flag=roundnotover
	ignorehitpause=1
;---
;sys::draw-flag ;; (=lifebar flag) (4th bit)
[state 0] ; on
	type=varset
	triggerall=!time && win
	triggerall=(var(7)&32) ;; system_switch
	trigger1=!(var(9)&4096) ;;<-bonus stage(12th bit)
	var(9)=var(9)|4
;---
;sys::panel_side_scroll
[state 0]
	type=varadd
	trigger1=(time-var(42)=[0,10])
	var(31)=floor(ifelse(teamside=1,1,-1)*20*fvar(0))
[state 0]
	type=varadd
	trigger1=(time-var(42)=[11,200]) && (time%5=0)
	var(31)=floor(ifelse(teamside=1,1,-1)*fvar(0))
[state 0]
	type=varadd
	trigger1=time-var(42)>200
	var(31)=floor((time-var(42)-200)*3*ifelse(teamside=1,1,-1)*fvar(0))

;---------------
; calculate bonus ; ボーナス計算
;---------------
;sys::bonus_life_single
[state 0]
	type=varset
	trigger1=!time && !numpartner
	var(41)=playerid(var(15)),life*30/playerid(var(15)),lifemax
	persistent=0
;sys::bonus_life_tag-1
[state 0]
	type=varset
	trigger1=!time && numpartner=1
	var(41)=(root,life+partner,life)*30/(root,lifemax+parent,lifemax)
	persistent=0
;sys::bonus_life_tag-2
[state 0]
	type=varset
	trigger1=!time && numpartner=2
	var(41)=(root,life+playerid(root,id+1),life+playerid(root,id+2),life)*30/(root,lifemax+playerid(root,id+1),lifemax+playerid(root,id+2),lifemax)
	persistent=0
;sys::bonus_life_tag-3
[state 0]
	type=varset
	trigger1=!time && numpartner=3
	var(41)=(root,life+playerid(root,id+1),life+playerid(root,id+2),life+playerid(root,id+3),life)*30/(root,lifemax+playerid(root,id+1),lifemax+playerid(root,id+2),lifemax+playerid(root,id+3),lifemax)
	persistent=0
;sys::bonus_life_reset
[state 0]
	type=varset
	trigger1=!time && (var(41)!=[0,30])
	var(41)=(var(41)>30)*30
;;---
;; (var(9)&68)=68 : first attack (+5)
;; (var(41)>=30) : life / perfect (+25)
;; (var(9)&128)=128 : super/hyper finish (+30)
;; (var(9)&256)=256 : special finish (+20)
;; f03:  maxhitcombo
;; f05:  rank counter hits
;; f06:  rank bk/jd
;;---
;sys::rank_input1
[state 0]
	type=null
	trigger1=!time
	trigger1=1||fvar(7):=ifelse(fvar(7)>31,31,fvar(7)) ;; bonus_guard/defence
	trigger1=1||fvar(8):=ifelse(fvar(8)>36,36,fvar(8)) ;; bonus_hit/offence
	trigger1=1||fvar(25):=((var(9)&68)=68)*5 +((var(9)&128)=128)*30 +((var(9)&256)=256)*20 +(var(41)>=30)*25 +fvar(3)+fvar(5)+fvar(6)
	trigger1=1||fvar(25):=ifelse(fvar(25)>38,38,fvar(25)) *(fvar(25)>0) ;; bonus_tech
	trigger1=1||var(44):=ceil(fvar(8)+fvar(7)+fvar(25))+var(41) ;; rank
	trigger1=1||var(44):=ifelse(var(44)<0,0,ifelse(var(44)>99,14,var(44)/8)) ;; rank to int
	trigger1=1||var(37):=(var(44)<1)*4 +(var(44)=1)*5 +(var(44)=[2,4])*1 +(var(44)=[5,7])*3 +(var(44)=[8,10])*2 ;; color by rank
;debug;	trigger1=1||var(46):=100 ;; sprpriority
	persistent=0
;---
;sys::img_pos2 ;; bar/bonus/score/rank_pos (x,y)
[state 0]
	type=null
	trigger1=1||var(33):=-floor((fvar(16)+fvar(17)+fvar(23)+fvar(24)) *0.5 *fvar(0)*fvar(12)) ;;<- bar_pos.x
	trigger1=1||var(34):=floor((((!(var(9)&64))+(var(41)<30)+(!(var(9)&384)))*4   -5)*fvar(0)*fvar(12)) ;;<- bar_pos.y
	trigger1=1||var(43):=floor((((!(var(9)&64))+(var(41)<30)+(!(var(9)&384)>0))*2+16)*fvar(0)*fvar(12)) ;;<- bonus_pos.y
;---
;sys::img_graph_var ; 変量
[state 0]
	type=null
	trigger1=time>var(42)+26
	trigger1=1||fvar(16):=fvar(16)+(fvar(16)<fvar(25))||fvar(17):=fvar(17)+(fvar(17)<var(41))||fvar(23):=fvar(23)+(fvar(23)<fvar(8))||fvar(24):=fvar(24)+(fvar(24)<fvar(7))
;---
;sys_img_scores_var ; 得点動態表示
[state 0]
	type=null
	trigger1=time=1
	trigger1=1||var(57):=var(58) || var(58):=0 ;; input ; 代入, reinit ; 再初期化
	persistent=0
;sys_img_score_increasing ; 点数増加
[state 0]
	type=varadd
	trigger1=time>var(42)+18
	trigger1=var(51)<1 && var(58)<var(57)
	var(58)=(var(57)-var(58))/12+1
;---
;sys::img_scale ;; bar/tip/bonus scaling ; バー縮尺
[state 0] ; init ; 初期値
	type=null
	trigger1=!time
	trigger1=1||fvar(12):=0.8||fvar(13):=0||fvar(14):=0||fvar(15):=0
	;; f12: all_scale , f13: bar_scale, f14: bonus_scale, f15: rank_scale
	persistent=0
[state 0] ; modify scales ; 縮尺変更
	type=null
	trigger1=1||fvar(12):=fvar(12) +0.01 *(time>var(42)+10) || fvar(12):=(fvar(12)=[0,1])*fvar(12)+(fvar(12)>1)
	trigger1=1||fvar(13):=fvar(13) +0.05 *(time>var(42)+20) || fvar(13):=(fvar(13)=[0,0.5])*fvar(13)+(fvar(13)>0.5)*0.5
	trigger1=1||fvar(14):=fvar(14) +0.1  *(time>var(42)+30) || fvar(14):=(fvar(14)=[0,0.2])*fvar(14)+(fvar(14)>0.2)*0.2
	trigger1=1||fvar(15):=fvar(15) +0.1  *(time>var(42)+40) || fvar(15):=(fvar(15)=[0,0.5])*fvar(15)+(fvar(15)>0.5)*0.5
;---
; drawing ; 描画
;---
;sys::img_d_cls ; 再描画
[state 0]
	type=removeexplod
	trigger1=1
	id=1 ;;<- id painted in this state

;---
;sys::screen_edge_dark_win
; v35-36 temp pos x/y
[state 0]
	type=explod
	trigger1=(time-var(42)=10)
	id=2
	anim=f3021
	sprpriority=var(46)-20
	ownpal=1
	space=screen
	postype=left
	pos=-floor(75*fvar(0)),var(4)/2
	scale=1,var(4)/240.0/fvar(0)
	bindtime=-1
;; only v1.1 works whit bindtime=-1
;op;	vel=  -0.0005*fvar(0)
	accel=-0.0005*fvar(0)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=(time-var(42)=10)
	id=2
	anim=f3021
	sprpriority=var(46)-20
	ownpal=1
	space=screen
	postype=left
	pos=var(3)+floor(75*fvar(0)),var(4)/2
	scale=-1,var(4)/240.0/fvar(0)
	bindtime=-1
;op;	vel=  0.0005*fvar(0)
	accel=0.0005*fvar(0)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1

;---
;sys::over
[state 0]
	type=destroyself
	trigger1=ishelper(stateno) && (time-var(42)>=256 || (!(win) && time>2))
;op;	recursive=1     ;v1.1
;op;	removeexplods=1 ;v1.1

;---
;sys::img_d_bg_shadow
[state 0]
	type=explod
	trigger1=(var(9)&4)
	id=1
	anim=f160300
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31), var(32) -floor(42*fvar(0)*fvar(12))
	scale=fvar(12)*1.25, floor(84*fvar(12))
	sprpriority=var(46)
	ownpal=1
	bindtime=-1
;sys::img_d_bg_top
[state 0]
	type=explod
	trigger1=(var(9)&4)
	id=1
	anim=f160301 +var(37)
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31), var(32) -floor(42*fvar(0)*fvar(12))
	scale=1.75*fvar(12),fvar(12)
	sprpriority=var(46)+1
	ownpal=1
	bindtime=-1
;sys::img_bg_bottom
[state 0]
	type=explod
	trigger1=(var(9)&4)
	id=1
	anim=f160301 +var(37)
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31), var(32) +floor(42*fvar(0)*fvar(12))
	scale=1.75*fvar(12),-0.5*fvar(12)
	sprpriority=var(46)+1
	ownpal=1
	bindtime=-1
;---
;sys::img_d_color-blending-top
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(44)>13) && (time>var(42)+36)
	id=1
	anim=f160301 +((time-var(42))/24)%5
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31), var(32) -floor(42*fvar(0)*fvar(12))
	scale=1.85*fvar(12),fvar(12)
	sprpriority=var(46)+1
	ownpal=1
	bindtime=-1
	trans=addalpha
	alpha=abs(((time-var(42)+12)%24)-12)*20,256
;sys::img_d_color-blending-bottom
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(44)>13) && (time>var(42)+36)
	id=1
	anim=f160301 +((time-var(42))/24)%5
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	pos=var(31), var(32) +floor(42*fvar(0)*fvar(12))
	scale=1.85*fvar(12),-0.5*fvar(12)
	sprpriority=var(46)+1
	ownpal=1
	bindtime=-1
	trans=addalpha
	alpha=abs(((time-var(42)+12)%24)-12)*20,256
;---
;sys::img_d_first_attack
[state 0]
	type=explod
;__;	trigger1=(var(9)&4) && (var(9)&64)
	trigger1=(var(9)&68)=68
	id=1
	anim=f160030
	space=screen
	postype=left
	pos=var(31), var(32)+var(34)+var(43)
	scale=fvar(13)*fvar(12),0.5*fvar(12)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
;sys::img_d_perfect_match
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(41)>=30) ;<<-life/perfect
	id=1
	anim=f160033
	space=screen
	postype=left
	pos=var(31), var(32)+var(34)+var(43) +floor((((var(9)&64)>0)*9)*fvar(0)*fvar(12))
	scale=fvar(13)*fvar(12),0.5*fvar(12)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
;sys::img_d_hyper_finish ;; super/hyper-combo-finish
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(9)&384)
	id=1
	anim=f160030+ifelse((var(9)&128)>0,2,1)
	space=screen
	postype=left
	pos=var(31), var(32)+var(34)+var(43) +floor(((((var(9)&64)>0)+(var(41)>=30))*9)*fvar(0)*fvar(12))
	scale=fvar(13)*fvar(12),0.5*fvar(12)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
;---
;sys::img_d_bar_tech
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(16)>0)
	id=1
	anim=f160004
	space=screen
	postype=left
	pos=var(31)+var(33), var(32)+var(34)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
	scale=fvar(16)*fvar(12),fvar(14)*fvar(12)
;sys::img_d_bar_attack ;; / offence
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(23)>0)
	id=1
	anim=f160001
	space=screen
	postype=left
	pos=var(31)+var(33)+floor(fvar(16)*fvar(0)*fvar(12)) ,  var(32)+var(34)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
	scale=fvar(23)*fvar(12),fvar(14)*fvar(12)
;sys::img_d_bar_guard ;; / defence
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(24)>0)
	id=1
	anim=f160002
	space=screen
	postype=left
	pos=var(31)+var(33)+floor((fvar(16)+fvar(23))*fvar(0)*fvar(12)) ,  var(32)+var(34)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
	scale=fvar(24)*fvar(12),fvar(14)*fvar(12)
;sys::img_d_bar_life
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(17)>0)
	id=1
	anim=f160003
	space=screen
	postype=left
	pos=var(31)+var(33)+floor((fvar(16)+fvar(23)+fvar(24))*fvar(0)*fvar(12)) ,  var(32)+var(34)
	sprpriority=var(46)+4
	ownpal=1
	bindtime=-1
	scale=fvar(17)*fvar(12),fvar(14)*fvar(12)
;---
;sys::img_d_tip_tech ;; "TECH"
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(16)>2)
	id=1
	anim=f160013
	space=screen
	postype=left
	pos=var(31)+var(33) +ceil(fvar(16)*0.5*fvar(0)*fvar(12)) ,  var(32)+var(34)
	scale=0.5*fvar(12), 0.5*fvar(12) ;; fvar(14)*fvar(12)
	sprpriority=var(46)+5
	ownpal=1
	bindtime=-1
;sys::img_d_tip_hit ;; "ATT"
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(23)>2)
	id=1
	anim=f160011
	space=screen
	postype=left
	pos=var(31)+var(33) +ceil((fvar(16)+fvar(23)*0.5-1)*fvar(0)*fvar(12)) ,  var(32)+var(34)
	scale=0.5*fvar(12), 0.5*fvar(12) ;; fvar(14)*fvar(12)
	sprpriority=var(46)+5
	ownpal=1
	bindtime=-1
;sys::img_d_tip_guard ;; "DEF"
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(24)>2)
	id=1
	anim=f160010
	space=screen
	postype=left
	pos=var(31)+var(33) +ceil((fvar(16)+fvar(23)+fvar(24)*0.5)*fvar(0)*fvar(12)) ,  var(32)+var(34)
	scale=0.5*fvar(12), 0.5*fvar(12) ;; fvar(14)*fvar(12)
	sprpriority=var(46)+5
	ownpal=1
	bindtime=-1
;sys::img_d_tip_life ;; "VITAL"
[state 0]
	type=explod
	trigger1=(var(9)&4) && (fvar(17)>2)
	id=1
	anim=f160012
	space=screen
	postype=left
	pos=var(31)+var(33) +ceil((fvar(16)+fvar(23)+fvar(24)+fvar(17)*0.5)*fvar(0)*fvar(12)) ,  var(32)+var(34)
	scale=0.5*fvar(12), 0.5*fvar(12) ;; fvar(14)*fvar(12)
	sprpriority=var(46)+5
	ownpal=1
	bindtime=-1
;---
;sys::img_d_rank2
[state 0]
	type=explod
	trigger1=(var(9)&4)
	id=1
	anim=f160100+var(44)
	space=screen
	postype=left
	pos=var(31) -floor(36*fvar(0)*fvar(12)) *ifelse(teamside=1,1,-1) ,  var(32) -floor(fvar(0)*fvar(12) *28)
	sprpriority=var(46)+7
	ownpal=1
	scale=fvar(15)*fvar(12)*1.5,fvar(12)*0.75
	bindtime=-1
;---
;sys::sound_ex_applause ;拍手・喝采
[state 0]
	type=playsnd
	triggerall=(var(7)&64) ;; system_switch
	trigger1=(var(9)&4) && (time-var(42)=42)
	trigger1=(var(51)<1) && (var(44)<3 || var(44)>13)
	value=f20202, ifelse(var(44)>13,(random%2),6)
;sys::sound_ex_panel_wind2
[state 0]
	type=playsnd
	trigger1=(var(9)&4) && (time-var(42)=8)
	value=f2100,101
	channel=0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;sys::sound_ex_panel_wind3
[state 0]
	type=playsnd
	trigger1=(var(9)&4) && (time-var(42)=186)
	value=f2100,100
	abspan=ifelse(teamside=1,1,-1)*facing*320
	channel=0
;sys::sound_announcer_player1win
[state 0]
	type=playsnd
	triggerall=(var(7)&64) ;; system_switch
	trigger1=(var(9)&4) && (time-var(42)=56)
;v1.0;	trigger1=numenemy
;v1.0;	trigger1=root,ailevel<1 || enemy,ailevel<1
;op;	trigger1=var(51)<1 || (matchno>1&&ishometeam=1)
;op;	value=f10300,ifelse(var(51)>0,1,0) ;;<- "you win" / "you lose"
	value=f10300,10+teamside ;;<- "player 1 win" / "player 2 win"
	abspan=ifelse(teamside=1,-1,1)*facing*320
	channel=1
;sys::sound_announcer_perfect
[state 0]
	type=playsnd
	triggerall=(var(7)&64) ;; system_switch
	trigger1=(var(9)&4) && (time-var(42)=128)
	trigger1=var(51)<1 && var(41)=30 ; <<life ;ライフ計算後
	value=f10300,2
	abspan=ifelse(teamside=1,-1,1)*facing*320
	channel=1
;sys::sound_ex_panel_wind4 ;; eff: don for rank
[state 0]
	type=playsnd
	trigger1=(var(9)&4) && (time-var(42)=42)
	value=f10300,20 ;; ex-don
;op;	channel=0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;---
;sys::scores_and_bonus ; 点数・ボーナス
[state 0]
	type=varadd
	trigger1=!time
	var(58)=var(44)*250
;sys::score_to_parent ; 親に加算
[state 0]
	type=parentvarset
	trigger1=!time && ishelper(stateno) && !(var(9)&4096) ;;<-bonus stage(12th bit)
	var(57)=var(58)
;sys::score_to_parent_bonus-stage
[state 0]
	type=parentvarset
	trigger1=time && ishelper(stateno) && numenemy && (var(9)&4096) ;;<-bonus stage(12th bit)
	trigger1=root,sysvar(4) && enemy,sysvar(4) && enemy,var(58)>parent,var(58)
	var(57)=enemy,var(58)
;---
;sys::img_d_score2 ; 点数描画
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>0
	id=1
	anim=f300000+(var(58)%10)
	space=screen
	postype=left
	pos= (var(35):=var(31) +floor((ifelse(teamside=1,30,-30) +floor(log(10,var(58)))*9/2)*fvar(0)*fvar(12)) ),  (var(36):=var(32) -floor(fvar(0)*fvar(12) *20)) ;;<- score_pos.y
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>9
	id=1
	anim=f300000+((var(58)/10)%10)
	space=screen
	postype=left
	pos=var(35)-floor(9*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>99
	id=1
	anim=f300000+((var(58)/100)%10)
	space=screen
	postype=left
	pos=var(35)-floor(18*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>999
	id=1
	anim=f300000+((var(58)/1000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(27*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>9999
	id=1
	anim=f300000+((var(58)/10000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(36*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>99999
	id=1
	anim=f300000+((var(58)/100000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(45*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>999999
	id=1
	anim=f300000+((var(58)/1000000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(54*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>9999999
	id=1
	anim=f300000+((var(58)/10000000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(63*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
[state 0]
	type=explod
	trigger1=(var(9)&4) && var(51)<1 && var(58)>99999999
	id=1
	anim=f300000+((var(58)/100000000)%10)
	space=screen
	postype=left
	pos=var(35)-floor(72*fvar(0)*fvar(12)),var(36)
	sprpriority=var(46)+6
	ownpal=1
	scale=0.15*fvar(12),0.15*fvar(12)
	bindtime=-1
;---
;sys::img_d_cpu-mark ; ("cpu"標記)
[state 0]
	type=explod
	trigger1=(var(9)&4) && (var(51)>0)
	trigger1=1|| var(52):=ifelse(time<50, 1, var(52):=var(52)+ ((var(52)<var(51))&&(var(52)<9)&&(time%5=0)) )
	id=1
	anim=f297000 +var(52) ;;+ifelse(var(51)>8,8,var(51))
	space=screen
	postype=left
	pos=var(31) +floor(30*fvar(0)*fvar(12)) *ifelse(teamside=1,1,-1) ,  var(32) -floor(26*fvar(0)*fvar(12))
	sprpriority=var(46)+6
	ownpal=1
	scale=fvar(15)*fvar(12)*2,fvar(12) ;;scale=[1x1]
	bindtime=-1
;sys::img_d_lights2
[state 0]
	type=explod
	trigger1=(var(9)&4) && (time-var(42)=50)
	anim=f151
	space=screen
	postype=left
	sprpriority=var(46)+8
	ownpal=1
	pos= (var(35):=var(31) -floor(30*fvar(0)*fvar(12))*ifelse(teamside=1,1,-1)) ,  var(36):=var(32) -floor(fvar(0)*fvar(12) *28)
	vel=-1.15*fvar(0)*ifelse(teamside=1,1,-1),0
	scale=0.1,2.5
;sys::img_d_lights3
[state 0]
	type=explod
	trigger1=(var(9)&4) && (time-var(42)=50)
	anim=f151
	space=screen
	postype=left
	sprpriority=var(46)+8
	ownpal=1
	pos=var(35),var(36)
	vel=-1.15*fvar(0)*ifelse(teamside=1,1,-1),0
	scale=2.5,0.1


;==========================
;==========================
;;>>@Config.Round_Fight>>
; "round 1 fight!" (round-call) [helper]
; ラウンド開始
;==========================
[statedef 180000]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0]
	type=assertspecial
	trigger1=1
	flag=timerfreeze
;op;	flag2=nobardisplay
;op;	flag3=invisible
	ignorehitpause=1
;---
;sys::over-flag
[state 0]
	type=varset
	trigger1=var(1)>100 ;; timer
	var(0)=1 ;; set
;sys::f1-key_pressed ; F1キーが押された場合
[state 0]
	type=varset
	trigger1=roundstate>2 || win || lose
	var(0)=10
;sys::init
[state 0]
	type=posset
	trigger1=!time
	trigger1=1|| fvar(0):=(parent,fvar(0)) || fvar(1):=(random%31)-15
	;;--- fv0: localcoord , fv1: angle_img_"fight"
	trigger1=1|| var(9):=(random%4) || var(10):=roundno || var(11):=(parent,var(3)/2) || var(12):=(parent,var(4)/2) || var(21):=ifelse(roundno%2,-1,1)
	;;--- v9: rounds_color , v10: roundno , v11-12: center_pos_x/y , v21: facing
	trigger1=1|| var(13):=var(11)-floor(15*fvar(0)) || var(14):=var(12)+floor(24*fvar(0)) || var(15):=var(11)+floor(5*fvar(0)) || var(16):=var(12)+floor(55*fvar(0))
	;;--- v13-14: rounds pos_x/y , v15-16: num pos_x/y
	x=0
	y=0
;sys::skip2
[state 0]
	type=varadd
	trigger1=roundstate=2
	var(1)=1
;sys::sound_announcer_round-call
[state 0]
	type=playsnd
	trigger1=var(1)=1
	value=f10500,(var(10)%4)
	channel=1
;op;	freqmul=2.0
	pan=0
	abspan=0
;sys::sound_ex-panel-wind
[state 0]
	type=playsnd
	trigger1=!var(20) && var(1)=8
	value=f2100,101
	abspan=0
;---
;sys::screen_edge_dark_ready
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=2
	id=3
	anim=f3020
	sprpriority=parent,var(46)-10
	ownpal=1
	space=screen
	postype=left
	pos=-floor(100*fvar(0)),var(12)
	scale=1,var(12)/80.0/fvar(0)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=2
	id=3
	anim=f3020
	sprpriority=parent,var(46)-10
	ownpal=1
	space=screen
	postype=left
	pos=var(11)*2+floor(100*fvar(0)),var(12)
	scale=-1,var(12)/80.0/fvar(0)
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;sys::img_d_ready1
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=1 && !numexplod(1)
	anim=f199130
	id=1
	space=screen
	postype=left
	sprpriority=2
	ownpal=1
	bindtime=-1
	pos=var(11),var(12)
	scale=0.25,0.25
	ontop=1
	removetime=-1
;sys::img_d_ready2
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=1 && numexplod(1)=1
	anim=f199139 ;;<MASK>
	id=1
	space=screen
	postype=left
	sprpriority=-2
	ownpal=1
	bindtime=-1
	pos=var(11),var(12)
	scale=0.5,0.5
	ontop=1
	removetime=-1
;sys::img_d_mod1
[state 0]
	type=modifyexplod
	trigger1=numexplod(1)
	postype=left
	pos=var(11)+ifelse(var(1)<30,floor(((30-var(1))**3)*0.05)*var(21),0),var(12)
	id=1
;---
;sys::img_d_rounds1
[state 0]
	type=explod
	trigger1=!var(20) && var(1)>0
	anim=f199120 +ifelse(time%8>3,var(9),4)
	id=2
	space=screen
	postype=left
	sprpriority=-1
	ownpal=1
	bindtime=-1
	pos=var(13)+var(8),var(14)
	scale=1,1
	ontop=1
	removetime=1
;sys::img_d_nums1 ;; numbers v6:color
[state 0]
	type=explod
	id=2
	trigger1=!var(20) && var(1)>0 && var(10)>0
	anim=f300000+(var(10)%10) +(var(6):=ifelse((time%16=[8,11]),60,ifelse((time%16=[0,3]),50,0)))
	space=screen
	postype=left
	pos=floor(30*(1+(var(10)>9)+(var(10)>99))*fvar(0)*fvar(2)*2)+var(15)+var(8),var(16)
	scale=(fvar(2):=ifelse(var(1)<20,(20-var(1))*0.025,0)+0.5) ,fvar(2)  ;;0.5,0.5
	sprpriority=2
	ownpal=1
	bindtime=-1
	ontop=1
	removetime=1
;sys::img_d_nums2
[state 0]
	type=explod
	id=2
	trigger1=!var(20) && var(1)>0 && var(10)>9
	anim=f300000+((var(10)/10)%10) +var(6)
	space=screen
	postype=left
	pos=floor(30*(1+(var(10)>99))*fvar(0)*fvar(2)*2)+var(15)+var(8),var(16)
	scale=fvar(2),fvar(2)
	sprpriority=2
	ownpal=1
	bindtime=-1
	ontop=1
	removetime=1
;sys::img_d_nums3
[state 0]
	type=explod
	id=2
	trigger1=!var(20) && var(1)>0 && var(10)>99
	anim=f300000+((var(10)/10)%10) +var(6)
	space=screen
	postype=left
	pos=floor(30*fvar(0)*fvar(2)*2)+var(15)+var(8),var(16)
	scale=fvar(2),fvar(2)
	sprpriority=2
	ownpal=1
	bindtime=-1
	ontop=1
	removetime=1
;---
;sys::img_pos2
[state 0]
	type=varset
	trigger1=1
;old;	var(8)=floor( ifelse(var(1)<30, ((30-var(1))**3)*0.05, -(var(1)-30)*0.2 ) )*var(21)
	var(8)=floor( -(var(1)-30)*0.2 )*var(21)
[state 0]
	type=modifyexplod
	trigger1=numexplod(2)
	id=2
	trans=addalpha
	alpha= ifelse(var(1)<32,var(1)*8,256), ifelse(var(1)<32,256-var(1)*8,0)
;---
;sys::img_d_light1
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=30
	anim=f151
	space=screen
	postype=left
	sprpriority=5
	ownpal=1
	pos=var(15)+floor(35*fvar(0)),var(16)-floor(33*fvar(0))
	vel=0.5*fvar(0)*var(21),0
	scale=0.2,5
	ontop=1
;sys::img_d_light2
[state 0]
	type=explod
	trigger1=!var(20) && var(1)=30
	anim=f151
	space=screen
	postype=left
	sprpriority=5
	ownpal=1
	pos=var(15)+floor(35*fvar(0)),var(16)-floor(33*fvar(0))
	vel=0.5*fvar(0)*var(21),0
	scale=5,0.2
	ontop=1
;---
;sys::img_d_fight1
[state 0]
	type=explod
	trigger1=var(0)=1
	anim=f199006+var(21) ;;<MASK>
	id=3
	space=screen
	postype=left
	sprpriority=0
	ownpal=1
	pos=var(11),var(12)
	scale=1.25,1.25
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	angle=fvar(1)
;sys::img_d_fight2
[state 0]
	type=explod
	trigger1=var(0)=1
	anim=f199001+var(21)
	id=3
	space=screen
	postype=left
	sprpriority=7
	ownpal=1
	pos=var(11),var(12)
	scale=1.25,1.25
	bindtime=-1
	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	angle=fvar(1)
;sys::img_d_flash
[state 0]
	type=explod
	trigger1=var(0)=1
	anim=f151
	id=3
	space=screen
	postype=left
	sprpriority=-5
	ownpal=1
	pos=var(11),var(12)
	scale=100,100
	bindtime=-1
;op;	ontop=1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	trans=add
alpha=256,256 ;;***
;---
;sys::sound-stop
[state 0]
	type=stopsnd
	trigger1=var(0)
	channel=1
;sys::sound_announcer_fight
[state 0]
	type=playsnd
	trigger1=var(0)=1
	value=f20000,10 ;;<- sound "fight!!!"
	channel=1
	abspan=0
	ignorehitpause=1
;---
;sys::parent_timer-reset_round_start
[state 0]
	type=parentvarset
	trigger1=var(0)
	trigger2=(parent,stateno=90900) && (parent,var(28)>10)
	var(28)=0
;---
;sys::img_d_cls
[state 0]
	type=removeexplod
	trigger1=var(0)
	id=1
	ignorehitpause=1
;---
;sys::over
[state 0]
	type=destroyself
	trigger1=var(0)
	ignorehitpause=1


;==========================
;==========================
;;>>@Config.Round_KO>>
; Round-KO [helper]
; ラウンド終了
;==========================
[statedef 180010]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0

;---
;sys::init
[state 0]
	type=null
	trigger1=!time
	trigger1=1|| var(3):=parent,var(3) || var(4):=parent,var(4) || var(15):=parent,var(15) || var(16):=parent,var(16) || fvar(0):=parent,fvar(0)
	;---
	trigger1=1|| var(5):=var(3)/2 || var(6):=var(4)/2
	trigger1=playeridexist(var(16))
	trigger1=(playerid(var(16)),screenpos x=[0,var(3)]) && (playerid(var(16)),screenpos y-const240p(50)=[0,var(4)])
	trigger1=var(5):=floor(playerid(var(16)),screenpos x)||var(6):=floor(playerid(var(16)),screenpos y-const240p(50))
	;---
	persistent=0
;---
;sys::hyper-finish
; スーパーコンボ・フィニッシュ
[state 0]
	type=varset
	triggerall=!time && winko
	trigger1=(root,movehit) && (root,hitdefattr=sca,ha,hp,ht)
	trigger2=numpartner
	trigger2=(partner,movehit) && (partner,hitdefattr=sca,ha,hp,ht)
	;;--- check from attack id special:[1000-2999] hyper:[3000-]
	trigger3=playeridexist(var(16))
	trigger3=(playerid(var(16)),gethitvar(chainid)>2999)
	var(0)=2
	persistent=0
;sys::special-finish
; スペシャル・フィニッシュ
[state 0]
	type=varset
	triggerall=!time && winko
	trigger1=(root,movehit) && (root,hitdefattr=sca,sa,sp,st)
	trigger2=numpartner
	trigger2=(partner,movehit) && (partner,hitdefattr=sca,sa,sp,st)
	;;--- check from attack id special:[1000-2999] hyper:[3000-]
	trigger3=playeridexist(var(16))
	trigger3=(playerid(var(16)),gethitvar(chainid)=[1000,2999])
	var(0)=1
	persistent=0
;---
;sys::sent2parent_ko_type ;; (8-9th bit)
[state 0]
	type=parentvarset
	trigger1=(var(0)=[1,2])
	var(9)=parent,var(9)|(ifelse(var(0)=1,256,128))
;---
;---
;;>>@Config.KO>>
;sys::ko_pause
[state 0]
	type=pause
	trigger1=!time && var(0) && (var(2):=ifelse(var(0)=2,42,28))
	time=    var(2)
	movetime=var(2)
	persistent=0
;sys::ko_disable_bgm
[state 0]
	type=assertspecial
	trigger1=numexplod(199300) ;; img_ko
	flag=nomusic
	ignorehitpause=1
;sys::ko_disable_shake
[state 0]
	type=envshake
	trigger1=winko
	time=1
	ampl=0
	ignorehitpause=1
;---
;sys::sound_announcer_ko
[state 0]
	type=playsnd
	trigger1=!time && winko
	value=f20000,20 ;;<-[KO]
;2;	value=f10300,3 ;;<-[hyper combo finish!]
;old;	abspan=0
	abspan=ifelse(teamside=1,-1,1)*facing*320
;op;	channel=1
	persistent=0
;---
;sys::sound_ko_hyper-eff
[state 0]
	type=playsnd
	trigger1=!time && var(0)=2
	value=f3000,0 ;;<-[dokkan...!]
;op;	volumescale=100 ;;[0-100]%
	abspan=0
	channel=1
	persistent=0
;---
;sys::ko_d_hyper-finifsh_mask
[state 0]
	type=explod
	trigger1=var(0)=2 && !numexplod(199310)
	id=199310
	anim=f3001
	sprpriority=(parent,var(46)-12)
	ownpal=1
	space=screen
	postype=left
	pos=var(5),var(6)
	scale=var(3)/320.0/fvar(0)+0.01,var(4)/240.0/fvar(0)+0.01
	bindtime=-1
	persistent=0
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=modifyexplod
	trigger1=numexplod(199310)
	id=199310
	scale=var(3)/160.0/fvar(0)+0.01*time,var(4)/120.0/fvar(0)+0.01*time
	ignorehitpause=1
;---
;sys::ko_d_hyper-finifsh_wave
[state 0]
	type=explod
	trigger1=(!time) && numexplod(199310)
	id=199315
	anim=f3002
	sprpriority=(parent,var(46)-11)
	ownpal=1
	space=screen
	postype=left
	pos=var(5),var(6)
	scale=0,0
	bindtime=-1
	removetime=var(2)
	persistent=0
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
[state 0]
	type=modifyexplod
	trigger1=numexplod(199315)
	id=199315
	scale=fvar(12):=((time%(var(2)/3))+0.1)**2*0.02,fvar(12)*0.75
	ignorehitpause=1
;---
;sys::ko_d_hyper-finifsh_color
[state 0]
	type=explod
	trigger1=numexplod(199310) && !numexplod(199311) && !numexplod(199312)
	id=199311 +(playerid(var(15)),numhelper(88870)>0) ;;max2bg
	anim=f3010
	sprpriority=(parent,var(46)-10)
	ownpal=1
	space=screen
	postype=left
;op;	pos=-5*var(3),0
	pos=-(random%30)*var(3),0
;;old	scale=var(3),var(4)
	scale=floor(var(3)/fvar(0)),floor(var(4)/fvar(0))
	bindtime=-1
	persistent=0
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::ko_d_hyper-finifsh_color-swap
[state 0]
	type=modifyexplod
	trigger1=numexplod(199312)
	id=199312
	postype=left
	pos=-(time%30)*var(3),0
	ignorehitpause=1
;sys::ko_no-bg ;; during hyper
;;[state 0]
;;	type=assertspecial
;;	trigger1=playerid(var(15)),numhelper(88880)=0 && playerid(var(15)),numhelper(88870)>0 ;; max2bg
;;	flag=nobg
;;	flag2=nofg
;;	ignorehitpause=1
;---
;sys::ko_d_img1
[state 0]
	type=explod
	trigger1=winko && !numexplod(199300)
	anim=f199302+(teamside-1)
	id=199300
	space=screen
	postype=left
	sprpriority=5
	ownpal=1
	pos=var(3)/2,var(4)/2
	scale=0.5,0.5
	bindtime=-1
	vel=ifelse(teamside=1,1,-1),0
	ontop=1
	persistent=0
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::ko_d_img2
[state 0]
	type=explod
	trigger1=numexplod(199300)=1
	anim=f199300+(teamside-1)
	id=199300
	space=screen
	postype=left
	sprpriority=7
	ownpal=1
	pos=var(3)/2,var(4)/2
	scale=0.5,0.5
	bindtime=-1
	vel=ifelse(teamside=1,1,-1),0
	ontop=1
	persistent=0
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
;---
;sys::over
[state 0]
	type=destroyself
	trigger1=time>=var(2)
	ignorehitpause=1

;==========================
;==========================
;;>>@Config.Round_Down>>
; Round-Down [helper]
; ラウンド-ダウン
;==========================
[statedef 180020]
type=s
movetype=i
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.01] ; bg
	type=explod
	trigger1=!time
	anim=f3530
	space=screen
	postype=left
	scale=3200,1
	sprpriority=-128
	ownpal=1
	bindtime=-1
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;---
[state 0]
	type=pause
	trigger1=(time=1) && (roundstate=2)
	time=20
	movetime=20
;---
[state 0]
	type=destroyself
	trigger1=(time=1) || (roundstate!=2)
	ignorehitpause=1


;==========================
;==========================
; Ground Wave [helper] ; 地面衝突用
;==========================
[statedef 159005]
type=c
physics=n
anim=909601 ;; empty
ctrl=0

;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1|| var(0):= const(size.height) *(const(size.height)=[0,9])
	trigger1=1|| fvar(0):=(var(0)+8)*0.041 || fvar(1):=fvar(0)*0.85 || fvar(2):=(var(0)*2+9)*0.05 || fvar(10):=(const(size.ground.back)+const(size.ground.front))*0.031 ;;<-localcoord
	trigger1=root,sysfvar(0)>0 && playeridexist(floor(root,sysfvar(0)))
	trigger1=playerid(floor(root,sysfvar(0))),var(0)=90900
	trigger1=1|| var(24):=playerid(floor(root,sysfvar(0))),var(24) ;;<-stage type
;---
[state 0] ;[.01b]
	type=envshake
	trigger1=!time && var(0)>1
	time=ifelse(var(0)>4,12,6)
	ampl=ifelse(var(0)>4, 4,2)
	ignorehitpause=1
;--- ground_wave
[state 0] ;[.02a]
	type=explod
	trigger1=!time
	anim=f6565 +(var(0)>0) +(var(0)>4) ;; <MASK>
	scale=fvar(0),fvar(1)
	postype=p1
	sprpriority=-7
	ownpal=1
	persistent=0
[state 0] ;[.02b]
	type=explod
	trigger1=!time
	anim=f6560 +(var(0)>0) +(var(0)>4)
	scale=fvar(0),fvar(1)
	postype=p1
	sprpriority=-6
	ownpal=1
	persistent=0
;---
; water sound ; 水 - 効果音
[state 0] ;[.03a]
	type=playsnd
	trigger1=!time && var(24)=1 ;;<-water
	value=f127,0
; water land ; 水 - 離陸/着陸/移動
[state 0] ;[.03b]
	type=explod
	trigger1=!time && var(24)=1 ;;<-water
	anim=f10330
	postype=p1
	sprpriority=7
	ownpal=1
	pos=0,floor(-pos y*10)/10
	scale=1.25*ifelse(random<500,1,-1)*const(size.xscale),1.25*const(size.yscale)
;--- hit ground sound
[state 0] ;[.04a]
	type=playsnd
	trigger1=!time
	value=f7,(var(0)>1)+(var(0)>4)
;--- dust ; 埃
[state 0] ;[.04a]
	type=explod
	trigger1=!time && var(0)>4
	anim=f210502-(var(0)>4)
	postype=p1
	sprpriority=-6
	ownpal=1
	facing=  1
	vfacing=-1
	pos=floor(-12*const(size.xscale)),-3
	scale=1.6*fvar(2)*const(size.xscale),0.5*fvar(2)*const(size.yscale)
	vel=-1.5*const(size.xscale)*fvar(10)
	accel=0.016*const(size.xscale)*fvar(10),-0.012*const(size.yscale)*fvar(10)
[state 0] ;[.04c]
	type=explod
	trigger1=!time && var(0)>4
	anim=f210502-(var(0)>4)
	postype=p1
	sprpriority=-6
	ownpal=1
	facing= -1
	vfacing=-1
	pos=floor(12*const(size.xscale)),-3
	scale=1.6*fvar(2)*const(size.xscale),0.5*fvar(2)*const(size.yscale)
	vel=1.5*const(size.xscale)*fvar(10)
	accel=-0.016*const(size.xscale)*fvar(10),-0.012*const(size.yscale)*fvar(10)

[state 0] ;[.04d]
	type=explod
	trigger1=!time && var(0)>1
	anim=f210502-(var(0)>1)-(var(0)>4)
	postype=p1
	sprpriority=6
	ownpal=1
	facing=  1
	vfacing=-1
	pos=floor(-23*const(size.xscale)),3
	scale=1.8*fvar(2)*const(size.xscale),0.6*fvar(2)*const(size.yscale)
	vel=-2*const(size.xscale)*fvar(10)
	accel=0.02*const(size.xscale)*fvar(10),-0.02*const(size.yscale)*fvar(10)
[state 0] ;[.04e]
	type=explod
	trigger1=!time && var(0)>1
	anim=f210502-(var(0)>1)-(var(0)>4)
	postype=p1
	sprpriority=6
	ownpal=1
	facing= -1
	vfacing=-1
	pos=floor(23*const(size.xscale)),3
	scale=1.8*fvar(2)*const(size.xscale),0.6*fvar(2)*const(size.yscale)
	vel=2*const(size.xscale)*fvar(10)
	accel=-0.02*const(size.xscale)*fvar(10),-0.02*const(size.yscale)*fvar(10)

;--- spark ; 火花
[state 0] ;[.04f]
	type=explod
	trigger1=!time && var(0)>4
	anim=f280+(random%4)
	postype=p1
	sprpriority=6
	ownpal=1
	pos=floor(fvar(4):=((random%100)-50)*fvar(10)), floor(fvar(5):=-(2+random*0.005)*fvar(10))
	scale=fvar(3):=(random*0.0002+0.25), fvar(3)
	vel=fvar(3)*fvar(4)*0.4,fvar(3)*fvar(5)*4
	accel=0,-fvar(3)*fvar(4)*0.1
[state 0] ;[.04g]
	type=explod
	trigger1=!time && var(0)>4
	anim=f280+(random%4)
	postype=p1
	sprpriority=6
	ownpal=1
	pos=floor(fvar(4):=((random%100)-50)*fvar(10)), floor(fvar(5):=-(2+random*0.005)*fvar(10))
	scale=fvar(3):=(random*0.0002+0.25), fvar(3)
	vel=fvar(3)*fvar(4)*0.4,fvar(3)*fvar(5)*4
	accel=0,-fvar(3)*fvar(5)*0.1
[state 0] ;[.04h]
	type=explod
	trigger1=!time && var(0)>4
	anim=f280+(random%4)
	postype=p1
	sprpriority=6
	ownpal=1
	pos=floor(fvar(4):=((random%100)-50)*fvar(10)), floor(fvar(5):=-(2+random*0.005)*fvar(10))
	scale=fvar(3):=(random*0.0002+0.25), fvar(3)
	vel=fvar(3)*fvar(4)*0.4,fvar(3)*fvar(5)*4
	accel=0,-fvar(3)*fvar(5)*0.1
[state 0] ;[.04i]
	type=explod
	trigger1=!time && var(0)>4
	anim=f280+(random%4)
	postype=p1
	sprpriority=6
	ownpal=1
	pos=floor(fvar(4):=((random%100)-50)*fvar(10)), floor(fvar(5):=-(2+random*0.005)*fvar(10))
	scale=fvar(3):=(random*0.0002+0.25), fvar(3)
	vel=fvar(3)*fvar(4)*0.4,fvar(3)*fvar(5)*4
	accel=0,-fvar(3)*fvar(5)*0.1
[state 0] ;[.04j]
	type=explod
	trigger1=!time && var(0)>4
	anim=f280+(random%4)
	postype=p1
	sprpriority=6
	ownpal=1
	pos=floor(fvar(4):=((random%100)-50)*fvar(10)), floor(fvar(5):=-(2+random*0.005)*fvar(10))
	scale=fvar(3):=(random*0.0002+0.25), fvar(3)
	vel=fvar(3)*fvar(4)*0.4,fvar(3)*fvar(5)*4
	accel=0,-fvar(3)*fvar(5)*0.1
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=1
	ignorehitpause=1

;==========================
;==========================
; Jump Land Dust [helper] ; 通常着地衝撃波
;==========================
[statedef 152000]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.00c]
	type=posset
	trigger1=1
	y=0
;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1|| var(0):=ifelse(ishelper(152010),1,0) || fvar(1):=(const(size.ground.back)+const(size.ground.front)+15)*0.031 ;;<- scale
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=(playerid(floor(root,sysfvar(0))),var(0)=90900)
	trigger1=1|| var(24):=playerid(floor(root,sysfvar(0))),var(24) ;;<-stage type
;---
[state 0] ;[.02a] ; ring
	type=explod
	trigger1=!time && !var(24)
	anim=f6550
	postype=p1
	sprpriority=-3
	ownpal=1
	scale=fvar(1)*ifelse(var(0),0.36,0.18),fvar(1)*0.13
[state 0] ;[.02b]
	type=playsnd
	trigger1=!time && !var(24)
	value=f0+ifelse(var(0),7,52),0
;---
[state 0] ;[.03a]
	type=explod
	trigger1=!time && !var(24)
	anim=f210558 ;; <MASK>
	postype=p1
	sprpriority=-5
	ownpal=1
	pos=-parent,const(size.ground.back)
	scale=fvar(1)*0.5,fvar(1)*0.4
	vel=-3*fvar(1),-1*fvar(1)
	accel=0.1*fvar(1),0.06*fvar(1)
[state 0] ;[.03b]
	type=explod
	trigger1=!time && !var(24)
	anim=f210552
	postype=p1
	sprpriority=3
	ownpal=1
	pos=-parent,const(size.ground.back)
	scale=fvar(1)*0.5,fvar(1)*0.4
	vel=-3*fvar(1),-1*fvar(1)
	accel=0.1*fvar(1),0.06*fvar(1)

[state 0] ;[.03c]
	type=explod
	trigger1=!time && !var(24)
	anim=f210558 ;; <MASK>
	postype=p1
	sprpriority=-5
	ownpal=1
	pos=parent,const(size.ground.front)
	scale=fvar(1)*0.5,fvar(1)*0.4
	vel=3*fvar(1),-1*fvar(1)
	accel=-0.1*fvar(1),0.06*fvar(1)
[state 0] ;[.03d]
	type=explod
	trigger1=!time && !var(24)
	anim=f210552
	postype=p1
	sprpriority=3
	ownpal=1
	pos=parent,const(size.ground.front)
	scale=fvar(1)*0.5,fvar(1)*0.4
	vel=3*fvar(1),-1*fvar(1)
	accel=-0.1*fvar(1),0.06*fvar(1)
;---
; water sound ; 水 - 効果音
[state 0] ;[.04a]
	type=playsnd
	trigger1=!time && var(24)=1
	value=f127,0
; water land ; 水 - 離陸/着陸/移動
[state 0] ;[.04b]
	type=explod
	trigger1=!time && var(24)=1
	anim=f10330
	postype=p1
	pos=0,0
	sprpriority=7
	ownpal=1
	scale=fvar(1)*0.75,fvar(1)*0.75
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>=0
	ignorehitpause=1

;==========================
;==========================
; Jump Dust [helper] ; 跳躍煙
;==========================
[statedef 152020]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.00c]
	type=posset
	trigger1=1
	y=0
;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1|| fvar(1):=(const(size.ground.back)+const(size.ground.front)+15)*0.031 ;;<- scale
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=(playerid(floor(root,sysfvar(0))),var(0)=90900)
	trigger1=1|| var(24):=playerid(floor(root,sysfvar(0))),var(24) ;;<-stage type
;---
[state 0] ;[.02a]
	type=playsnd
	trigger1=!time
	value=f50,0
;---
[state 0] ;[.03a]
	type=explod
	trigger1=!time && !var(24)
	anim=f210558 ;; <MASK>
	postype=p1
	sprpriority=-5
	ownpal=1
	pos=-parent,const(size.ground.back)
	scale=fvar(1)*0.4,fvar(1)*0.3
	vel=-2*fvar(1),-0.5*fvar(1)
	accel=0.06*fvar(1),0.05*fvar(1)
[state 0] ;[.01b]
	type=explod
	trigger1=!time && !var(24)
	anim=f210552
	postype=p1
	sprpriority=3
	ownpal=1
	pos=-parent,const(size.ground.back)
	scale=fvar(1)*0.4,fvar(1)*0.3
	vel=-2*fvar(1),-0.5*fvar(1)
	accel=0.06*fvar(1),0.05*fvar(1)

[state 0] ;[.03c]
	type=explod
	trigger1=!time && !var(24)
	anim=f210558 ;; <MASK>
	postype=p1
	sprpriority=-5
	ownpal=1
	pos=parent,const(size.ground.front)
	scale=fvar(1)*0.4,fvar(1)*0.3
	vel=2*fvar(1),-0.5*fvar(1)
	accel=-0.06*fvar(1),0.05*fvar(1)
[state 0] ;[.03d]
	type=explod
	trigger1=!time && !var(24)
	anim=f210552
	postype=p1
	sprpriority=3
	ownpal=1
	pos=parent,const(size.ground.front)
	scale=fvar(1)*0.4,fvar(1)*0.3
	vel=2*fvar(1),-0.5*fvar(1)
	accel=-0.06*fvar(1),0.05*fvar(1)
;---
; water sound ; 水 - 効果音
[state 0] ;[.04a]
	type=playsnd
	trigger1=!time && var(24)=1
	value=f127,0
; water land ; 水 - 離陸/着陸/移動
[state 0] ;[.04b]
	type=explod
	trigger1=!time && var(24)=1
	anim=f10330
	postype=p1
	pos=0,0
	sprpriority=7
	ownpal=1
	scale=fvar(1)*0.65,fvar(1)*0.45
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>=0
	ignorehitpause=1

;==========================
;==========================
; Dash Dust [helper] ; 突進煙
;==========================
[statedef 152040]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1|| fvar(0):=const(size.xscale) || fvar(1):=const(size.yscale) || fvar(10):=(const(size.ground.back)+const(size.ground.front))*0.06 ;;<-localcoord
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=(playerid(floor(root,sysfvar(0))),var(0)=90900)
	trigger1=1|| var(24):=playerid(floor(root,sysfvar(0))),var(24) ;;<-stage type
;--- dust ; 煙
[state 0] ;[.02a]
	type=explod
	trigger1=!time && !var(24)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-3
	ownpal=1
	pos=0,floor(-8*fvar(1))
	scale=1.02*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.6*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-2*fvar(0)*fvar(10),-2*fvar(1)*fvar(10)
	accel=0.04*fvar(0)*fvar(10),0.04*fvar(1)*fvar(10)
[state 0] ;[.02b]
	type=explod
	trigger1=!time && !var(24)
	anim=f210551
	postype=p1
	sprpriority=5
	ownpal=1
	pos=0,floor(-8*fvar(1))
	scale=1.02*fvar(0)*var(3),0.6*fvar(1)*var(4)
	vel=-2*fvar(0)*fvar(10),-2*fvar(1)*fvar(10)
	accel=0.04*fvar(0)*fvar(10),0.04*fvar(1)*fvar(10)
;---
[state 0] ;[.02c]
	type=explod
	trigger1=!time && !var(24)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-3
	ownpal=1
	pos=floor(-6*fvar(0)),0
	scale=1.03*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.62*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-1.5*fvar(0)*fvar(10),-1.5*fvar(1)*fvar(10)
	accel=0.04*fvar(0)*fvar(10),0.04*fvar(1)*fvar(10)
[state 0] ;[.02d]
	type=explod
	trigger1=!time && !var(24)
	anim=f210551
	postype=p1
	sprpriority=5
	ownpal=1
	pos=floor(-6*fvar(0)),0
	scale=1.03*fvar(0)*var(3),0.62*fvar(1)*var(4)
	vel=-1.5*fvar(0)*fvar(10),-1.5*fvar(1)*fvar(10)
	accel=0.04*fvar(0)*fvar(10),0.04*fvar(1)*fvar(10)
;--- ground 地面
[state 0] ;[.03a]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-2
	ownpal=1
	pos=floor(16*fvar(0)),floor(5*fvar(1))
	scale=1.6*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.5*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-2*fvar(0)*fvar(10),-0.3*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
[state 0] ;[.03b]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210551
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(16*fvar(0)),floor(5*fvar(1))
	scale=1.6*fvar(0)*var(3),0.5*fvar(1)*var(4)
	vel=-2*fvar(0)*fvar(10),-0.3*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
;---
[state 0] ;[.03c]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210556 ;; <MASK>
	postype=p1
	sprpriority=-2
	ownpal=1
	pos=floor(21*fvar(0)),floor(8*fvar(1))
	scale=1.8*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.6*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-2.5*fvar(0)*fvar(10),-0.6*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
[state 0] ;[.03d]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210550
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(21*fvar(0)),floor(8*fvar(1))
	scale=1.8*fvar(0)*var(3),0.6*fvar(1)*var(4)
	vel=-2.5*fvar(0)*fvar(10),-0.6*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
;---
[state 0] ;[.04a] ; water
	type=explod
	trigger1=!time && var(24)=1 && (pos y>-110)
	anim=f10340+(random%3)
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(-20*fvar(0)),floor(-pos y*10)/10
	scale=1.5*fvar(0),1*fvar(1)
	vel=-2*fvar(0)*fvar(10),0
	accel=0.02*fvar(0)*fvar(10)
[state 0] ;[.04b] ; water
	type=explod
	trigger1=!time && var(24)=1 && (pos y>-110)
	anim=f10340+(random%3)
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(-20*fvar(0)),floor(-pos y*10)/10
	scale=1*fvar(0),1.5*fvar(1)
	vel=-1.25*fvar(0)*fvar(10),0
	accel=0.01*fvar(0)*fvar(10)
;---
[state 0] ;[.05]
	type=destroyself
	trigger1=time>=0
	ignorehitpause=1

;==========================
;==========================
; Slide Dust [helper] ; 滑り煙
;==========================
[statedef 152050]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1|| var(9):=0 || fvar(10):=(const(size.ground.back)+const(size.ground.front))*0.031;415926 ;;<-localcoord
	trigger1=1|| fvar(0):=const(size.xscale)*const(size.xscale)||fvar(1):=const(size.yscale)*const(size.yscale)
	trigger1=(root,sysfvar(0)>0) && playeridexist(floor(root,sysfvar(0)))
	trigger1=(playerid(floor(root,sysfvar(0))),var(0)=90900)
	trigger1=1|| var(24):=playerid(floor(root,sysfvar(0))),var(24) ;;<-stage type

;--- dust ; 煙
[state 0] ;[.02a]
	type=explod
	trigger1=!time && !var(24)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(-12*fvar(0)),0
	scale=1.1*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.8*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-4.5*fvar(0)*fvar(10),-2*fvar(1)*fvar(10)
	accel=0.002*fvar(0)*fvar(10),0.001*fvar(1)*fvar(10)
[state 0] ;[.02b]
	type=explod
	trigger1=!time && !var(24)
	anim=f210551
	postype=p1
	sprpriority=3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(-12*fvar(0)),0
	scale=1.1*fvar(0)*var(3),0.8*fvar(1)*var(4)
	vel=-4.5*fvar(0)*fvar(10),-2*fvar(1)*fvar(10)
	accel=0.002*fvar(0)*fvar(10),0.001*fvar(1)*fvar(10)

;--- ground 地面
[state 0] ;[.03a]
	type=explod
	trigger1=!time && !var(24)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(-28*fvar(0)),floor(3*fvar(0))
	scale=1.36*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.66*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=-6*fvar(0)*fvar(10),-0.3*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
[state 0] ;[.03b]
	type=explod
	trigger1=!time && !var(24)
	anim=f210551
	postype=p1
	sprpriority=3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(-28*fvar(0)),floor(3*fvar(0))
	scale=1.36*fvar(0)*var(3),0.66*fvar(1)*var(4)
	vel=-6*fvar(0)*fvar(10),-0.3*fvar(1)*fvar(10)
	accel=0.01*fvar(0)*fvar(10),0.003*fvar(1)*fvar(10)
;---
[state 0] ;[.04a]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210557 ;; <MASK>
	postype=p1
	sprpriority=-3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(18*fvar(0)),floor(3*fvar(0))
	scale=1.8*fvar(0)*(var(3):=ifelse(random<500,1,-1)),0.86*fvar(1)*(var(4):=ifelse(random<500,1,-1))
	vel=1.5*fvar(0)*fvar(10),-0.6*fvar(1)*fvar(10)
	accel=-0.002*fvar(0)*fvar(10),0.001*fvar(1)*fvar(10)
[state 0] ;[.04a]
	type=explod
	trigger1=!time && !var(24) && (vel y<=0) && (pos y>-110)
	anim=f210551
	postype=p1
	sprpriority=3
	ownpal=1
	bindtime=var(9)+1
	pos=floor(18*fvar(0)),floor(3*fvar(0))
	scale=1.8*fvar(0)*var(3),0.86*fvar(1)*var(4)
	vel=1.5*fvar(0)*fvar(10),-0.6*fvar(1)*fvar(10)
	accel=-0.002*fvar(0)*fvar(10),0.001*fvar(1)*fvar(10)
;---
[state 0] ;[.05a] ; water
	type=explod
	trigger1=!time && var(24)=1 && (pos y>-110)
	anim=f10340+(random%3)
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(-20*fvar(0)),floor(-pos y*10)/10
	scale=1.5*fvar(0),1*fvar(1)
	vel=-6*fvar(0)*fvar(10),0
	accel=0.03*fvar(0)*fvar(10)
[state 0] ;[.05b] ; water
	type=explod
	trigger1=!time && var(24)=1 && (pos y>-110)
	anim=f10340+(random%3)
	postype=p1
	sprpriority=7
	ownpal=1
	pos=floor(-20*fvar(0)),floor(-pos y*10)/10
	scale=1.2*fvar(0),1*fvar(1)
	vel=3*fvar(0)*fvar(10),0
	accel=-0.02*fvar(0)*fvar(10)
;---
[state 0] ;[.06]
	type=destroyself
	trigger1=time>=var(9)
	ignorehitpause=1

;==========================
;==========================
; Grab Spark [helper] ; 掴みスパーク
;==========================
[statedef 152080]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- init
[state 0] ;[.01a]
	type=null
	trigger1=!time
	trigger1=1||var(0):=(const(size.height)%100) || var(1):=((const(size.height)/100)%10) ;; img type _ sound flag
	ignorehitpause=1
;--- sound
[state 0] ;[.02a]
	type=playsnd
	trigger1=!time && var(1)=1 ;;sound flag
	value=f800,0
	ignorehitpause=1
	persistent=0
;--- spark
[state 0] ;[.03a]
	type=explod
	trigger1=!time
	id=1
	anim=f5+stateno+var(0) ;<MASK>
	postype=p1
	pos=0,0
	sprpriority=4
	ownpal=1
	bindtime=-1
	scale=fvar(0):=const(size.xscale)*0.16,fvar(1):=const(size.yscale)*1.28
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
[state 0] ;[.03b]
	type=explod
	trigger1=!time
	id=1
	anim=f0+stateno+var(0)
	postype=p1
	pos=0,0
	sprpriority=5
	ownpal=1
	bindtime=-1
	scale=fvar(0),fvar(1)
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
	persistent=0
;---
[state 0] ;[.04]
	type=destroyself
	trigger1=time>=0
	ignorehitpause=1

;==========================
;==========================
; Hit/Guard Spark [helper] ; 火花
;==========================
[statedef 152100]
type=c
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.01] ; init
	type=null
	trigger1=!time
	trigger1=1|| var(0):=const(size.height)
;---
;--- hit spark_center
[state 0] ;[.02a1]
	type=explod
	trigger1=!time && (var(0)=[0,9])
	id=1
	anim=f6600 +(var(0)=[3,4])*var(0) +(var(0)>4)*5 +(var(0)>5)
	postype=p1
	pos=0,0
	sprpriority=5
	ownpal=1
	scale=(fvar(0):=(0.35+(var(0)%5)*0.1)*ifelse(random<500,1,-1)),(fvar(1):=(0.35+(var(0)%5)*0.1)*ifelse(random<500,1,-1))
	angle=fvar(2):=random*0.36
[state 0] ;[.02a2]
	type=explod
	trigger1=!time && (var(0)=[0,9])
	id=1
	anim=f6650 +(var(0)>4)*5 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=3
	ownpal=1
	scale=fvar(0),fvar(1)
	angle=fvar(2)
;---
;--- hit_spark_rim
[state 0] ;[.02b1]
	type=explod
	trigger1=!time && (var(0)=[0,9])
	id=1
	anim=f6610 +(var(0)=[3,4])*var(0) +(var(0)>4)*5
	postype=p1
	pos=0,0
	sprpriority=4
	ownpal=1
	scale=(fvar(0):=(0.5+(var(0)%5)*0.1)*ifelse(random<500,1,-1)),(fvar(1):=(0.5+(var(0)%5)*0.1)*ifelse(random<500,1,-1))
	angle=fvar(2)
[state 0] ;[.02b2]
	type=explod
	trigger1=!time && (var(0)=[0,9])
	id=1
	anim=f6660 +(var(0)>4)*5 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=3
	ownpal=1
	scale=fvar(0),fvar(1)
	angle=fvar(2)
;---
;--- dust
[state 0] ;[.02c1]
	type=explod
	trigger1=!time && (var(0)=[0,4])
	anim=f6621+(var(0)%5=3)
	postype=p1
	pos=0,0
	sprpriority=3
	ownpal=1
	bindtime=1
	scale=fvar(0),fvar(1)
	vel=fvar(3):=-3-(var(0)%5)
	accel=-fvar(3)*0.05
[state 0] ;[.02c2]
	type=explod
	trigger1=!time && (var(0)=[0,4])
	anim=f6623 ;; <MASK>
	postype=p1
	pos=0,0
	sprpriority=2
	ownpal=1
	bindtime=1
	scale=fvar(0),fvar(1)
	vel=fvar(3),0
	accel=-fvar(3)*0.05
;---
;--- guard spark
[state 0] ;[.03a1]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6740+(var(0)%5>2)
	postype=p1
	pos=0,0
	sprpriority=5
	ownpal=1
	scale= (fvar(0):=((var(0)%5)+9)*0.1) *0.25, fvar(0)*0.5
	vel=fvar(2):=((var(0)%5)+6)*0.1
	accel=-fvar(2)*0.01
[state 0] ;[.03a2]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6750 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=4
	ownpal=1
	scale=fvar(0),fvar(0)*2
	vel=fvar(2)
	accel=-fvar(2)*0.01

;--- guard_shock_wave
[state 0] ;[.03b2]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6745+(var(0)%5>2)
	postype=p1
	pos=0,0
	sprpriority=7
	ownpal=1
	scale=fvar(0)*0.15,fvar(0)*0.3
[state 0] ;[.03b4]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6755 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=6
	ownpal=1
	scale=fvar(0)*0.15,fvar(0)*0.3

[state 0] ;[.03b3]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6745+(var(0)%5>2)
	postype=p1
	pos=0,0
	sprpriority=7
	ownpal=1
	scale=-fvar(0)*0.06,fvar(0)*0.12
	vel=fvar(2)
	accel=-fvar(2)*0.01
[state 0] ;[.03b5]
	type=explod
	trigger1=!time && (var(0)=[40,49])
	id=1
	anim=f6755 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=3
	ownpal=1
	scale=-fvar(0)*0.06,fvar(0)*0.12
	vel=fvar(2)
	accel=-fvar(2)*0.01

;---
;--- hit_shock_wave
[state 0] ;[.04a1]
	type=explod
	trigger1=!time && (var(0)=[3,4])
	id=1
	anim=f6800
	postype=p1
	pos=0,0
	sprpriority=4
	ownpal=1
	scale= ( fvar(0):=ifelse(var(0)=4,0.72,0.62) ) , fvar(0)
;--- counter_hit_shock_wave
[state 0] ;[.04a2]
	type=explod
	trigger1=!time && numexplod(2)=0 && numenemy
	trigger1=(enemy,sysfvar(0)>0) && (playeridexist(floor(enemy,sysfvar(0))))
	trigger1=(playerid(floor(enemy,sysfvar(0))),var(0)=90900) && (playerid(floor(enemy,sysfvar(0))),var(9)&49152)=49152
	id=2
	anim=f6560
	postype=p1
	pos=0,0
	sprpriority=5
	ownpal=1
	scale=fvar(0)*0.5,fvar(0)*4 ;; -fvar(0)*1.2,fvar(0)*1.2
[state 0] ;[.04a3]
	type=explod
	trigger1=!time && numexplod(2)=1
	id=2
	anim=f6565 ;;<MASK>
	postype=p1
	pos=0,0
	sprpriority=4
	ownpal=1
	scale=fvar(0)*0.5,fvar(0)*4
;---
;--- frag
[state 0] ;[.05a1]
	type=explod
	trigger1=!time && (var(0)=[0,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
[state 0] ;[.05a2]
	type=explod
	trigger1=!time && (var(0)=[0,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
[state 0] ;[.05a3]
	type=explod
	trigger1=!time && (var(0)=[0,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
[state 0] ;[.05a4]
	type=explod
	trigger1=!time && (var(0)=[1,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
[state 0] ;[.05a5]
	type=explod
	trigger1=!time && (var(0)=[1,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
[state 0] ;[.05a6]
	type=explod
	trigger1=!time && (var(0)=[2,4])
	anim=f6910 +((var(0)>2)+(var(0)>3))*10
	postype=p1
	sprpriority=4
	ownpal=1
	pos=floor(( fvar(0):= (fvar(3):=(1+(random%12))*((var(0)%5)*0.1+1) ) *cos( (fvar(4):=(random%160)+100) *0.0174) )), floor(fvar(1):=-fvar(3)*sin(fvar(4)*0.0174))
	vel=fvar(0),fvar(1)
	accel=-fvar(0)*0.06,-fvar(1)*0.06
	scale=(fvar(5):=((var(0)%5)+12)*(random+200)*0.00001),fvar(5)
	angle=fvar(4)
;---
;---
[state 0] ;[.06]
	type=destroyself
	trigger1=1
	ignorehitpause=1

;==========================
;==========================
; Fire / Burn Spark [helper] ; 燃焼効果演出
;==========================
[statedef 152200]
type=s
physics=n
anim=909601 ;; empty
velset=0,0
ctrl=0
;---
[state 0] ;[.01a]
	type=varset
	trigger1=!time
	trigger1=1|| var(0):=(const(size.height)/10) || var(1):=(const(size.height)%10) || var(1):=var(1)*(var(1)=[0,1])
	;;--- player id || flame type [0:red / 1:blue]
;;--- set to root id
;old;	var(0)=ifelse(var(0)<1||playeridexist(var(0))=0,(root,id),var(0))
;;--- set to self
	var(0)=ifelse(var(0)<1||playeridexist(var(0))=0,(id),var(0))
	ignorehitpause=1
;---
[state 0] ;[.02]
	type=destroyself
	trigger1=(time>32) || (root,numhelper(stateno)>1)
	ignorehitpause=1
;---
[state 0] ;[.03] ; bind to target
	type=posset
	trigger1=var(0)>0 && playeridexist(var(0))
	x=playerid(var(0)),pos x
	y=playerid(var(0)),pos y
	ignorehitpause=1

[state 0] ;[.04a]
	type=varset
	trigger1=!time && var(0)>0 && playeridexist(var(0))
	var(10)=playerid(var(0)),const(size.head.pos.y)
	ignorehitpause=1
[state 0] ;[.04b]
	type=varset
	trigger1=!time && (var(10)!=[-160,0]) || (var(0)=id)
	var(10)=0 ;; [def]
	ignorehitpause=1

[state 0] ;[.05a] ;; scale
	type=varset
	trigger1=!time
	fvar(0)=abs(var(10))*0.0012+0.8
	ignorehitpause=1
[state 0] ;[.05b]
	type=varadd
	trigger1=time && fvar(0)>0.1
	fvar(0)=-0.01
	ignorehitpause=1
;---
[state 0] ;[.05c]
	type=varset
	;;--- scale w/h
	trigger1=1|| fvar(1):=((random%9)*0.02+0.75)*fvar(0)*ifelse(random<500,1,-1) || fvar(3):=-0.2-(random%6)*0.2
	;;--- v9:fire_anim / v7:spark_anim / v3-6:pos x/y
	trigger1=1|| var(9):=(random%3) || var(7):=(random%4) || var(4):=var(10) || var(5):=(random%57)-28 || var(6):=(random%abs(var(10)+21))-10
	fvar(2)=fvar(1)*1.5*fvar(0)*ifelse(random<500,1,-1)
	ignorehitpause=1
;---
[state 0] ;[.06a]
	type=varset
	trigger1=var(0)>0 && playeridexist(var(0))
	trigger1=(playerid(var(0)),statetype=c)
	var(4)=var(4)/2
	ignorehitpause=1
[state 0] ;[.06b]
	type=varset
	trigger1=var(0)>0 && playeridexist(var(0))
	trigger1=(playerid(var(0)),statetype=l)
	var(4)=-10  +(var(5):=(random%91)-45)*0  +(var(6):=(random%33)-16)*0
	ignorehitpause=1
;---
[state 0] ;[.07a]
	type=explod
	trigger1=(time<6 || (time%2=0)) && numexplod(1)<10
	anim=f210506+var(9) ;; <MASK> [210506-210508]
	id=1
	postype=p1
	pos=var(3)+var(5),var(4)+var(6)
	scale=fvar(1),fvar(2)
	vel=0,fvar(3)
	sprpriority=-5
	ownpal=1
	ignorehitpause=1
[state 0] ;[.07b]
	type=explod
	trigger1=(time<6 || (time%2=0)) && numexplod(2)<10
	anim=f210500+var(9)+var(1)*3 ;; [210500-210505] ; red:0-2 / blue:3-5
	id=2
	postype=p1
	pos=var(3)+var(5),var(4)+var(6)
	scale=fvar(1),fvar(2)
	vel=0,fvar(3)
	sprpriority=6
	ownpal=1
	ignorehitpause=1
;---
[state 0] ;[.08]
	type=playsnd
	trigger1=!time
	value=f300,21
;--- spark
[state 0] ;[.09a]
	type=explod
	trigger1=(time%2=0)
	anim=f290+var(7) ;<MASK>
	postype=p1
	sprpriority=5
	ownpal=1
	scale=0.25,0.25
	pos=var(3)+var(5)+(var(8):=(random%80)-40), var(4)+var(6)+(var(9):=(random%30)-15)
	vel=  fvar(4):=(random-500)/1200.0, fvar(5):=(random-500)/1200.0
	accel=fvar(6):=(random-500)/2800.0, fvar(7):=(random-500)/2800.0
	ignorehitpause=1
[state 0] ;[.09b]
	type=explod
	trigger1=(time%2=0)
	anim=f280+var(1)*5+var(7)
	postype=p1
	sprpriority=6
	ownpal=1
	scale=0.25,0.25
	pos=var(3)+var(5)+var(8),var(4)+var(6)+var(9)
	vel=  fvar(4),fvar(5)
	accel=fvar(6),fvar(7)
	ignorehitpause=1

;==========================
;==========================
; Explosion [helper] ; 爆発効果演出
;==========================
[statedef 152220]
type=s
anim=909601 ;; empty
velset=0,0
ctrl=0
;--- explos
[state 0] ;[.01a]
	type=explod
	trigger1=1|| fvar(1):=ifelse(!time,1,(random%6)*0.1+0.2)
	anim=f210516+(var(9):=(random%3)*(time>0)) ;<MASK>
	id=1
	postype=p1
	pos=var(3):=floor(((random%161)-80)*const(size.xscale))*(time>0), var(4):=floor(((random%161)-80)*const(size.yscale))*(time>0)
	scale=fvar(1)*(var(5):=ifelse(random<500,1,-1))*const(size.xscale),fvar(1)*(var(6):=ifelse(random<500,1,-1))*const(size.yscale)
	sprpriority=5
	ownpal=1
	vel=var(3)*0.01,var(4)*0.01
	ignorehitpause=1
[state 0] ;[.01b]
	type=explod
	trigger1=1
	anim=f210510+var(9)+(ishelper(152221))*3
	id=2
	postype=p1
	pos=var(3),var(4)
	scale=fvar(1)*var(5)*const(size.xscale),fvar(1)*var(6)*const(size.yscale)
	sprpriority=6
	ownpal=1
	vel=var(3)*0.01,var(4)*0.01
	ignorehitpause=1
;--- spark
[state 0] ;[.02a]
	type=explod
	trigger1=1
	anim=f290+(var(7):=(random%4)) ;<MASK>
	postype=p1
	sprpriority=5
	ownpal=1
	pos=(var(8):=(random%(floor(const(size.xscale)*66)))+8)*var(5),(var(9):=(random%(floor(const(size.yscale)*28)))+6)*var(6)
	vel=   (fvar(4):=(random+500)/250.0 *const(size.xscale))*var(5) , (fvar(5):=(random+500)/250.0 *const(size.yscale))*var(6)
	accel=-(fvar(6):=(random+500)/7500.0*const(size.xscale))*var(5) ,-(fvar(7):=(random+500)/7500.0*const(size.yscale))*var(6)
	scale=0.25+const(size.xscale)*0.05,0.25+const(size.yscale)*0.05
	ignorehitpause=1
[state 0] ;[.02b]
	type=explod
	trigger1=1
	anim=f280+var(7)+(ishelper(152221))*5
	postype=p1
	sprpriority=6
	ownpal=1
	pos=var(8)*var(5),var(9)*var(6)
	vel=fvar(4)*var(5),fvar(5)*var(6)
	accel=-fvar(6)*var(5),-fvar(7)*var(6)
	scale=0.25+const(size.xscale)*0.05,0.25+const(size.yscale)*0.05
	ignorehitpause=1
;--- spark
[state 0] ;[.03a]
	type=explod
	trigger1=1
	anim=f290+(var(7):=(random%4)) ;<MASK>
	postype=p1
	sprpriority=5
	ownpal=1
	pos=-var(8)*var(5),-var(9)*var(6)
	vel=-fvar(4)*var(5),-fvar(5)*var(6)
	accel=fvar(6)*var(5),fvar(7)*var(6)
	scale=0.25+const(size.xscale)*0.05,0.25+const(size.yscale)*0.05
	ignorehitpause=1
[state 0] ;[.03b]
	type=explod
	trigger1=1
	anim=f280+var(7)+(ishelper(152221))*5
	postype=p1
	sprpriority=6
	ownpal=1
	pos=-var(8)*var(5),-var(9)*var(6)
	vel=-fvar(4)*var(5),-fvar(5)*var(6)
	accel=fvar(6)*var(5),fvar(7)*var(6)
	scale=0.25+const(size.xscale)*0.05,0.25+const(size.yscale)*0.05
	ignorehitpause=1
;---
[state 0] ;[.04]
	type=destroyself
	trigger1=time>3
	ignorehitpause=1

;==========================
;==========================
; DestroySelf State [helper] ; ヘルパー用自己消去ステート
;==========================
[statedef 159990]
type=s
anim=909601 ;; empty
velset=0,0
ctrl=0
[state 0]
	type=destroyself
	trigger1=ishelper
	ignorehitpause=1


;==========================
[Statedef -10]
;==========================

;//==========================
;// add004-1-sctrls-start
;//==========================
;--- partner_standby
[state 0]
	type=selfstate
	value=190190
	ctrl=0
	trigger1=ctrl && numpartner && !ishelper && roundstate=2 && pos y=0
	trigger1=(sysfvar(4)>0) && (sysfvar(0)>0) && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900) && (playerid(floor(sysfvar(0))),var(22)=4)
	ignorehitpause=1
;##Add.List01##
;//==========================
;// add004-1-sctrls-end
;//==========================

;==========================
[Statedef -20]
;==========================

;//==========================
;// add004-sctrls-start
;//==========================
;sys::-2::partners_standby ; パートナー待機
[state 0]
	type=selfstate
	value=190190
	ctrl=0
	;;---
	triggerall=!ishelper && numpartner && roundstate=2 && alive && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	triggerall=(stateno!=[190190,190199]) && playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(22)=4
	;;---// switch / change ;(交替)
	trigger1=sysfvar(4)<1 && ( ctrl || (time<2 && stateno<600) ) && playerid(floor(sysfvar(0))),var(48)=11
	trigger1=(pos y>=0) && movetype!=h && gethitvar(isbound)=0 && (stateno!=5120) && (stateno!=[5200,5210])
	;;---// assist ;(協力)
	trigger2=sysfvar(4)=1 && ( ctrl || (stateno-playerid(floor(sysfvar(0))),var(53+id-playerid(floor(sysfvar(0))),sysvar(0))!=[0,999]) )
	trigger2=(pos y>=0) && movetype!=h && gethitvar(isbound)=0 && (stateno!=5120) && (stateno!=[5200,5210])
	;;---// switch-canceling ;(割り込み交替)
	trigger3=sysfvar(4)=2 && ( ctrl || stateno<160 )
	trigger3=(pos y>=0) && movetype!=h && gethitvar(isbound)=0 && (stateno!=5120) && (stateno!=[5200,5210])
	;;---// player-priority ;(順位)
	trigger4=sysfvar(4)<1 && playerid(floor(sysfvar(0))),var(15)!=id
	;;---
	ignorehitpause=1

;sys::-2::partners_change_interrupted ; 割り込み交替
[state 0]
	type=varset
	trigger1=!ishelper && numpartner && roundstate=2 && alive && sysfvar(0)>0 && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(48)=21 && sysfvar(4)<1
	sysfvar(4)=2 ;; (0:main / 1:assist / 2:switch-canceling)

;sys::-2::helper::bar004 ; ライフバー
[state 0]
	type=helper
	triggerall=!ishelper && !numhelper(90900)
	trigger1=numpartner
	trigger1=id<(partner,id) && partner,numhelper(90900)=0
	trigger2=!numpartner
	id=90900
	stateno=90900
	helpertype=normal
	ownpal=1
	size.air.front=1702252 ;; <<-version
	size.height=0
	ignorehitpause=1
	supermovetime=88888
	pausemovetime=88888
	pos=0,88888

;sys::-2::get_helper::bar004_id ; ID取得
[state 0]
	type=varset
	trigger1=!ishelper && numhelper(90900)
	trigger1=(helper(90900),var(0)=90900) && (sysfvar(0)!=helper(90900),id)
	sysfvar(0)=(helper(90900),id)
;sys::-2::get_players_id2
[state 0]
	type=varset
	trigger1=!ishelper && numpartner
	trigger1=!numhelper(90900) && (partner,numhelper(90900)) && (sysfvar(0)!=(partner,sysfvar(0)))
	sysfvar(0)=(partner,sysfvar(0))

;sys::-2::bk/jd_system ; ブロキング/ジャストD
[state 0]
	type=hitoverride
	trigger1=(numprojid(195502)||numprojid(195503)) && !ishelper && roundstate=2 && alive && (ctrl || stateno=52)
	attr=sca,na,sa,ha,np,sp,hp
	stateno=195500
	time=1
	ignorehitpause=1

;//==========================
;;>>@Config.Face>>
;sys::-2::face_d ; portrait (顔)
[state 0]
	type=explod
	trigger1=!ishelper && alive && !numexplod(490600) && selfanimexist(909002)
	trigger1=sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),numexplod(490600)
	trigger1=movetype!=h || (stateno=[120,159]) || (stateno=[5000,5199]) || (stateno=[190190,190196])
	id=490600
	anim=909002
	space=screen
	postype=left
	facing=ifelse(teamside=1,1,-1)
	ownpal=1
	bindtime=-1
	removetime=-1
	scale=playerid(floor(sysfvar(0))),fvar(32-(id=playerid(floor(sysfvar(0))),var(15))*10), playerid(floor(sysfvar(0))),fvar(33-(id=playerid(floor(sysfvar(0))),var(15))*10)
	pos=floor(const240p(playerid(floor(sysfvar(0))),fvar(30-(id=playerid(floor(sysfvar(0))),var(15))*10))), floor(const240p(playerid(floor(sysfvar(0))),fvar(31-(id=playerid(floor(sysfvar(0))),var(15))*10)))
	sprpriority=floor(playerid(floor(sysfvar(0))),fvar(36-(id=playerid(floor(sysfvar(0))),var(15))*10))
	trans=addalpha
	alpha=floor(playerid(floor(sysfvar(0))),fvar(34-(id=playerid(floor(sysfvar(0))),var(15))*10)), floor(playerid(floor(sysfvar(0))),fvar(35-(id=playerid(floor(sysfvar(0))),var(15))*10))
	ignorehitpause=1
	supermovetime=-1
	pausemovetime=-1
;sys::-2::face_d_mod
[state 0]
	type=removeexplod
	trigger1=sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=(playerid(floor(sysfvar(0))),var(0)=90900)
	trigger1=(playerid(floor(sysfvar(0))),var(9)&262144) || !(playerid(floor(sysfvar(0))),var(9)&4)
	trigger2=roundstate!=2 || (stateno=5150 && time=5 && !alive)
	id=490600
	ignorehitpause=1

;//==========================
;;>>@Config.Camera>>
;sys::-2::camera_nc ; 焦点変更
[state 0]
	type=screenbound
	trigger1=!ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && numpartner && (sysfvar(4)>0 || stateno=5150)
	value=0
	movecamera=0,0
	ignorehitpause=1
;sys::-2::camera_np
[state 0]
	type=playerpush
	trigger1=!ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && numpartner && (sysfvar(4)>0 || stateno=5150)
	value=0
	ignorehitpause=1
;sys::-2::camera_nc2
[state 0]
	type=screenbound
	trigger1=!ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && (playerid(floor(sysfvar(0))),var(7)&65536) ;; system_switch
	value= ((numpartner && sysfvar(4)<1) || !numpartner) ;; [def=0]
	movecamera=0,0 ;; [x,y]
	ignorehitpause=1

;//==========================
;sys::-2::add.option2-noko
[state 0] ;; opt-noko
	type=assertspecial
	trigger1=!ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900
	trigger1=id=playerid(floor(sysfvar(0))),var(15) && (playerid(floor(sysfvar(0))),var(9)&65536) ;; opt-noko
	flag=noko
	ignorehitpause=1
;sys::-2::add.option3-life-mod
[state 0] ;; opt-life-mod
	type=lifeadd
	trigger1=!ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900
	trigger1=id=playerid(floor(sysfvar(0))),var(15) && playerid(floor(sysfvar(0))),var(23)!=0 ;; opt-mod-life
	value=playerid(floor(sysfvar(0))),var(23)
	kill=0
	ignorehitpause=1

;//==========================
;// optional settings
;sys::-2::guard_crush_fx ; ガードクラッシュ
[state 0]
	type=palfx
	trigger1=(stateno=150 || stateno=152) && alive && !ishelper && (gametime%5=0) && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(36)>=40
	time=2
	add=200,0,0
;sys::-2::guard_crush_cs
[state 0]
	type=changestate
	trigger1=(stateno=150 || stateno=152) && alive && !ishelper && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(36)>=50
	value=190010
	ignorehitpause=1
;;--- dizzy
;sys::-2::goto-dizzy_s/c
[state 0] ;[.03-2d1]
	type=selfstate
	trigger1=(stateno=5001 || stateno=5011) && hitover     && alive && !ishelper && life>1 && roundstate=2 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195201 ;; (goto-dizzy:190116)
;sys::-2::goto-dizzy_a/l
[state 0] ;[.03-2d2]
	type=selfstate
	trigger1=(stateno=5030 || stateno=5071) && hitshakeover && alive && !ishelper && life>1 && roundstate=2 && sysfvar(0)>id && playeridexist(floor(sysfvar(0)))
	trigger1=playerid(floor(sysfvar(0))),var(0)=90900 && playerid(floor(sysfvar(0))),var(50)>=1000
	value=195050
;;--- fadeout when KOed ; KO後消える
;sys::-2::st5150-1
[state 0]
	type=varset
	trigger1=stateno=5150 && time=1 && alive=0 && !ishelper && numpartner
	sysvar(1)=(roundstate<=2)
;sys::-2::st5150-2
[state 0]
	type=assertspecial
	trigger1=stateno=5150 && alive=0 && !ishelper && numpartner && sysvar(1) && (((time=[80,150]) && time%10<5) || time>150)
	flag=invisible
	flag2=noshadow
;;--- intro-pos-reset
;sys::-2::st5900-p3
[state 0]
	type=turn
	trigger1=stateno=5900 && time=0
	trigger1=!ishelper && numpartner>1 && facing=ifelse(teamside=1,-1,1)
;sys::-2::st5900-p4
[state 0]
	type=posset
	trigger1=stateno=5900 && time=0
	trigger1=!ishelper && numpartner>1 && playeridexist(id-2)
	trigger1=playerid(id-2),ishelper=0 && playerid(id-2),teamside=teamside
	x=const240p(120)*ifelse(teamside=1,-1,1)
;sys::-2::st5900-p5
[state 0]
	type=posset
	trigger1=stateno=5900 && time=0
	trigger1=!ishelper && numpartner>2 && playeridexist(id-3)
	trigger1=playerid(id-3),ishelper=0 && playerid(id-3),teamside=teamside
	x=const240p(144)*ifelse(teamside=1,-1,1)

;//==========================
;// add004-sctrls-end
;//==========================

;==========================
[Statedef -30]
;==========================
